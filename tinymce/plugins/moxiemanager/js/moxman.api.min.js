!function(e,t){"use strict";function n(e,t){for(var n,i=[],r=0;r<e.length;++r){if(n=s[e[r]]||o(e[r]),!n)throw"module definition dependecy not found: "+e[r];i.push(n)}t.apply(null,i)}function i(e,i,r){if("string"!=typeof e)throw"invalid module definition, module id must be defined and be a string";if(i===t)throw"invalid module definition, dependencies must be specified";if(r===t)throw"invalid module definition, definition function must be specified";n(i,function(){s[e]=r.apply(null,arguments)})}function r(e){return!!s[e]}function o(t){for(var n=e,i=t.split(/[.\/]/),r=0;r<i.length;++r){if(!n[i[r]])return;n=n[i[r]]}return n}function a(n){for(var i=0;i<n.length;i++){for(var r=e,o=n[i],a=o.split(/[.\/]/),l=0;l<a.length-1;++l)r[a[l]]===t&&(r[a[l]]={}),r=r[a[l]];r[a[a.length-1]]=s[o]}}var s={},l="moxman/util/Tools",u="moxman/util/Class",c="moxman/ui/Layout",d="moxman/ui/AbsoluteLayout",f="moxman/ui/BorderLayout",p="moxman/ui/Selector",h="moxman/ui/Collection",m="moxman/ui/EventUtils",g="moxman/ui/DomUtils",v="moxman/ui/Control",y="moxman/ui/Movable",x="moxman/ui/Tooltip",b="moxman/ui/Widget",w="moxman/ui/Button",_="moxman/ui/Factory",E="moxman/ui/Container",C="moxman/ui/ButtonGroup",R="moxman/ui/Carousel",T="moxman/ui/Checkbox",A="moxman/ui/CheckboxGroup",S="moxman/ui/ComboBox",D="moxman/ui/DragHelper",k="moxman/ui/FormItem",I="moxman/ui/Form",N="moxman/ui/FieldSet",M="moxman/ui/FitLayout",F="moxman/ui/FlexLayout",H="moxman/ui/Scrollable",P="moxman/ui/Panel",O="moxman/ui/Resizable",L="moxman/ui/FloatPanel",z="moxman/ui/FlowLayout",W="moxman/ui/Grid",B="moxman/ui/GridLayout",U="moxman/ui/Iframe",j="moxman/ui/Image",q="moxman/gfx/Shader",V="moxman/gfx/Texture",X="moxman/gfx/ImageEditor",Y="moxman/util/Json",G="moxman/util/Xhr",$="moxman/util/JsonRpc",J="moxman/util/Path",K="moxman/Env",Z="moxie/core/utils/Basic",Q="moxie/core/Exceptions",et="moxie/core/EventTarget",tt="moxie/core/utils/Encode",nt="moxie/core/utils/Url",it="moxie/core/utils/Env",rt="moxie/core/utils/Dom",ot="moxie/runtime/Runtime",at="moxie/runtime/RuntimeClient",st="moxie/runtime/RuntimeTarget",lt="moxie/file/Blob",ut="moxie/file/FileReaderSync",ct="moxie/xhr/FormData",dt="moxie/core/I18n",ft="moxie/core/utils/Mime",pt="moxie/xhr/XMLHttpRequest",ht="moxie/file/File",mt="moxie/file/BlobBuilder",gt="moxman/ui/ImageCanvas",vt="moxman/ui/KeyboardNavigation",yt="moxman/ui/Label",xt="moxman/ui/Toolbar",bt="moxman/ui/MenuBar",wt="moxman/ui/MenuButton",_t="moxman/ui/ListBox",Et="moxman/ui/MenuItem",Ct="moxman/ui/Menu",Rt="moxman/ui/Window",Tt="moxman/ui/MessageBox",At="moxman/ui/PanelButton",St="moxman/ui/Path",Dt="moxman/ui/Progress",kt="moxman/ui/Radio",It="moxman/ui/RadioGroup",Nt="moxman/ui/Slider",Mt="moxman/ui/Spacer",Ft="moxman/ui/SplitButton",Ht="moxman/ui/StackLayout",Pt="moxman/ui/TabPanel",Ot="moxman/ui/TextBox",Lt="moxman/ui/Throbber",zt="moxman/ui/ThumbnailView",Wt="moxman/ui/TreeItem",Bt="moxman/ui/TreeView",Ut="moxman/ui/View",jt="moxman/ui/ViewPort",qt="moxman/util/DateFormatter",Vt="moxman/util/Fullscreen",Xt="moxman/util/I18n",Yt="moxman/util/ImageSize",Gt="moxman/util/Loader",$t="moxman/util/MinQuery",Jt="moxman/util/Observable",Kt="moxman/util/Shortcuts",Zt="moxman/util/Uri",Qt="moxman/util/When",en="moxman/vfs/FileCollection",tn="moxman/vfs/File",nn="moxman/vfs/FileSystem",rn="moxman/vfs/FileSystemManager",on="moxman/views/LoginView",an="moxman/views/InstallView",sn="moxman/views/BaseView",ln="moxman/views/CreateDirView",un="moxman/views/CreateDocView",cn="moxman/views/EditView",dn="moxman/Loader",fn="moxman/views/FileListView",pn="moxman/views/RenameView",hn="moxie/file/FileInput",mn="moxie/file/FileDrop",gn="moxman/views/UploadView",vn="moxman/views/ViewFileView",yn="moxman/views/ZipView",xn="moxman/PluginManager",bn="moxman/Manager",wn="moxie/runtime/html5/Runtime",_n="moxie/runtime/html5/file/Blob",En="moxie/core/utils/Events",Cn="moxie/runtime/html5/file/FileDrop",Rn="moxie/runtime/html5/file/FileInput",Tn="moxie/core/JSON",An="moxie/runtime/html5/xhr/XMLHttpRequest",Sn="moxie/runtime/flash/Runtime",Dn="moxie/runtime/flash/file/Blob",kn="moxie/runtime/flash/file/FileInput",In="moxie/runtime/Transporter",Nn="moxie/runtime/flash/xhr/XMLHttpRequest",Mn="moxie/runtime/flash/file/FileReaderSync";i(l,[],function(){return{makeMap:function(e,t,n){var i;for(e=e||[],t=t||",","string"==typeof e&&(e=e.split(t)),n=n||{},i=e.length;i--;)n[e[i]]={};return n},unique:function(e){for(var t=[],n=e.length,i;n--;)i=e[n],i.__checked||(t.push(i),i.__checked=1);for(n=t.length;n--;)delete t[n].__checked;return t},extend:function(e){var t=arguments,n,i,r;for(e=e||{},i=1;i<t.length;i++){n=t[i];for(r in n)e[r]=n[r]}return e},toArray:function(e){var t=[],n,i;for(n=0,i=e.length;i>n;n++)t[n]=e[n];return t},inArray:function(e,t){var n;if(t.indexOf)return t.indexOf(e);for(n=t.length;n--;)if(t[n]===e)return n;return-1},isArray:Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)},each:function(e,t){var n,i,r,o;if(e)if(n=e.length,n===o){for(i in e)if(e.hasOwnProperty(i)&&t(e[i],i)===!1)return!1}else for(r=0;n>r;r++)if(t(e[r],r)===!1)return!1;return!0}}}),i(u,[l],function(e){function t(){}var n,i;return t.extend=n=function(t){function r(){var e,t,n,r;if(!i&&(r=this,r.init&&r.init.apply(r,arguments),t=r.Mixins))for(e=t.length;e--;)n=t[e],n.init&&n.init.apply(r,arguments)}function o(){return this}function a(e,t){return function(){var n=this,i=n._super,r;return n._super=l[e],r=t.apply(n,arguments),n._super=i,r}}var s=this,l=s.prototype,u,c,d;i=!0,u=new s,i=!1,t.Mixins&&(e.each(t.Mixins,function(e){e=e;for(var n in e)"init"!==n&&(t[n]=e[n])}),l.Mixins&&(t.Mixins=l.Mixins.concat(t.Mixins))),t.Methods&&e.each(t.Methods.split(","),function(e){t[e]=o}),t.Properties&&e.each(t.Properties.split(","),function(e){var n="_"+e;t[e]=function(e){var t=this,i;return e!==i?(t[n]=e,t):t[n]}}),t.Statics&&e.each(t.Statics,function(e,t){r[t]=e}),t.Defaults&&l.Defaults&&(t.Defaults=e.extend({},l.Defaults,t.Defaults));for(c in t)d=t[c],u[c]="function"==typeof d&&l[c]?a(c,d):d;return r.prototype=u,r.constructor=r,r.extend=n,r},t}),i(c,[u,l],function(e,t){return e.extend({Defaults:{firstControlClass:"first",lastControlClass:"last"},init:function(e){this.settings=t.extend({},this.Defaults,e)},preRender:function(e){e.addClass(this.settings.containerClass,"body")},applyClasses:function(e){var t=this,n=t.settings,i,r,o;i=e.items().filter(":visible"),r=n.firstControlClass,o=n.lastControlClass,i.each(function(e){e.removeClass(r).removeClass(o),n.controlClass&&e.addClass(n.controlClass)}),i.eq(0).addClass(r),i.eq(-1).addClass(o)},renderHtml:function(e){var t=this,n=t.settings,i,r="";return i=e.items(),i.eq(0).addClass(n.firstControlClass),i.eq(-1).addClass(n.lastControlClass),i.each(function(e){n.controlClass&&e.addClass(n.controlClass),r+=e.renderHtml()}),r},recalc:function(){},postRender:function(){}})}),i(d,[c],function(e){return e.extend({Defaults:{containerClass:"abs-layout",controlClass:"abs-layout-item"},recalc:function(e){e.items().filter(":visible").each(function(e){var t=e.settings;e.layoutRect({x:t.x,y:t.y,w:t.w,h:t.h}),e.recalc&&e.recalc()})},renderHtml:function(e){return'<div id="'+e._id+'-absend" class="'+e.classPrefix+'abs-end"></div>'+this._super(e)}})}),i(f,[d],function(e){return e.extend({recalc:function(e){function t(e,t,n,i,r){var o=e._marginBox;e.layoutRect({x:t+o.left,y:n+o.top,w:i+o.left+o.right,h:r+o.top+o.bottom,autoResize:!1}),e.recalc&&e.recalc()}var n,i,r,o,a,s,l,u,c,d,f,p,h,m,g,v,y,x,b,w,_;for(n=e.layoutRect(),m=e.paddingBox(),i=n.innerW,r=n.innerH,s=m.left,l=m.top,u=i-(m.right+m.left),c=r-(m.bottom+m.top),d=e.items().filter(":visible"),p=0;p<d.length;p++)f=d[p],w=f.settings,_=f.layoutRect(),h=w.region,o=_.w,a=_.h,o>0&&1>o&&(o=Math.ceil(i*o)),a>0&&1>a&&(a=Math.ceil(r*a)),g=w.minWidth,v=w.minHeight,y=w.maxWidth,x=w.maxHeight,o=g&&g>o?g:o,a=v&&v>a?v:a,o=y&&o>y?y:o,a=x&&a>x?x:a,"north"===h?(t(f,s,l,u,a),l+=a,c-=a):"east"===h?(t(f,i-o-m.right,l,o,c),u-=o):"south"===h?(t(f,s,r-a-m.bottom,u,a),c-=a):"west"===h?(t(f,s,l,o,c),s+=o,u-=o):b=f;if(!b)throw new Error("You must define a center region for border layout.");t(b,s,l,u,c)}})}),i(p,[u,l],function(e,t){function n(e){for(var t=[],n=e.length,i;n--;)i=e[n],i.__checked||(t.push(i),i.__checked=1);for(n=t.length;n--;)delete t[n].__checked;return t}var i=/^([\w\\*]+)?(?:#([\w\\]+))?(?:\.([\w\\\.]+))?(?:\[\@?([\w\\]+)([\^\$\*!~]?=)([\w\\]+)\])?(?:\:(.+))?/i,r=/((?:\((?:\([^()]+\)|[^()]+)+\)|\[(?:\[[^\[\]]*\]|['"][^'"]*['"]|[^\[\]'"]+)+\]|\\.|[^ >+~,(\[\\]+)+|[>+~])(\s*,\s*)?((?:.|\r|\n)*)/g,o=/^\s*|\s*$/g,a,s=e.extend({init:function(e){function t(e){return e?(e=e.toLowerCase(),function(t){return"*"===e||t.type===e}):void 0}function n(e){return e?function(t){return t._name===e}:void 0}function a(e){return e?(e=e.split("."),function(t){for(var n=e.length;n--;)if(!t.hasClass(e[n]))return!1;return!0}):void 0}function s(e,t,n){return e?function(i){var r=i[e]?i[e]():"";return t?"="===t?r===n:"*="===t?r.indexOf(n)>=0:"~="===t?(" "+r+" ").indexOf(" "+n+" ")>=0:"!="===t?r!=n:"^="===t?0===r.indexOf(n):"$="===t?r.substr(r.length-n.length)===n:!1:!!n}:void 0}function l(e){var t;return e?(e=/(?:not\((.+)\))|(.+)/i.exec(e),e[1]?(t=c(e[1],[]),function(e){return!d(e,t)}):(e=e[2],function(t,n,i){return"first"===e?0===n:"last"===e?n===i-1:"even"===e?0===n%2:"odd"===e?1===n%2:t[e]?t[e]():!1})):void 0}function u(e,r,u){function c(e){e&&r.push(e)}var d;return d=i.exec(e.replace(o,"")),c(t(d[1])),c(n(d[2])),c(a(d[3])),c(s(d[4],d[5],d[6])),c(l(d[7])),r.psuedo=!!d[7],r.direct=u,r}function c(e,t){var n=[],i,o,a;do if(r.exec(""),o=r.exec(e),o&&(e=o[3],n.push(o[1]),o[2])){i=o[3];break}while(o);for(i&&c(i,t),e=[],a=0;a<n.length;a++)">"!=n[a]&&e.push(u(n[a],[],">"===n[a-1]));return t.push(e),t}var d=this.match;this._selectors=c(e,[])},match:function(e,n){var i,r,o,a,s,l,u,c,d,f,p,h,m;for(n=n||this._selectors,i=0,r=n.length;r>i;i++){for(s=n[i],a=s.length,m=e,h=0,o=a-1;o>=0;o--)for(c=s[o];m;){for(c.psuedo&&(p=m.parent().items(),d=t.inArray(m,p),f=p.length),l=0,u=c.length;u>l;l++)if(!c[l](m,d,f)){l=u+1;break}if(l===u){h++;break}if(o===a-1)break;m=m.parent()}if(h===a)return!0}return!1},find:function(e){function t(e,n,r){var o,a,s,l,u,c=n[r];for(o=0,a=e.length;a>o;o++){for(u=e[o],s=0,l=c.length;l>s;s++)if(!c[s](u,o,a)){s=l+1;break}if(s===l)r==n.length-1?i.push(u):u.items&&t(u.items(),n,r+1);else if(c.direct)return;u.items&&t(u.items(),n,r)}}var i=[],r,o,l=this._selectors;if(e.items){for(r=0,o=l.length;o>r;r++)t(e.items(),l[r],0);o>1&&(i=n(i))}return a||(a=s.Collection),new a(i)}});return s}),i(h,[l,p,u],function(e,t,n){var i,r,o=Array.prototype.push,a=Array.prototype.slice;return r={length:0,init:function(e){e&&this.add(e)},add:function(t){var n=this;return e.isArray(t)?o.apply(n,t):t instanceof i?n.add(t.toArray()):o.call(n,t),n},set:function(e){var t=this,n=t.length,i;for(t.length=0,t.add(e),i=t.length;n>i;i++)delete t[i];return t},filter:function(e){var n=this,r,o,a=[],s,l;for("string"==typeof e?(e=new t(e),l=function(t){return e.match(t)}):l=e,r=0,o=n.length;o>r;r++)s=n[r],l(s)&&a.push(s);return new i(a)},slice:function(){return new i(a.apply(this,arguments))},eq:function(e){return-1===e?this.slice(e):this.slice(e,+e+1)},each:function(t){return e.each(this,t),this},toArray:function(){return e.toArray(this)},indexOf:function(e){for(var t=this,n=t.length;n--&&t[n]!==e;);return n},reverse:function(){return new i(e.toArray(this).reverse())},hasClass:function(e){return this[0]?this[0].hasClass(e):!1},prop:function(e,t){var n=this,i,r;return t!==i?(n.each(function(n){n[e]&&n[e](t)}),n):(r=n[0],r&&r[e]?r[e]():void 0)},exec:function(t){var n=this,i=e.toArray(arguments).slice(1);return n.each(function(e){e[t]&&e[t].apply(e,i)}),n},remove:function(){for(var e=this.length;e--;)this[e].remove();return this}},e.each("fire on off show hide addClass removeClass append prepend before after reflow".split(" "),function(t){r[t]=function(){var n=e.toArray(arguments);return this.each(function(e){t in e&&e[t].apply(e,n)}),this}}),e.each("text name disabled active selected checked visible parent value data".split(" "),function(e){r[e]=function(t){return this.prop(e,t)}}),i=n.extend(r),t.Collection=i,i}),i(m,[],function(){function e(e,t,n,i){e.addEventListener?e.addEventListener(t,n,i||!1):e.attachEvent&&e.attachEvent("on"+t,n)}function t(e,t,n,i){e.removeEventListener?e.removeEventListener(t,n,i||!1):e.detachEvent&&e.detachEvent("on"+t,n)}function n(e,t){function n(){return!1}function i(){return!0}var r,o=t||{},l;for(r in e)s[r]||(o[r]=e[r]);if(o.target||(o.target=o.srcElement||document),e&&a.test(e.type)&&e.pageX===l&&e.clientX!==l){var u=o.target.ownerDocument||document,c=u.documentElement,d=u.body;o.pageX=e.clientX+(c&&c.scrollLeft||d&&d.scrollLeft||0)-(c&&c.clientLeft||d&&d.clientLeft||0),o.pageY=e.clientY+(c&&c.scrollTop||d&&d.scrollTop||0)-(c&&c.clientTop||d&&d.clientTop||0)}return o.preventDefault=function(){o.isDefaultPrevented=i,e&&(e.preventDefault?e.preventDefault():e.returnValue=!1)},o.stopPropagation=function(){o.isPropagationStopped=i,e&&(e.stopPropagation?e.stopPropagation():e.cancelBubble=!0)},o.stopImmediatePropagation=function(){o.isImmediatePropagationStopped=i,o.stopPropagation()},o.isDefaultPrevented||(o.isDefaultPrevented=n,o.isPropagationStopped=n,o.isImmediatePropagationStopped=n),o}function i(n,i,r){function o(){r.domLoaded||(r.domLoaded=!0,i(u))}function a(){"complete"===l.readyState&&(t(l,"readystatechange",a),o())}function s(){try{l.documentElement.doScroll("left")}catch(e){return setTimeout(s,0),void 0}o()}var l=n.document,u={type:"ready"};l.addEventListener?e(n,"DOMContentLoaded",o):(e(l,"readystatechange",a),l.documentElement.doScroll&&n===n.top&&s()),e(n,"load",o)}function r(){function r(e,t){var n,i,r,o;if(n=s[t][e.type])for(i=0,r=n.length;r>i;i++)if(o=n[i],o&&o.func.call(o.scope,e)===!1&&e.preventDefault(),e.isImmediatePropagationStopped())return}var a=this,s={},l,u,c,d,f;u=o+(+new Date).toString(32),d="onmouseenter"in document.documentElement,c="onfocusin"in document.documentElement,f={mouseenter:"mouseover",mouseleave:"mouseout"},l=1,a.domLoaded=!1,a.events=s,a.bind=function(t,o,p,h){function m(e){r(n(e||E.event),g)}var g,v,y,x,b,w,_,E=window;if(t&&3!==t.nodeType&&8!==t.nodeType){for(t[u]?g=t[u]:(g=l++,t[u]=g,s[g]={}),h=h||t,o=o.split(" "),y=o.length;y--;)x=o[y],w=m,b=_=!1,"DOMContentLoaded"===x&&(x="ready"),a.domLoaded&&"ready"===x?p.call(h,n({type:x})):(d||(b=f[x],b&&(w=function(e){var t,i;if(t=e.currentTarget,i=e.relatedTarget,i&&t.contains)i=t.contains(i);else for(;i&&i!==t;)i=i.parentNode;i||(e=n(e||E.event),e.type="mouseout"===e.type?"mouseleave":"mouseenter",e.target=t,r(e,g))})),c||"focusin"!==x&&"focusout"!==x||(_=!0,b="focusin"===x?"focus":"blur",w=function(e){e=n(e||E.event),e.type="focus"===e.type?"focusin":"focusout",r(e,g)}),v=s[g][x],v?v.push({func:p,scope:h}):(s[g][x]=v=[{func:p,scope:h}],v.fakeName=b,v.capture=_,v.nativeHandler=w,"ready"===x?i(t,w,a):e(t,b||x,w,_)));return t=v=0,p}},a.unbind=function(e,n,i){var r,o,l,c,d,f;if(!e||3===e.nodeType||8===e.nodeType)return a;if(r=e[u]){if(f=s[r],n){for(n=n.split(" "),l=n.length;l--;)if(d=n[l],o=f[d]){if(i)for(c=o.length;c--;)o[c].func===i&&o.splice(c,1);i&&0!==o.length||(delete f[d],t(e,o.fakeName||d,o.nativeHandler,o.capture))}}else{for(d in f)o=f[d],t(e,o.fakeName||d,o.nativeHandler,o.capture);f={}}for(d in f)return a;delete s[r];try{delete e[u]}catch(p){e[u]=null}}return a},a.fire=function(e,t,i){var o,s;if(!e||3===e.nodeType||8===e.nodeType)return a;s=n(null,i),s.type=t;do o=e[u],o&&r(s,o),e=e.parentNode||e.ownerDocument||e.defaultView||e.parentWindow;while(e&&!s.isPropagationStopped());return a},a.clean=function(e){var t,n,i=a.unbind;if(!e||3===e.nodeType||8===e.nodeType)return a;if(e[u]&&i(e),e.getElementsByTagName||(e=e.document),e&&e.getElementsByTagName)for(i(e),n=e.getElementsByTagName("*"),t=n.length;t--;)e=n[t],e[u]&&i(e);return a},a.destory=function(){s={}}}var o="moxman-data-",a=/^(?:mouse|contextmenu)|click/,s={keyLocation:1,layerX:1,layerY:1,returnValue:1};return r}),i(g,[l,m],function(e,n){var i=e.makeMap("fillOpacity fontWeight lineHeight opacity orphans widows zIndex zoom"," "),r=0,o=new n,a={id:function(){return"moxman-"+r++},createFragment:function(e){var t,n,i=document,r;for(r=i.createElement("div"),t=i.createDocumentFragment(),r.innerHTML=e;n=r.firstChild;)t.appendChild(n);return t},getWindowSize:function(){var e,t,n=window,i=document,r=i.body,o=i.documentElement;return r.offsetWidth&&(e=r.offsetWidth,t=r.offsetHeight),"CSS1Compat"==i.compatMode&&o.offsetWidth&&(e=o.offsetWidth,t=o.offsetHeight),n.innerWidth&&n.innerHeight&&(e=n.innerWidth,t=n.innerHeight),{w:e,h:t}},getViewPort:function(e){var t,n;return e=e?e:window,t=e.document,n=this.boxModel?t.documentElement:t.body,{x:e.pageXOffset||n.scrollLeft,y:e.pageYOffset||n.scrollTop,w:e.innerWidth||n.clientWidth,h:e.innerHeight||n.clientHeight}},getDocumentSize:function(){var e=document,t,n,i,r,o,a,s,l,u=Math.max;return t=e.documentElement,n=e.body,i=u(t.scrollWidth,n.scrollWidth),r=u(t.clientWidth,n.clientWidth),o=u(t.offsetWidth,n.offsetWidth),a=u(t.scrollHeight,n.scrollHeight),s=u(t.clientHeight,n.clientHeight),l=u(t.offsetHeight,n.offsetHeight),{width:o>i?r:i,height:l>a?s:a}},getSize:function(e){var t,n,i;return e.getBoundingClientRect?(i=e.getBoundingClientRect(),t=i.right-i.left,n=i.bottom-i.top):(t=e.offsetWidth,n=e.offsetHeight),{width:t,height:n}},getPos:function(e,t){var n,i,r,o,a,s;if(n=i=0,e)if(r=document,o=r.body,t=t||o,e.getBoundingClientRect)s=e.getBoundingClientRect(),e=r.documentElement,n=s.left+(e.scrollLeft||o.scrollLeft)-e.clientTop,i=s.top+(e.scrollTop||o.scrollTop)-e.clientLeft;else{for(a=e;a&&a!=t&&a.nodeType;)n+=a.offsetLeft||0,i+=a.offsetTop||0,a=a.offsetParent;for(a=e.parentNode;a&&a!=t&&a.nodeType;)n-=a.scrollLeft||0,i-=a.scrollTop||0,a=a.parentNode}return{x:n,y:i}},get:function(e){return document.getElementById(e)},addClass:function(e,t){t&&!this.hasClass(e,t)&&(e.className+=e.className?" "+t:t)},removeClass:function(e,t){this.hasClass(e,t)&&(t=e.className.replace(new RegExp("(^|\\s+)"+t+"(\\s+|$)","g")," ")," "===t?e.removeAttribute("class"):e.className=t)},hasClass:function(e,t){return e&&t&&-1!==(" "+e.className+" ").indexOf(" "+t+" ")},toggleClass:function(e,n,i){i=i===t?!this.hasClass(e,n):i,this.hasClass(e,n)!==i&&(i?this.addClass(e,n):this.removeClass(e,n))},attr:function(e,t,n){return"undefined"==typeof n?e.getAttribute(t,n):(e.setAttribute(t,n),void 0)},css:function(e,t,n){var r=e.style,o;if(t)if("string"==typeof t){t=t.replace(/-(\D)/g,function(e,t){return t.toUpperCase()}),"number"!=typeof n||i[t]||(n+="px"),"opacity"===t&&e.runtimeStyle&&"undefined"==typeof e.runtimeStyle.opacity&&(r.filter=""===n?"":"alpha(opacity="+100*n+")");try{r[t]=n}catch(a){}}else for(o in t)this.css(e,o,t[o])},on:function(e,t,n,i){return o.bind(e,t,n,i)},off:function(e,t,n){return o.unbind(e,t,n)},fire:function(e,t,n){return o.fire(e,t,n)},innerHtml:function(e,t){e.innerHTML=t}};return a}),i(v,[u,l,h,g],function(e,t,n,i){var r=t.makeMap("focusin focusout scroll click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave wheel keydown keypress keyup contextmenu"," "),o={},a="onmousewheel"in document,s=!1,l=e.extend({Statics:{controlIdLookup:{}},isRtl:function(){return l.rtl},classPrefix:"moxman-",init:function(e){var n=this,r,o;if(n.settings=e=t.extend({},n.Defaults,e),n._id=i.id(),n._text=n._name="",n._width=n._height=0,n._aria={role:e.role},r=e.classes)for(r=r.split(" "),r.map={},o=r.length;o--;)r.map[r[o]]=!0;n._classes=r||[],n.visible(!0),t.each("title text width height name classes visible disabled active value".split(" "),function(t){var i=e[t],r;i!==r?n[t](i):n["_"+t]===r&&(n["_"+t]=!1)}),n.on("click",function(){return n.disabled()?!1:void 0}),e.classes&&t.each(e.classes.split(" "),function(e){n.addClass(e)}),n.settings=e,n._borderBox=n.parseBox(e.border),n._paddingBox=n.parseBox(e.padding),n._marginBox=n.parseBox(e.margin),e.hidden&&n.hide()},Properties:"parent,title,text,width,height,disabled,active,name,value",Methods:"renderHtml",getContainerElm:function(){return document.body},getParentCtrl:function(e){for(var t;e&&!(t=l.controlIdLookup[e.id]);)e=e.parentNode;return t},parseBox:function(e){var t,n=10;if(e)return"number"==typeof e?(e=e||0,{top:e,left:e,bottom:e,right:e}):(e=e.split(" "),t=e.length,1===t?e[1]=e[2]=e[3]=e[0]:2===t?(e[2]=e[0],e[3]=e[1]):3===t&&(e[3]=e[1]),{top:parseInt(e[0],n)||0,right:parseInt(e[1],n)||0,bottom:parseInt(e[2],n)||0,left:parseInt(e[3],n)||0})},borderBox:function(){return this._borderBox},paddingBox:function(){return this._paddingBox},marginBox:function(){return this._marginBox},measureBox:function(e,t){function n(t){var n=document.defaultView;return n?(t=t.replace(/[A-Z]/g,function(e){return"-"+e}),n.getComputedStyle(e,null).getPropertyValue(t)):e.currentStyle[t]}function i(e){var t=parseFloat(n(e),10);return isNaN(t)?0:t}return{top:i(t+"TopWidth"),right:i(t+"RightWidth"),bottom:i(t+"BottomWidth"),left:i(t+"LeftWidth")}},initLayoutRect:function(){var e=this,t=e.settings,n,r,o=e.getEl(),a,s,l,u,c,d,f,p;n=e._borderBox=e._borderBox||e.measureBox(o,"border"),e._paddingBox=e._paddingBox||e.measureBox(o,"padding"),e._marginBox=e._marginBox||e.measureBox(o,"margin"),p=i.getSize(o),d=t.minWidth,f=t.minHeight,l=d||p.width,u=f||p.height,a=t.width,s=t.height,c=t.autoResize,c="undefined"!=typeof c?c:!a&&!s,a=a||l,s=s||u;var h=n.left+n.right,m=n.top+n.bottom,g=t.maxWidth||65535,v=t.maxHeight||65535;return e._layoutRect=r={x:t.x||0,y:t.y||0,w:a,h:s,deltaW:h,deltaH:m,contentW:a-h,contentH:s-m,innerW:a-h,innerH:s-m,startMinWidth:d||0,startMinHeight:f||0,minW:Math.min(l,g),minH:Math.min(u,v),maxW:g,maxH:v,autoResize:c,scrollW:0},e._lastLayoutRect={},r},layoutRect:function(e){var t=this,n=t._layoutRect,i,r,o,a,s,u;return n||(n=t.initLayoutRect()),e?(o=n.deltaW,a=n.deltaH,e.x!==s&&(n.x=e.x),e.y!==s&&(n.y=e.y),e.minW!==s&&(n.minW=e.minW),e.minH!==s&&(n.minH=e.minH),r=e.w,r!==s&&(r=r<n.minW?n.minW:r,r=r>n.maxW?n.maxW:r,n.w=r,n.innerW=r-o),r=e.h,r!==s&&(r=r<n.minH?n.minH:r,r=r>n.maxH?n.maxH:r,n.h=r,n.innerH=r-a),r=e.innerW,r!==s&&(r=r<n.minW-o?n.minW-o:r,r=r>n.maxW-o?n.maxW-o:r,n.innerW=r,n.w=r+o),r=e.innerH,r!==s&&(r=r<n.minH-a?n.minH-a:r,r=r>n.maxH-a?n.maxH-a:r,n.innerH=r,n.h=r+a),e.contentW!==s&&(n.contentW=e.contentW),e.contentH!==s&&(n.contentH=e.contentH),i=t._lastLayoutRect,(i.x!==n.x||i.y!==n.y||i.w!==n.w||i.h!==n.h)&&(u=l.repaintControls,u&&u.map&&!u.map[t._id]&&(u.push(t),u.map[t._id]=!0),i.x=n.x,i.y=n.y,i.w=n.w,i.h=n.h),t):n},repaint:function(){var e=this,t,n,i,r,o=0,a=0,s;t=e.getEl().style,i=e._layoutRect,s=e._lastRepaintRect||{},r=e._borderBox,o=r.left+r.right,a=r.top+r.bottom,i.x!==s.x&&(t.left=i.x+"px",s.x=i.x),i.y!==s.y&&(t.top=i.y+"px",s.y=i.y),i.w!==s.w&&(t.width=i.w-o+"px",s.w=i.w),i.h!==s.h&&(t.height=i.h-a+"px",s.h=i.h),e._hasBody&&i.innerW!==s.innerW&&(n=e.getEl("body").style,n.width=i.innerW+"px",s.innerW=i.innerW),e._hasBody&&i.innerH!==s.innerH&&(n=n||e.getEl("body").style,n.height=i.innerH+"px",s.innerH=i.innerH),e._lastRepaintRect=s,e.fire("repaint",{},!1)},on:function(e,t){function n(e){var t,n;return function(r){return t||i.parents().each(function(i){var r=i.settings.callbacks;return r&&(t=r[e])?(n=i,!1):void 0}),t.call(n,r)}}var i=this,o,a,s,l;if(t)for("string"==typeof t&&(t=n(t)),s=e.toLowerCase().split(" "),l=s.length;l--;)e=s[l],o=i._bindings,o||(o=i._bindings={}),a=o[e],a||(a=o[e]=[]),a.push(t),r[e]&&(i._nativeEvents?i._nativeEvents[e]=!0:i._nativeEvents={name:!0},i._rendered&&i.bindPendingEvents());return i},off:function(e,t){var n=this,i,r=n._bindings,o,a,s,l;if(r)if(e)for(s=e.toLowerCase().split(" "),i=s.length;i--;){if(e=s[i],o=r[e],!e){for(a in r)r[a].length=0;return n}if(o)if(t)for(l=o.length;l--;)o[l]===t&&o.splice(l,1);else o.length=0}else n._bindings=[];return n},fire:function(e,t,n){function i(){return!1}function r(){return!0}var o=this,a,s,l,u;if(e=e.toLowerCase(),t=t||{},t.type||(t.type=e),t.control||(t.control=o),t.preventDefault||(t.preventDefault=function(){t.isDefaultPrevented=r},t.stopPropagation=function(){t.isPropagationStopped=r},t.stopImmediatePropagation=function(){t.isImmediatePropagationStopped=r},t.isDefaultPrevented=i,t.isPropagationStopped=i,t.isImmediatePropagationStopped=i),o._bindings&&(l=o._bindings[e]))for(a=0,s=l.length;s>a&&(t.isImmediatePropagationStopped()||l[a].call(o,t)!==!1);a++);if(n!==!1)for(u=o.parent();u&&!t.isPropagationStopped();)u.fire(e,t,!1),u=u.parent();return t},hasEventListeners:function(e){return e in this._bindings},parents:function(e){var t=this,i=new n;for(t=t.parent();t;t=t.parent())i.add(t);return e&&(i=i.filter(e)),i},next:function(){var e=this.parent().items();return e[e.indexOf(this)+1]},prev:function(){var e=this.parent().items();return e[e.indexOf(this)-1]},findCommonAncestor:function(e,t){for(var n;e;){for(n=t;n&&e!=n;)n=n.parent();if(e==n)break;e=e.parent()}return e},hasClass:function(e,t){var n=this._classes[t||"control"];return e=this.classPrefix+e,n&&!!n.map[e]},addClass:function(e,t){var n=this,i,r;return e=this.classPrefix+e,i=n._classes[t||"control"],i||(i=[],i.map={},n._classes[t||"control"]=i),i.map[e]||(i.map[e]=e,i.push(e),n._rendered&&(r=n.getEl(t),r&&(r.className=i.join(" ")))),n},removeClass:function(e,t){var n=this,i,r,o;if(e=this.classPrefix+e,i=n._classes[t||"control"],i&&i.map[e])for(delete i.map[e],r=i.length;r--;)i[r]===e&&i.splice(r,1);return n._rendered&&(o=n.getEl(t),o&&(o.className=i.join(" "))),n},toggleClass:function(e,t,n){var i=this;return t?i.addClass(e,n):i.removeClass(e,n),i},classes:function(e){var t=this._classes[e||"control"];return t?t.join(" "):""},innerHtml:function(e){return i.innerHtml(this.getEl(),e),this},getEl:function(e,t){var n,r=e?this._id+"-"+e:this._id;return n=o[r]=(t===!0?null:o[r])||i.get(r)},visible:function(e){var t=this,n;return"undefined"!=typeof e?(t._visible!==e&&(t._rendered&&(t.getEl().style.display=e?"":"none"),t._visible=e,n=t.parent(),n&&(n._lastRect=null),t.fire(e?"show":"hide")),t):t._visible},show:function(){return this.visible(!0)},hide:function(){return this.visible(!1)},focus:function(){try{this.getEl().focus()}catch(e){}return this},blur:function(){return this.getEl().blur(),this},aria:function(e,t){var n=this,i=n.getEl();return"undefined"==typeof t?n._aria[e]:(n._aria[e]=t,n._rendered&&("label"==e&&i.setAttribute("aria-labeledby",n._id),i.setAttribute("role"==e?e:"aria-"+e,t)),n)},encode:function(e,t){return t!==!1&&l.translate&&(e=l.translate(e)),(e||"").replace(/[&<>"]/g,function(e){return"&#"+e.charCodeAt(0)+";"})},before:function(e){var t=this,n=t.parent();return n&&n.insert(e,n.items().indexOf(t),!0),t},after:function(e){var t=this,n=t.parent();return n&&n.insert(e,n.items().indexOf(t)),t},remove:function(){var e=this,t=e.getEl(),n=e.parent(),r,a;if(e.items){var s=e.items().toArray();for(a=s.length;a--;)s[a].remove()}if(n&&n.items&&(r=[],n.items().each(function(t){t!==e&&r.push(t)}),n.items().set(r),n._lastRect=null),e._eventsRoot&&e._eventsRoot==e&&i.off(t),delete l.controlIdLookup[e._id],delete o[e._id],t&&t.parentNode){var u=t.getElementsByTagName("*");for(a=u.length;a--;)delete o[u[a].id];t.parentNode.removeChild(t)}return e},renderBefore:function(e){var t=this;return e.parentNode.insertBefore(i.createFragment(t.renderHtml()),e),t.postRender(),t},renderTo:function(e){var t=this;return e=e||t.getContainerElm(),e.appendChild(i.createFragment(t.renderHtml())),t.postRender(),t},postRender:function(){var e=this,t=e.settings,n,r,o,a,s;for(a in t)0===a.indexOf("on")&&e.on(a.substr(2),t[a]);if(e._eventsRoot){for(o=e.parent();!s&&o;o=o.parent())s=o._eventsRoot;if(s)for(a in s._nativeEvents)e._nativeEvents[a]=!0}e.bindPendingEvents(),t.style&&(n=e.getEl(),n&&(n.setAttribute("style",t.style),n.style.cssText=t.style)),e._visible||i.css(e.getEl(),"display","none"),e.settings.border&&(r=e.borderBox(),i.css(e.getEl(),{"border-top-width":r.top,"border-right-width":r.right,"border-bottom-width":r.bottom,"border-left-width":r.left})),l.controlIdLookup[e._id]=e;for(var u in e._aria)e.aria(u,e._aria[u]);e.fire("postrender",{},!1)},scrollIntoView:function(e){function t(e,t){var n,i,r=e;for(n=i=0;r&&r!=t&&r.nodeType;)n+=r.offsetLeft||0,i+=r.offsetTop||0,r=r.offsetParent;return{x:n,y:i}}var n=this.getEl(),i=n.parentNode,r,o,a,s,l,u,c=t(n,i);return r=c.x,o=c.y,a=n.offsetWidth,s=n.offsetHeight,l=i.clientWidth,u=i.clientHeight,"end"==e?(r-=l-a,o-=u-s):"center"==e&&(r-=l/2-a/2,o-=u/2-s/2),i.scrollLeft=r,i.scrollTop=o,this},bindPendingEvents:function(){function e(e){var t=o.getParentCtrl(e.target);t&&t.fire(e.type,e)}function t(){var e=d._lastHoverCtrl;e&&(e.fire("mouseleave",{target:e.getEl()}),e.parents().each(function(e){e.fire("mouseleave",{target:e.getEl()})}),d._lastHoverCtrl=null)}function n(e){var t=o.getParentCtrl(e.target),n=d._lastHoverCtrl,i=0,r,a,s;if(t!==n){if(d._lastHoverCtrl=t,a=t.parents().toArray().reverse(),a.push(t),n){for(s=n.parents().toArray().reverse(),s.push(n),i=0;i<s.length&&a[i]===s[i];i++);for(r=s.length-1;r>=i;r--)n=s[r],n.fire("mouseleave",{target:n.getEl()})}for(r=i;r<a.length;r++)t=a[r],t.fire("mouseenter",{target:t.getEl()})}}function r(e){e.preventDefault(),"mousewheel"==e.type?(e.deltaY=-1/40*e.wheelDelta,e.wheelDeltaX&&(e.deltaX=-1/40*e.wheelDeltaX)):(e.deltaX=0,e.deltaY=e.detail),e=o.fire("wheel",e)}var o=this,l,u,c,d,f,p;if(o._rendered=!0,f=o._nativeEvents){for(c=o.parents().toArray(),c.unshift(o),l=0,u=c.length;!d&&u>l;l++)d=c[l]._eventsRoot;for(d||(d=c[c.length-1]||o),o._eventsRoot=d,u=l,l=0;u>l;l++)c[l]._eventsRoot=d;for(p in f){if(!f)return!1;"wheel"!==p||s?("mouseenter"===p||"mouseleave"===p?d._hasMouseEnter||(i.on(d.getEl(),"mouseleave",t),i.on(d.getEl(),"mouseover",n),d._hasMouseEnter=1):d[p]||(i.on(d.getEl(),p,e),d[p]=!0),f[p]=!1):a?i.on(o.getEl(),"mousewheel",r):i.on(o.getEl(),"DOMMouseScroll",r)}}},reflow:function(){return this.repaint(),this}});return l}),i(y,[g],function(e){function t(t,n,i){var r,o,a,s,l,u,c,d,f,p;return f=e.getViewPort(),o=e.getPos(n),a=o.x,s=o.y,t._fixed&&(a-=f.x,s-=f.y),r=t.getEl(),p=e.getSize(r),l=p.width,u=p.height,p=e.getSize(n),c=p.width,d=p.height,i=(i||"").split(""),"b"===i[0]&&(s+=d),"r"===i[1]&&(a+=c),"c"===i[0]&&(s+=Math.round(d/2)),"c"===i[1]&&(a+=Math.round(c/2)),"b"===i[3]&&(s-=u),"r"===i[4]&&(a-=l),"c"===i[3]&&(s-=Math.round(u/2)),"c"===i[4]&&(a-=Math.round(l/2)),{x:a,y:s,w:l,h:u}}return{testMoveRel:function(n,i){for(var r=e.getViewPort(),o=0;o<i.length;o++){var a=t(this,n,i[o]);if(this._fixed){if(a.x>0&&a.x+a.w<r.w&&a.y>0&&a.y+a.h<r.h)return i[o]}else if(a.x>r.x&&a.x+a.w<r.w+r.x&&a.y>r.y&&a.y+a.h<r.h+r.y)return i[o]}return i[0]},moveRel:function(e,n){"string"!=typeof n&&(n=this.testMoveRel(e,n));var i=t(this,e,n);return this.moveTo(i.x,i.y)},moveBy:function(e,t){var n=this,i=n.layoutRect();return n.moveTo(i.x+e,i.y+t),n},moveTo:function(t,n){function i(e,t,n){return 0>e?0:e+n>t?(e=t-n,0>e?0:e):e}var r=this;if(r.settings.constrainToViewport){var o=e.getViewPort(window),a=r.layoutRect();t=i(t,o.w+o.x,a.w),n=i(n,o.h+o.y,a.h)}return r._rendered?r.layoutRect({x:t,y:n}).repaint():(r.settings.x=t,r.settings.y=n),r.fire("move",{x:t,y:n}),r}}}),i(x,[v,y],function(e,t){return e.extend({Mixins:[t],Defaults:{classes:"widget tooltip tooltip-n"},text:function(e){var t=this;return"undefined"!=typeof e?(t._value=e,t._rendered&&(t.getEl().lastChild.innerHTML=t.encode(e)),t):t._value},renderHtml:function(){var e=this,t=e.classPrefix;return'<div id="'+e._id+'" class="'+e.classes()+'" role="presentation">'+'<div class="'+t+'tooltip-arrow"></div>'+'<div class="'+t+'tooltip-inner">'+e.encode(e._text)+"</div>"+"</div>"},repaint:function(){var e=this,t,n;t=e.getEl().style,n=e._layoutRect,t.left=n.x+"px",t.top=n.y+"px",t.zIndex=131070}})}),i(b,[v,x],function(e,t){var n,i=e.extend({init:function(e){var t=this;t._super(e),t.canFocus=!0,e.tooltip&&i.tooltips!==!1&&t.on("mouseenter mouseleave",function(n){var i=t.tooltip().moveTo(-65535);if(n.control==t&&"mouseenter"==n.type){var r=i.text(e.tooltip).show().testMoveRel(t.getEl(),["bc-tc","bc-tl","bc-tr"]);
i.toggleClass("tooltip-n","bc-tc"==r),i.toggleClass("tooltip-nw","bc-tl"==r),i.toggleClass("tooltip-ne","bc-tr"==r),i.moveRel(t.getEl(),r)}else i.hide()}),t.aria("label",e.tooltip)},tooltip:function(){var e=this;return n||(n=new t({type:"tooltip"}),n.renderTo(e.getContainerElm())),n},active:function(e){var t=this,n;return e!==n&&(t.aria("pressed",e),t.toggleClass("active",e)),t._super(e)},disabled:function(e){var t=this,n;return e!==n&&(t.aria("disabled",e),t.toggleClass("disabled",e)),t._super(e)},postRender:function(){var e=this,t=e.settings;e._rendered=!0,e._super(),e.parent()||!t.width&&!t.height||(e.initLayoutRect(),e.repaint()),t.autofocus&&setTimeout(function(){e.focus()},0)},remove:function(){this._super(),n&&(n.remove(),n=null)}});return i}),i(w,[b],function(e){return e.extend({Defaults:{classes:"widget btn",role:"button"},init:function(e){var t=this,n;t.on("click mousedown",function(e){e.preventDefault()}),t._super(e),n=e.size,e.subtype&&t.addClass(e.subtype),n&&t.addClass("btn-"+n)},repaint:function(){var e=this.getEl().firstChild.style;e.width=e.height="100%",this._super()},renderHtml:function(){var e=this,t=e._id,n=e.classPrefix,i=e.settings.icon,r="";return e.settings.image&&(i="none",r=" style=\"background-image: url('"+e.settings.image+"')\""),i=e.settings.icon?n+"ico "+n+"i-"+i:"",'<div id="'+t+'" class="'+e.classes()+'" tabindex="-1">'+'<button role="presentation" type="button" tabindex="-1">'+(i?'<i class="'+i+'"'+r+"></i>":"")+(e._text?(i?"\xa0":"")+e.encode(e._text):"")+"</button>"+"</div>"}})}),i(_,[],function(){var e={},t;return{add:function(t,n){e[t.toLowerCase()]=n},has:function(t){return!!e[t.toLowerCase()]},create:function(n,i){var r,o,a;if(!t){a=moxman.ui;for(o in a)e[o.toLowerCase()]=a[o];t=!0}if("string"==typeof n?(i=i||{},i.type=n):(i=n,n=i.type),n=n.toLowerCase(),r=e[n],!r)throw new Error("Could not find control by type: "+n);return r=new r(i),r.type=n,r}}}),i(E,[v,h,p,_,l,g],function(e,t,n,i,r,o){var a={};return e.extend({layout:"",innerClass:"container-inner",init:function(e){var n=this;n._super(e),e=n.settings,n._fixed=e.fixed,n._items=new t,n.isRtl()&&n.addClass("rtl"),n.addClass("container"),n.addClass("container-body","body"),e.containerCls&&n.addClass(e.containerCls),n._layout=i.create((e.layout||n.layout)+"layout"),n.settings.items&&n.add(n.settings.items),n._hasBody=!0},items:function(){return this._items},find:function(e){return e=a[e]=a[e]||new n(e),e.find(this)},add:function(e){var t=this;return t.items().add(t.create(e)).parent(t),t},focus:function(){var e=this;return e.keyNav?e.keyNav.focusFirst():e._super(),e},replace:function(e,t){for(var n,i=this.items(),r=i.length;r--;)if(i[r]===e){i[r]=t;break}r>=0&&(n=t.getEl(),n&&n.parentNode.removeChild(n),n=e.getEl(),n&&n.parentNode.removeChild(n)),t.parent(this)},create:function(t){var n=this,o,a=[];return r.isArray(t)||(t=[t]),r.each(t,function(t){t&&(t instanceof e||("string"==typeof t&&(t={type:t}),o=r.extend({},n.settings.defaults,t),t.type=o.type=o.type||t.type||n.settings.defaultType||(o.defaults?o.defaults.type:null),t=i.create(o)),a.push(t))}),a},renderNew:function(){var e=this;return e.items().each(function(t,n){var i,r;t.parent(e),t._rendered||(i=e.getEl("body"),r=o.createFragment(t.renderHtml()),i.hasChildNodes()&&n<=i.childNodes.length-1?i.insertBefore(r,i.childNodes[n]):i.appendChild(r),t.postRender())}),e._layout.applyClasses(e),e._lastRect=null,e},append:function(e){return this.add(e).renderNew()},prepend:function(e){var t=this;return t.items().set(t.create(e).concat(t.items().toArray())),t.renderNew()},insert:function(e,t,n){var i=this,r,o,a;return e=i.create(e),r=i.items(),!n&&t<r.length-1&&(t+=1),t>=0&&t<r.length&&(o=r.slice(0,t).toArray(),a=r.slice(t).toArray(),r.set(o.concat(e,a))),i.renderNew()},fromJSON:function(e){var t=this;for(var n in e)t.find("#"+n).value(e[n]);return t},toJSON:function(){var e=this,t={};return e.find("*").each(function(e){var n=e.name(),i=e.value();n&&"undefined"!=typeof i&&(t[n]=i)}),t},preRender:function(){},renderHtml:function(){var e=this,t=e._layout;return e.preRender(),t.preRender(e),'<div id="'+e._id+'" class="'+e.classes()+'" role="'+this.settings.role+'">'+'<div id="'+e._id+'-body" class="'+e.classes("body")+'">'+(e.settings.html||"")+t.renderHtml(e)+"</div>"+"</div>"},postRender:function(){var e=this,t;return e.items().exec("postRender"),e._super(),e._layout.postRender(e),e._rendered=!0,e.settings.style&&o.css(e.getEl(),e.settings.style),e.settings.border&&(t=e.borderBox(),o.css(e.getEl(),{"border-top-width":t.top,"border-right-width":t.right,"border-bottom-width":t.bottom,"border-left-width":t.left})),e},initLayoutRect:function(){var e=this,t=e._super();return e._layout.recalc(e),t},recalc:function(){var e=this,t=e._layoutRect,n=e._lastRect;return n&&n.w==t.w&&n.h==t.h?void 0:(e._layout.recalc(e),t=e.layoutRect(),e._lastRect={x:t.x,y:t.y,w:t.w,h:t.h},!0)},reflow:function(){var t,n;if(this.visible()){for(e.repaintControls=[],e.repaintControls.map={},n=this.recalc(),t=e.repaintControls.length;t--;)e.repaintControls[t].repaint();"flow"!==this.settings.layout&&"stack"!==this.settings.layout&&this.repaint(),e.repaintControls=[]}return this}})}),i(C,[E],function(e){return e.extend({Defaults:{defaultType:"button",role:"toolbar"},renderHtml:function(){var e=this,t=e._layout;return e.addClass("btn-group"),e.preRender(),t.preRender(e),'<div id="'+e._id+'" class="'+e.classes()+'">'+'<div id="'+e._id+'-body">'+(e.settings.html||"")+t.renderHtml(e)+"</div>"+"</div>"}})}),i(R,[b],function(e){return e.extend({Defaults:{classes:"carousel",checked:!1},init:function(e){var t=this;t._super(e),t._data=e.data,t._index=0,t._first=!0,t.on("click",function(e){var n=e.target.className;-1!=n.indexOf("prev")&&t.prev(),-1!=n.indexOf("next")&&t.next()})},data:function(e){this._data=e},index:function(e,t){function n(e){var n,r=i.getEl("view");r.firstChild&&r.removeChild(r.firstChild),n=new Image,n.id=i._id+"-img",n.className=i.classPrefix+"object",n.onload=function(){window.setTimeout(function(){var e=50,o=r.clientWidth-e,a=r.clientHeight-e,s=n.clientWidth,l=n.clientHeight,u=Math.min(o/s,a/l);1>u&&(s*=u,l*=u,n.style.width=s+"px",n.style.height=l+"px"),n.style.left=e/2+(o/2-s/2)+"px",n.style.top=e/2+(a/2-l/2)+"px",n.style.visibility="visible",i._first=!i._first,t&&t()},0)},n.style.width=n.style.height="",n.src=e,r.appendChild(n)}var i=this;return"undefined"!=typeof e?(e>=0&&e<=this._data.length-1&&(i.getEl().firstChild.style.display=e>0?"block":"none",i.getEl().childNodes[1].style.display=e<i._data.length-1?"block":"none",n(this._data[e].url),i.fire("change",{index:e,lastIndex:i._index}),i._index=e),i):i._index},prev:function(){this.index(this.index()-1)},next:function(){this.index(this.index()+1)},postRender:function(){var e=this;e._super(),e.index(e.settings.selectedIndex||0)},renderHtml:function(){var e=this,t=e._id,n=e.classPrefix;return'<div id="'+t+'" class="'+e.classes()+'">'+'<div class="'+n+"dir "+n+'prev" unselectable="true">&lsaquo;</div>'+'<div class="'+n+"dir "+n+'next" unselectable="true">&rsaquo;</div>'+'<div id="'+t+'-view" class="'+n+'view"></div>'+"</div>"}})}),i(T,[b],function(e){return e.extend({Defaults:{classes:"checkbox",role:"checkbox",checked:!1},init:function(e){var t=this;t._super(e),t.on("click mousedown",function(e){e.preventDefault()}),t.on("click",function(e){e.preventDefault(),t.disabled()||t.checked(!t.checked())}),t.checked(t.settings.checked)},checked:function(e){var t=this;return"undefined"!=typeof e?(e?t.addClass("checked"):t.removeClass("checked"),t._checked=e,t.aria("checked",e),t):t._checked},value:function(e){return this.checked(e)},renderHtml:function(){var e=this,t=e._id,n=e.classPrefix;return'<div id="'+t+'" class="'+e.classes()+'" unselectable="on" aria-labeledby="'+t+'-al" tabindex="-1">'+'<i class="'+n+"ico "+n+'i-checkbox"></i>'+'<span id="'+t+'-al" class="'+n+'label">'+e.encode(e._text)+"</span>"+"</div>"}})}),i(A,[E],function(e){return e.extend({})}),i(S,[b,g],function(e,t){return e.extend({init:function(e){var n=this;n._super(e),n.addClass("combobox"),n.on("click",function(e){for(var t=e.target;t;)t.id&&-1!=t.id.indexOf("-open")&&n.fire("action"),t=t.parentNode}),n.on("keydown",function(e){"INPUT"==e.target.nodeName&&13==e.keyCode&&n.parents().reverse().each(function(t){return e.preventDefault(),n.fire("change"),t.hasEventListeners("submit")&&t.toJSON?(t.fire("submit",{data:t.toJSON()}),!1):void 0})}),e.placeholder&&(n.addClass("placeholder"),n.on("focusin",function(){n._hasOnChange||(t.on(n.getEl("inp"),"change",function(){n.fire("change")}),n._hasOnChange=!0),n.hasClass("placeholder")&&(n.getEl("inp").value="",n.removeClass("placeholder"))}),n.on("focusout",function(){0===n.value().length&&(n.getEl("inp").value=e.placeholder,n.addClass("placeholder"))}))},value:function(e){var t=this;return"undefined"!=typeof e?(t._value=e,t.removeClass("placeholder"),t._rendered&&(t.getEl("inp").value=e),t):t._rendered?(e=t.getEl("inp").value,e!=t.settings.placeholder?e:""):t._value},disabled:function(e){var t=this;return t._rendered&&"undefined"!=typeof e&&(t.getEl("inp").disabled=e),t._super(e)},focus:function(){this.getEl("inp").focus()},repaint:function(){var e=this,n=e.getEl(),i=e.getEl("open"),r=e.layoutRect(),o,a;o=i?r.w-t.getSize(i).width-10:r.w-10;var s=document;return s.all&&(!s.documentMode||s.documentMode<=8)&&(a=e.layoutRect().h-2+"px"),t.css(n.firstChild,{width:o,lineHeight:a}),e._super(),e},postRender:function(){var e=this;return t.on(this.getEl("inp"),"change",function(){e.fire("change")}),e._super()},remove:function(){t.off(this.getEl("inp")),this._super()},renderHtml:function(){var e=this,t=e._id,n=e.settings,i=e.classPrefix,r=n.value||n.placeholder||"",o,a,s="";return o=n.icon?i+"ico "+i+"i-"+n.icon:"",a=e._text,(o||a)&&(s='<div id="'+t+'-open" class="'+i+"btn "+i+'open" tabIndex="-1">'+'<button id="'+t+'-action" type="button" hidefocus tabindex="-1">'+(o?'<i class="'+o+'"></i>':'<i class="'+i+'caret"></i>')+(a?(o?" ":"")+a:"")+"</button>"+"</div>",e.addClass("has-open")),'<div id="'+t+'" class="'+e.classes()+'">'+'<input id="'+t+'-inp" class="'+i+"textbox "+i+'placeholder" value="'+r+'" hidefocus="true"'+(e.disabled()?' disabled="disabled"':"")+">"+s+"</div>"}})}),i(D,[g],function(e){function t(){var e=document,t,n,i,r,o,a,s,l,u=Math.max;return t=e.documentElement,n=e.body,i=u(t.scrollWidth,n.scrollWidth),r=u(t.clientWidth,n.clientWidth),o=u(t.offsetWidth,n.offsetWidth),a=u(t.scrollHeight,n.scrollHeight),s=u(t.clientHeight,n.clientHeight),l=u(t.offsetHeight,n.offsetHeight),{width:o>i?r:i,height:l>a?s:a}}return function(n,i){function r(){return a.getElementById(i.handle||n)}var o,a=document,s,l,u,c,d,f;i=i||{},l=function(n){var l=t(),p,h;n.preventDefault(),s=n.button,p=r(),d=n.screenX,f=n.screenY,h=window.getComputedStyle?window.getComputedStyle(p,null).getPropertyValue("cursor"):p.runtimeStyle.cursor,o=a.createElement("div"),e.css(o,{position:"absolute",top:0,left:0,width:l.width,height:l.height,zIndex:2147483647,opacity:1e-4,background:"red",cursor:h}),a.body.appendChild(o),e.on(a,"mousemove",c),e.on(a,"mouseup",u),i.start(n)},c=function(e){return e.button!==s?u(e):(e.deltaX=e.screenX-d,e.deltaY=e.screenY-f,e.preventDefault(),i.drag(e),void 0)},u=function(t){e.off(a,"mousemove",c),e.off(a,"mouseup",u),o.parentNode.removeChild(o),i.stop&&i.stop(t)},this.destroy=function(){e.off(r())},e.on(r(),"mousedown",l)}}),i(k,[E],function(e){return e.extend({Defaults:{layout:"flex",align:"center",defaults:{flex:1}},renderHtml:function(){var e=this,t=e._layout,n=e.classPrefix;return e.addClass("formitem"),t.preRender(e),'<div id="'+e._id+'" class="'+e.classes()+'" hideFocus="1" tabIndex="-1">'+(e.settings.title?'<div id="'+e._id+'-title" class="'+n+'title">'+e.settings.title+"</div>":"")+'<div id="'+e._id+'-body" class="'+e.classes("body")+'">'+(e.settings.html||"")+t.renderHtml(e)+"</div>"+"</div>"}})}),i(I,[E,k],function(e,t){return e.extend({Defaults:{containerCls:"form",layout:"flex",direction:"column",align:"stretch",flex:1,padding:20,labelGap:30,spacing:10,callbacks:{submit:function(){this.submit()}}},preRender:function(){var e=this,n=e.items();n.each(function(n){var i,r=n.settings.label;r&&(i=new t({layout:"flex",autoResize:"overflow",defaults:{flex:1},items:[{type:"label",text:r,flex:0,forId:n._id}]}),i.type="formitem","undefined"==typeof n.settings.flex&&(n.settings.flex=1),e.replace(n,i),i.add(n))})},recalcLabels:function(){var e=this,t=0,n=[],i,r;if(e.settings.labelGapCalc!==!1)for(e.items().filter("formitem").each(function(e){var i=e.items()[0],r=i.getEl().clientWidth;t=r>t?r:t,n.push(i)}),r=e.settings.labelGap||0,i=n.length;i--;)n[i].settings.minWidth=t+r},visible:function(e){var t=this._super(e);return e===!0&&this._rendered&&this.recalcLabels(),t},submit:function(){return this.fire("submit",{data:this.toJSON()})},postRender:function(){var e=this;e._super(),e.recalcLabels(),e.fromJSON(e.settings.data)}})}),i(N,[I],function(e){return e.extend({Defaults:{containerCls:"fieldset",layout:"flex",direction:"column",align:"stretch",flex:1,padding:"25 15 5 15",labelGap:30,spacing:10,border:1},renderHtml:function(){var e=this,t=e._layout,n=e.classPrefix;return e.preRender(),t.preRender(e),'<fieldset id="'+e._id+'" class="'+e.classes()+'" hideFocus="1" tabIndex="-1">'+(e.settings.title?'<legend id="'+e._id+'-title" class="'+n+'fieldset-title">'+e.settings.title+"</legend>":"")+'<div id="'+e._id+'-body" class="'+e.classes("body")+'">'+(e.settings.html||"")+t.renderHtml(e)+"</div>"+"</fieldset>"}})}),i(M,[d],function(e){return e.extend({recalc:function(e){var t=e.layoutRect(),n=e.paddingBox();e.items().filter(":visible").each(function(e){e.layoutRect({x:n.left,y:n.top,w:t.innerW-n.right-n.left,h:t.innerH-n.top-n.bottom}),e.recalc&&e.recalc()})}})}),i(F,[d],function(e){return e.extend({recalc:function(e){var t,n,i,r,o,a,s,l,u,c,d,f,p,h,m,g,v=[],y,x,b,w,_,E,C,R,T,A,S,D,k,I,N,M,F,H,P,O,L,z,W,B,U=Math.max,j=Math.min;for(i=e.items().filter(":visible"),r=e.layoutRect(),o=e._paddingBox,a=e.settings,f=e.isRtl()?a.direction||"row-reversed":a.direction,s=a.align,l=e.isRtl()?a.pack||"end":a.pack,u=a.spacing||0,("row-reversed"==f||"column-reverse"==f)&&(i=i.set(i.toArray().reverse()),f=f.split("-")[0]),"column"==f?(T="y",C="h",R="minH",A="maxH",D="innerH",S="top",k="bottom",I="deltaH",N="contentH",L="left",H="w",M="x",F="innerW",P="minW",O="maxW",z="right",W="deltaW",B="contentW"):(T="x",C="w",R="minW",A="maxW",D="innerW",S="left",k="right",I="deltaW",N="contentW",L="top",H="h",M="y",F="innerH",P="minH",O="maxH",z="bottom",W="deltaH",B="contentH"),d=r[D]-o[S]-o[S],E=c=0,t=0,n=i.length;n>t;t++)p=i[t],h=p.layoutRect(),m=p.settings,g=m.flex,d-=n-1>t?u:0,g>0&&(c+=g,h[A]&&v.push(p),h.flex=g),d-=h[R],y=o[L]+h[P]+o[z],y>E&&(E=y);if(w={},w[R]=0>d?r[R]-d+r[I]:r[D]-d+r[I],w[P]=E+r[W],w[N]=r[D]-d,w[B]=E,w.minW=j(w.minW,r.maxW),w.minH=j(w.minH,r.maxH),w.minW=U(w.minW,r.startMinWidth),w.minH=U(w.minH,r.startMinHeight),!r.autoResize||w.minW==r.minW&&w.minH==r.minH){for(b=d/c,t=0,n=v.length;n>t;t++)p=v[t],h=p.layoutRect(),x=h[A],y=h[R]+Math.ceil(h.flex*b),y>x?(d-=h[A]-h[R],c-=h.flex,h.flex=0,h.maxFlexSize=x):h.maxFlexSize=0;for(b=d/c,_=o[S],w={},0===c&&("end"==l?_=d+o[S]:"center"==l?(_=Math.round(r[D]/2-(r[D]-d)/2)+o[S],0>_&&(_=o[S])):"justify"==l&&(_=o[S],u=Math.floor(d/(i.length-1)))),w[M]=o[L],t=0,n=i.length;n>t;t++)p=i[t],h=p.layoutRect(),y=h.maxFlexSize||h[R],"center"===s?w[M]=Math.round(r[F]/2-h[H]/2):"stretch"===s?(w[H]=U(h[P]||0,r[F]-o[L]-o[z]),w[M]=o[L]):"end"===s&&(w[M]=r[F]-h[H]-o.top),h.flex>0&&(y+=Math.ceil(h.flex*b)),w[C]=y,w[T]=_,p.layoutRect(w),p.recalc&&p.recalc(),_+=y+u}else if(w.w=w.minW,w.h=w.minH,e.layoutRect(w),this.recalc(e),null===e._lastRect){var q=e.parent();q&&(q._lastRect=null,q.recalc())}}})}),i(H,[g,D],function(e,t){return{init:function(){var e=this;e.on("repaint",e.renderScroll)},renderScroll:function(){function n(){function t(t,a,s,l,u,c){var d,f,p,h,m,g,v,y,x;if(f=r.getEl("scroll"+t)){if(y=a.toLowerCase(),x=s.toLowerCase(),r.getEl("absend")&&e.css(r.getEl("absend"),y,r.layoutRect()[l]-1),!u)return e.css(f,"display","none"),void 0;e.css(f,"display","block"),d=r.getEl("body"),p=r.getEl("scroll"+t+"t"),h=d["client"+s]-2*o,h-=n&&i?f["client"+c]:0,m=d["scroll"+s],g=h/m,v={},v[y]=d["offset"+a]+o,v[x]=h,e.css(f,v),v={},v[y]=d["scroll"+a]*g,v[x]=h*g,e.css(p,v)}}var n,i,a;a=r.getEl("body"),n=a.scrollWidth>a.clientWidth,i=a.scrollHeight>a.clientHeight,t("h","Left","Width","contentW",n,"Height"),t("v","Top","Height","contentH",i,"Width")}function i(){function n(n,i,a,s,l){var u,c=r._id+"-scroll"+n,d=r.classPrefix;r.getEl().appendChild(e.createFragment('<div id="'+c+'" class="'+d+"scrollbar "+d+"scrollbar-"+n+'">'+'<div id="'+c+'t" class="'+d+'scrollbar-thumb"></div>'+"</div>")),r.draghelper=new t(c+"t",{start:function(){u=r.getEl("body")["scroll"+i],e.addClass(e.get(c),d+"active")},drag:function(e){var t,c,d,f,p=r.layoutRect();c=p.contentW>p.innerW,d=p.contentH>p.innerH,f=r.getEl("body")["client"+a]-2*o,f-=c&&d?r.getEl("scroll"+n)["client"+l]:0,t=f/r.getEl("body")["scroll"+a],r.getEl("body")["scroll"+i]=u+e["delta"+s]/t},stop:function(){e.removeClass(e.get(c),d+"active")}})}r.addClass("scroll"),n("v","Top","Height","Y","Width"),n("h","Left","Width","X","Height")}var r=this,o=2;r.settings.autoScroll&&(r._hasScroll||(r._hasScroll=!0,i(),r.on("wheel",function(e){var t=r.getEl("body");t.scrollLeft+=10*(e.deltaX||0),t.scrollTop+=10*e.deltaY,n()}),e.on(r.getEl("body"),"scroll",n)),n())}}}),i(P,[E,H],function(e,t){return e.extend({Defaults:{layout:"fit",containerCls:"panel"},Mixins:[t],renderHtml:function(){var e=this,t=e._layout,n=e.settings.html;return e.preRender(),t.preRender(e),"undefined"==typeof n?n='<div id="'+e._id+'-body" class="'+e.classes("body")+'">'+t.renderHtml(e)+"</div>":("function"==typeof n&&(n=n.call(e)),e._hasBody=!1),'<div id="'+e._id+'" class="'+e.classes()+'" hideFocus="1" tabIndex="-1">'+(e._preBodyHtml||"")+n+"</div>"}})}),i(O,[g],function(e){return{resizeToContent:function(){this._layoutRect.autoResize=!0,this._lastRect=null,this.reflow()},resizeTo:function(t,n){if(1>=t||1>=n){var i=e.getWindowSize();t=1>=t?t*i.w:t,n=1>=n?n*i.h:n}return this._layoutRect.autoResize=!1,this.layoutRect({minW:t,minH:n,w:t,h:n}).reflow()},resizeBy:function(e,t){var n=this,i=n.layoutRect();return n.resizeTo(i.w+e,i.h+t)}}}),i(L,[P,y,O,g],function(e,t,n,i){function r(e){var t;for(t=s.length;t--;)s[t]===e&&s.splice(t,1);for(t=l.length;t--;)l[t]===e&&l.splice(t,1)}var o,a,s=[],l=[],u,c=e.extend({Mixins:[t,n],init:function(e){function t(){var e,t=c.zIndex||65535,n;if(l.length)for(e=0;e<l.length;e++)l[e].modal&&(t++,n=l[e]),l[e].getEl().style.zIndex=t,l[e].zIndex=t,t++;var r=document.getElementById(d.classPrefix+"modal-block");n?i.css(r,"z-index",n.zIndex-1):r&&(r.parentNode.removeChild(r),u=!1),c.currentZIndex=t}function n(e,t){for(;e;){if(e==t)return!0;e=e.parent()}}function r(e){function t(t,n){for(var i,r=0;r<s.length;r++)if(s[r]!=e)for(i=s[r].parent();i&&(i=i.parent());)i==e&&s[r].fixed(t).moveBy(0,n).repaint()}var n=i.getViewPort().y;e.settings.autofix&&(e._fixed?e._autoFixY>n&&(e.fixed(!1).layoutRect({y:e._autoFixY}).repaint(),t(!1,e._autoFixY-n)):(e._autoFixY=e.layoutRect().y,e._autoFixY<n&&(e.fixed(!0).layoutRect({y:0}).repaint(),t(!0,n-e._autoFixY))))}var d=this;d._super(e),d._eventsRoot=d,d.addClass("floatpanel"),e.autohide&&(o||(o=function(e){var t,i=d.getParentCtrl(e.target);for(t=s.length;t--;){var r=s[t];if(r.settings.autohide){if(i&&(n(i,r)||r.parent()===i))continue;e=r.fire("autohide",{target:e.target}),e.isDefaultPrevented()||r.hide()}}},i.on(document,"click",o)),s.push(d)),e.autofix&&(a||(a=function(){var e;for(e=s.length;e--;)r(s[e])},i.on(window,"scroll",a)),d.on("move",function(){r(this)})),d.on("postrender show",function(e){if(e.control==d){var n,r=d.classPrefix;d.modal&&!u&&(n=i.createFragment('<div id="'+r+'modal-block" class="'+r+"reset "+r+'fade"></div>'),n=n.firstChild,d.getContainerElm().appendChild(n),setTimeout(function(){i.addClass(n,r+"in"),i.addClass(d.getEl(),r+"in")},0),u=!0),l.push(d),t()}}),d.on("close hide",function(e){if(e.control==d){for(var n=l.length;n--;)l[n]===d&&l.splice(n,1);t()}}),d.on("show",function(){d.parents().each(function(e){return e._fixed?(d.fixed(!0),!1):void 0})}),e.popover&&(d._preBodyHtml='<div class="'+d.classPrefix+'arrow"></div>',d.addClass("popover").addClass("bottom").addClass(d.isRtl()?"end":"start"))},fixed:function(e){var t=this;if(t._fixed!=e){if(t._rendered){var n=i.getViewPort();e?t.layoutRect().y-=n.y:t.layoutRect().y+=n.y}t.toggleClass("fixed",e),t._fixed=e}return t},show:function(){var e=this,t,n=e._super();for(t=s.length;t--&&s[t]!==e;);return-1===t&&s.push(e),n},hide:function(){return r(this),this._super()},hideAll:function(){c.hideAll()},close:function(){var e=this;return e.fire("close"),e.remove()},remove:function(){r(this),this._super()}});return c.hideAll=function(){for(var e=s.length;e--;){var t=s[e];t.settings.autohide&&(t.fire("cancel",{},!1),t.hide(),s.splice(e,1))}},c}),i(z,[c],function(e){return e.extend({Defaults:{containerClass:"flow-layout",controlClass:"flow-layout-item",endClass:"break"},recalc:function(e){e.items().filter(":visible").each(function(e){e.recalc&&e.recalc()})}})}),i(W,[b,g],function(e,t){function n(){}return e.extend({Defaults:{minWidth:1},init:function(e){var t=this;t._super(e),t._sortBy=e.sortBy,t._sortOrder="asc"===e.sortDir,t._selected=[],t._data=[]},clear:function(){var e=this.getEl("tbody",!0);for(this._data=[],this._selected=[];e.firstChild;)e.removeChild(e.firstChild);return this},postRender:function(){var e=this,n=e.settings,i=e.classPrefix;e._super(),e.on("keyup",function(t){var n=t.keyCode;27==n&&e.cancelEdit(),13==n&&e.applyEdit()}),e.on("focusout",function(t){"text"==t.target.type&&e.cancelEdit()}),e.on("click",function(r){function o(e){for(var t=e.parentNode.childNodes,n=t.length;n--;)if(t[n]===e)return n;return-1}var a=r.target,s,l,u,c,d,f,p,h;do if(t.hasClass(a,i+"grid-cell")&&(p=!0),"TD"==a.nodeName){s=a;break}while(a=a.parentNode);if(s)if(f=n.columns,l=o(s),u=o(s.parentNode),d=f[l],t.hasClass(s,i+"grid-head-item"))d.sorting!==!1&&(h=e._sortOrder,h===e._sortOrder&&(h=e._sortBy==d.name?!h:!0),e._sortBy=d.name,e._sortOrder=h,e.fire("sort",{column:d.name,desc:h}),n.autoSort!==!1?e.update():e.updateColumns()),"checkbox"==d.type&&(e.selected().length>0?e.unselect(0,e.data().length):e.select(0,e.data().length));else{c=e.data()[u];var m=e.fire("cellclick",{row:c,value:c[f[l].name],rowIndex:u,cellIndex:l,inValue:!!p});m.isDefaultPrevented()||(r.shiftKey?e.select(e._focusIndex,u):r.ctrlKey?e[e._selected[u]?"unselect":"select"](u):"checkbox"==d.type?e[e._selected[u]?"unselect":"select"](u):e.unselect(0,e._data.length).select(u))}}),e.data(e.settings.data)},repaint:function(){var e=this,t=e.layoutRect(),n,i;e._super(),n=e.getEl("body").style,n.width=t.innerW+"px",n.height=t.innerH-e.getEl("head").offsetHeight+"px",i=e.getEl("thead").offsetWidth,i&&(e.getEl("head").style.width=i+"px")},append:function(e){var t=this,n=t._data;if("undefined"!=typeof e){for(var i=e.length;i--;)e[i].index=n.length-1+i;return t._data=t._data.concat(e),t.update(e),t.repaint(),t}return t._data},data:function(e){var t=this;if("undefined"!=typeof e){for(var n=e.length;n--;)e[n].index=n;return t._data=e,t._selected={},t.update(),t.repaint(),t}return t._data},updateColumns:function(){for(var e=this,n,i=e.settings.columns,r=e.classPrefix,o=e.getEl("headr"),a=0;a<o.childNodes.length;a++)t.removeClass(o.childNodes[a].lastChild.lastChild,r+"up"),t.removeClass(o.childNodes[a].lastChild.lastChild,r+"down"),i[a].name==e._sortBy&&(n=a);e._sortOrder?t.addClass(o.childNodes[n].lastChild.lastChild,r+"up"):t.addClass(o.childNodes[n].lastChild.lastChild,r+"down")},update:function(e){function n(e,t,n){function i(e,i){return e=parseFloat(e[t]),i=parseFloat(i[t]),e=isNaN(e)?0:e,i=isNaN(i)?0:i,n?e-i:i-e}function r(e,i){return e=(""+e[t]).toLowerCase(),i=(""+i[t]).toLowerCase(),n?e.localeCompare(i):i.localeCompare(e)}function o(e,i){return e=e[t].getTime(),i=i[t].getTime(),e=isNaN(e)?0:e,i=isNaN(i)?0:i,n?e-i:i-e}if(e.length){var a=e[0][t],s=r;a instanceof Date&&(s=o),"number"==typeof a&&(s=i),e=e.sort(s)}return e}var i=this,r,o,a,s,l=e||i.data(),u,c,d,f,p=i.classPrefix,h,m,g=i.settings,v;for(o=g.columns,g.sortBy&&g.autoSort!==!1&&(l=n(l,"index",!0),l=n(l,i._sortBy,i._sortOrder)),l=i.fire("beforeUpdate",{data:l}).data,r=[],d=i.getEl("headr"),a=0;a<d.childNodes.length;a++)t.removeClass(d.childNodes[a].lastChild.lastChild,p+"up"),t.removeClass(d.childNodes[a].lastChild.lastChild,p+"down"),o[a].name==i._sortBy&&(v=a);for(i._sortOrder?t.addClass(d.childNodes[v].lastChild.lastChild,p+"up"):t.addClass(d.childNodes[v].lastChild.lastChild,p+"down"),r.push('<table><tbody id="'+i._id+'-tbody">'),s=0;s<l.length;s++){for(m=l[s],r.push('<tr class="'+p+"grid-row",s%2?" "+p+"grid-odd":"",'">'),a=0;a<o.length;a++){var y={row:m,value:m[o[a].name||a],icon:o[a].icon};c=o[a].filter,c&&c(y),h=y.icon?'<i class="'+p+"ico "+p+"i-"+y.icon+'" unselectable="on"></i>':"",r.push('<td><div class="'+p+"txt "+p+'grid-cell">',h,'<span class="'+p+"txt "+p+'reset" title="'+y.value+'">',y.value||"&nbsp;","</span></div></td>")}r.push("</tr>")}if(r.push("</tbody></table>"),f=document.createElement("div"),f.innerHTML=r.join(""),u=i.getEl("tbody",!0),e)for(var x,b=f.firstChild.firstChild;x=b.firstChild;)u.appendChild(x);else u.parentNode.replaceChild(f.firstChild.firstChild,u),i.getEl("body").scrollTop=1,i._selected={},i._data=l;return i.updateCheckedState(),i},selected:function(){var e=this,t=e._data,n,i,r=e._selected,o=[];for(n=0,i=t.length;i>n;n++)r[n]&&o.push(t[n]);return o},selectable:function(){var e=this,t=e._data,n,i,r=[];for(n=0,i=t.length;i>n;n++)t[n].isParent||r.push(t[n]);return r},isSelected:function(e){return!!this._selected[e]},unselect:function(e,t){return this.setRowState(e,t,!1)},select:function(e,t){return this.setRowState(e,t,!0)},setRowState:function(e,n,i){var r=this,o,a,s,l,u,c=r.classPrefix;for("undefined"==typeof e&&"undefined"==typeof n?(e=0,n=r._data.length):"undefined"==typeof n&&(n=e),u=r._data.length-1,e=e?e>u?u:e:0,n=n?n>u?u:n:0,s=r._selected,s||(r._selected=s={}),r._rendered&&(a=r.getEl("tbody",!0).rows),i?r._focusIndex=e:delete r._focusIndex,e>n&&(l=e,e=n,n=l),o=e;n>=o;o++)r._data[o]&&!r._data[o].isParent&&(a&&t.toggleClass(a[o],c+"checked",i),s[o]=i);return r.fire("select",{selected:r.selected()}),r.updateCheckedState(),r},updateCheckedState:function(){var e=this,n,i,r=e.classPrefix;for(i=e.settings.columns,n=0;n<i.length;n++)if("checkbox"==i[n].type){var o=e.getEl("headr").childNodes[n].firstChild.firstChild;e.selected().length&&e.selected().length==e.selectable().length?(t.removeClass(o,r+"inter"),t.addClass(o,r+"checked")):e.selected().length?(t.removeClass(o,r+"checked"),t.addClass(o,r+"inter")):(t.removeClass(o,r+"checked"),t.removeClass(o,r+"inter"))}},edit:function(e,i,r,o){var a=this,s=a.data(),l=a.settings.columns,u,c,d,f,p;a.cancelEdit(),p=s[e][l[i].name],p=a.fire("beforeEdit",{value:p}).value,u=a.getEl("tbody",!0),c=u.childNodes[e].childNodes[i].firstChild,c.lastChild.style.display="none",c.appendChild(t.createFragment('<span id="'+a._id+'-edit" class="mce-grid-edit"><input type="text" value="'+p+'" class="mce-reset" /></span>')),d=a.getEl("edit",!0),f=d.firstChild,f.focus(),a.applyEdit=function(){o=n,a.cancelEdit(),c.lastChild.innerText=s[e][i]=f.value,r&&r({value:f.value})},a.cancelEdit=function(){a.cancelEdit=a.applyEdit=n,d.previousSibling.style.display="",d.parentNode.removeChild(d),o&&o()}},cancelEdit:n,applyEdit:n,renderHtml:function(){var e=this,t=[],n=e.settings,i,r=n.columns,o,a,s,l,u=e.classPrefix;for(o=0;o<r.length;o++)a=r[o].width,"number"==typeof a&&(a>0&&1>a?a=100*a+"%":a+="px"),r[o].width=a;for(t.push('<div id="'+e._id+'" class="'+e.classes()+" "+u+'grid">'),t.push('<div class="'+u+'grid-head" unselectable="true"><table id="'+e._id+'-head" class="'+u+'grid-head"><tbody><tr id="'+e._id+'-headr">'),o=0;o<r.length;o++)i=r[o],a=i.width,i.sorting!==!1&&"checkbox"!=i.type&&(s='<i class="'+u+'caret"></i>'),l=e.encode(i.title)||"&nbsp;","checkbox"==i.type&&(l='<i class="'+u+"ico "+u+'i-checkbox" unselectable="on"></i>'+l),t.push('<td class="'+u+'grid-head-item"',a?' style="width: '+a+'"':"",'><div class="'+u+"txt "+u+'grid-cell">',l,s,"</div></td>");for(t.push("</tr></tbody></table></div>"),t.push('<div id="'+e._id+'-body" class="'+u+'grid-body"><table>'),t.push('<thead id="'+e._id+'-thead">'),o=0;o<r.length;o++)a=r[o].width,t.push("<td",a?' style="width: '+r[o].width+'"':"",'><div class="'+u+"txt "+u+'grid-cell">',o,"</div></td>");return t.push('</thead><tbody id="'+e._id+'-tbody"></tbody></table></div></div>'),t.join("")}})}),i(B,[d],function(e){return e.extend({recalc:function(e){var t=e.settings,n,i,r,o,a,s,l,u,c,d,f,p,h,m,g,v,y,x,b,w,_,E,C=[],R=[],T,A,S,D,k,I;for(t=e.settings,r=e.items().filter(":visible"),o=e.layoutRect(),i=t.columns||Math.ceil(Math.sqrt(r.length)),n=Math.ceil(r.length/i),y=t.spacingH||t.spacing||0,x=t.spacingV||t.spacing||0,b=t.alignH||t.align,w=t.alignV||t.align,g=e._paddingBox,b&&"string"==typeof b&&(b=[b]),w&&"string"==typeof w&&(w=[w]),d=0;i>d;d++)C.push(0);for(f=0;n>f;f++)R.push(0);for(f=0;n>f;f++)for(d=0;i>d&&(c=r[f*i+d],c);d++)u=c.layoutRect(),T=u.minW,A=u.minH,C[d]=T>C[d]?T:C[d],R[f]=A>R[f]?A:R[f];for(k=o.innerW-g.left-g.right,_=0,d=0;i>d;d++)_+=C[d]+(d>0?y:0),k-=(d>0?y:0)+C[d];for(I=o.innerH-g.top-g.bottom,E=0,f=0;n>f;f++)E+=R[f]+(f>0?x:0),I-=(f>0?x:0)+R[f];if(_+=g.left+g.right,E+=g.top+g.bottom,l={},l.minW=_+(o.w-o.innerW),l.minH=E+(o.h-o.innerH),l.contentW=l.minW-o.deltaW,l.contentH=l.minH-o.deltaH,l.minW=Math.min(l.minW,o.maxW),l.minH=Math.min(l.minH,o.maxH),l.minW=Math.max(l.minW,o.startMinWidth),l.minH=Math.max(l.minH,o.startMinHeight),!o.autoResize||l.minW==o.minW&&l.minH==o.minH){o.autoResize&&(l=e.layoutRect(l),l.contentW=l.minW-o.deltaW,l.contentH=l.minH-o.deltaH);var N;N="start"==t.packV?0:I>0?Math.floor(I/n):0;var M=0,F=t.flexWidths;if(F)for(d=0;d<F.length;d++)M+=F[d];else M=i;var H=k/M;for(d=0;i>d;d++)C[d]+=F?Math.ceil(F[d]*H):H;for(h=g.top,f=0;n>f;f++){for(p=g.left,s=R[f]+N,d=0;i>d&&(c=r[f*i+d],c);d++)m=c.settings,u=c.layoutRect(),a=C[d],S=D=0,u.x=p,u.y=h,v=m.alignH||(b?b[d]||b[0]:null),"center"==v?u.x=p+a/2-u.w/2:"right"==v?u.x=p+a-u.w:"stretch"==v&&(u.w=a),v=m.alignV||(w?w[d]||w[0]:null),"center"==v?u.y=h+s/2-u.h/2:"bottom"==v?u.y=h+s-u.h:"stretch"==v&&(u.h=s),c.layoutRect(u),p+=a+y,c.recalc&&c.recalc();h+=s+x}}else if(l.w=l.minW,l.h=l.minH,e.layoutRect(l),this.recalc(e),null===e._lastRect){var P=e.parent();P&&(P._lastRect=null,P.recalc())}}})}),i(U,[b],function(e){return e.extend({renderHtml:function(){var e=this;return e.addClass("iframe"),e.canFocus=!1,'<iframe id="'+e._id+'" class="'+e.classes()+'" tabindex="-1" src="'+(e.settings.url||"javascript:''")+'" frameborder="0"></iframe>'},src:function(e){this.getEl().src=e},html:function(e,t){var n=this,i=this.getEl().contentWindow.document.body;return i?(i.innerHTML=e,t&&t()):setTimeout(function(){n.html(e)},0),this}})}),i(j,[b],function(e){return e.extend({init:function(e){var t=this;t._super(e),t.addClass("image"),t.on("click",function(e){-1!=e.target.className.indexOf("checkbox")&&t.toggleClass("checked",!0)})},renderHtml:function(){var e=this,t=e._id,n=e.classPrefix,i=e.settings,r=i.icon;return'<div id="'+t+'" class="'+e.classes()+'">'+(r?'<i class="'+n+"ico "+n+"i-"+r+'"></i>':"")+(i.url?'<img src="'+i.url+'" />':"")+'<div class="'+n+'info">'+(i.selectable?'<i class="'+n+"ico "+n+'i-checkbox"></i>':"")+e.settings.text+"</div>"+"</div>"}})}),i(q,[],function(){function e(e){return"[object Number]"==Object.prototype.toString.call(e)}function n(e,t,n){var i=e.createShader(t);if(e.shaderSource(i,n),e.compileShader(i),!e.getShaderParameter(i,e.COMPILE_STATUS))throw"compile error: "+e.getShaderInfoLog(i);return i}var i="attribute vec2 vertex;attribute vec2 _texCoord;varying vec2 texCoord;void main() {texCoord = _texCoord;gl_Position = vec4(vertex * 2.0 - 1.0, 0.0, 1.0);}",r="uniform sampler2D texture;varying vec2 texCoord;void main() {gl_FragColor = texture2D(texture, texCoord);}";
return function(o,a,s){function l(t){o.useProgram(p);for(var n in t)if(t.hasOwnProperty(n)){var i=o.getUniformLocation(p,n);if(null!==i){var r=t[n];if(r.length)switch(r.length){case 1:o.uniform1fv(i,new Float32Array(r));break;case 2:o.uniform2fv(i,new Float32Array(r));break;case 3:o.uniform3fv(i,new Float32Array(r));break;case 4:o.uniform4fv(i,new Float32Array(r));break;case 9:o.uniformMatrix3fv(i,!1,new Float32Array(r));break;case 16:o.uniformMatrix4fv(i,!1,new Float32Array(r));break;default:throw"dont't know how to load uniform \""+n+'" of length '+r.length}else{if(!e(r))throw'attempted to set uniform "'+n+'" to invalid value '+(r||"undefined").toString();o.uniform1f(i,r)}}}return f}function u(e){o.useProgram(p);for(var t in e)e.hasOwnProperty(t)&&o.uniform1i(o.getUniformLocation(p,t),e[t]);return f}function c(e,n,i,r){var a=o.getParameter(o.VIEWPORT);return n=n!==t?(n-a[1])/a[3]:0,e=e!==t?(e-a[0])/a[2]:0,i=i!==t?(i-a[0])/a[2]:1,r=r!==t?(r-a[1])/a[3]:1,o.vertexBuffer||(o.vertexBuffer=o.createBuffer()),o.bindBuffer(o.ARRAY_BUFFER,o.vertexBuffer),o.bufferData(o.ARRAY_BUFFER,new Float32Array([e,n,e,r,i,n,i,r]),o.STATIC_DRAW),o.texCoordBuffer||(o.texCoordBuffer=o.createBuffer(),o.bindBuffer(o.ARRAY_BUFFER,o.texCoordBuffer),o.bufferData(o.ARRAY_BUFFER,new Float32Array([0,0,0,1,1,0,1,1]),o.STATIC_DRAW)),h||(h=o.getAttribLocation(p,"vertex"),o.enableVertexAttribArray(h)),m||(m=o.getAttribLocation(p,"_texCoord"),o.enableVertexAttribArray(m)),o.useProgram(p),o.bindBuffer(o.ARRAY_BUFFER,o.vertexBuffer),o.vertexAttribPointer(h,2,o.FLOAT,!1,0,0),o.bindBuffer(o.ARRAY_BUFFER,o.texCoordBuffer),o.vertexAttribPointer(m,2,o.FLOAT,!1,0,0),o.drawArrays(o.TRIANGLE_STRIP,0,4),f}function d(){o.deleteProgram(p),p=null}var f=this,p,h,m;if(p=o.createProgram(),a=a||i,s=s||r,s="precision highp float;"+s,o.attachShader(p,n(o,o.VERTEX_SHADER,a)),o.attachShader(p,n(o,o.FRAGMENT_SHADER,s)),o.linkProgram(p),!o.getProgramParameter(p,o.LINK_STATUS))throw"link error: "+o.getProgramInfoLog(p);f.uniforms=l,f.textures=u,f.drawRect=c,f.destroy=d}}),i(V,[],function(){return function(e,t,n,i,r){function o(o){t=o.width||o.videoWidth,n=o.height||o.videoHeight,e.bindTexture(e.TEXTURE_2D,u),e.texImage2D(e.TEXTURE_2D,0,i,i,r,o)}function a(){e.deleteTexture(u),u=null}function s(t){e.activeTexture(e.TEXTURE0+(t||0)),e.bindTexture(e.TEXTURE_2D,u)}function l(i){e.framebuffer=e.framebuffer||e.createFramebuffer(),e.bindFramebuffer(e.FRAMEBUFFER,e.framebuffer),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,u,0),e.viewport(0,0,t,n),i(),e.bindFramebuffer(e.FRAMEBUFFER,null)}var u=e.createTexture();return i=i||e.RGBA,r=r||e.UNSIGNED_BYTE,e.bindTexture(e.TEXTURE_2D,u),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),t&&n&&e.texImage2D(e.TEXTURE_2D,0,i,t,n,0,i,r,null),{loadContentsOf:o,destroy:a,use:s,drawTo:l,width:t,height:n}}}),i(X,[q,V],function(e,t){var n={vibrance:"uniform sampler2D texture;\nuniform float adjust;\nvarying vec2 texCoord;\n\nvoid main() {\n    vec4 color = texture2D(texture, texCoord);\n    float average = (color.r + color.g + color.b) / 3.0;\n    float mx = max(color.r, max(color.g, color.b));\n    float amt = (mx - average) * (-adjust * 3.0);\n\n    color.rgb = mix(color.rgb, vec3(mx), amt);\n\n    gl_FragColor = color;\n}\n",triangleblur:"uniform sampler2D texture;\nuniform vec2 delta;\nvarying vec2 texCoord;\n\nfloat random(vec3 scale, float seed) {\n	/* use the fragment position for a different seed per-pixel */\n	return fract(sin(dot(gl_FragCoord.xyz + seed, scale)) * 43758.5453 + seed);\n}\n\nvoid main() {\n	vec4 color = vec4(0.0);\n	float total = 0.0;\n\n	/* randomize the lookup values to hide the fixed number of samples */\n	float offset = random(vec3(12.9898, 78.233, 151.7182), 0.0);\n\n	for (float t = -30.0; t <= 30.0; t++) {\n		float percent = (t + offset - 0.5) / 30.0;\n		float weight = 1.0 - abs(percent);\n		vec4 sample = texture2D(texture, texCoord + delta * percent);\n\n		/* switch to pre-multiplied alpha to correctly blur transparent images */\n		sample.rgb *= sample.a;\n\n		color += sample * weight;\n		total += weight;\n	}\n\n	gl_FragColor = color / total;\n\n	/* switch back from pre-multiplied alpha */\n	gl_FragColor.rgb /= gl_FragColor.a + 0.00001;\n}\n\n",sepia:"uniform sampler2D texture;\r\nuniform float adjust;\r\nvarying vec2 texCoord;\r\n\r\nvoid main() {\r\n	vec4 color = texture2D(texture, texCoord);\r\n\r\n	float r = color.r;\r\n	float g = color.g;\r\n	float b = color.b;\r\n\r\n	color.r = min(1.0, (r * (1.0 - (0.607 * adjust))) + (g * (0.769 * adjust)) + (b * (0.189 * adjust)));\r\n	color.g = min(1.0, (r * 0.349 * adjust) + (g * (1.0 - (0.314 * adjust))) + (b * 0.168 * adjust));\r\n	color.b = min(1.0, (r * 0.272 * adjust) + (g * 0.534 * adjust) + (b * (1.0 - (0.869 * adjust))));\r\n\r\n	gl_FragColor = color;\r\n}",saturate:"uniform sampler2D texture;\r\nuniform float adjust;\r\nvarying vec2 texCoord;\r\n\r\nvoid main() {\r\n	vec4 color = texture2D(texture, texCoord);\r\n	float average = (color.r + color.g + color.b) / 3.0;\r\n\r\n	color.rgb += (average - color.rgb) * (adjust * -1.0);\r\n\r\n	gl_FragColor = color;\r\n}\r\n",invert:"uniform sampler2D texture;\r\nvarying vec2 texCoord;\r\n\r\nvoid main() {\r\n	vec4 sample = texture2D(texture, texCoord);\r\n\r\n	sample.r = 1.0 - sample.r;\r\n	sample.g = 1.0 - sample.g;\r\n	sample.b = 1.0 - sample.b;\r\n\r\n	gl_FragColor = sample;\r\n}\r\n",hue:"uniform sampler2D texture;\nuniform float adjust;\nvarying vec2 texCoord;\n\nvoid main() {\n	vec4 color = texture2D(texture, texCoord);\n\n	/* hue adjustment, wolfram alpha: RotationTransform[angle, {1, 1, 1}][{x, y, z}] */\n	float angle = adjust * 3.14159265;\n	float s = sin(angle), c = cos(angle);\n	vec3 weights = (vec3(2.0 * c, -sqrt(3.0) * s - c, sqrt(3.0) * s - c) + 1.0) / 3.0;\n	float len = length(color.rgb);\n	color.rgb = vec3(\n		dot(color.rgb, weights.xyz),\n		dot(color.rgb, weights.zxy),\n		dot(color.rgb, weights.yzx)\n	);\n\n	gl_FragColor = color;\n}\n",grayscale:"uniform sampler2D texture;\r\nvarying vec2 texCoord;\r\n\r\nvoid main() {\r\n	vec4 sample = texture2D(texture, texCoord);\r\n\r\n	sample.r = sample.g = sample.b = (sample.r + sample.g + sample.b) / 3.0;\r\n\r\n	gl_FragColor = sample;\r\n}\r\n",gamma:"uniform sampler2D texture;\r\nvarying vec2 texCoord;\r\nuniform float adjust;\r\n\r\nvoid main() {\r\n	vec4 sample = texture2D(texture, texCoord);\r\n\r\n	sample.r = pow(sample.r / 1.0, adjust) * 1.0;\r\n	sample.g = pow(sample.g / 1.0, adjust) * 1.0;\r\n	sample.b = pow(sample.b / 1.0, adjust) * 1.0;\r\n\r\n	gl_FragColor = sample;\r\n}\r\n",flippedshader:"uniform sampler2D texture;\r\nvarying vec2 texCoord;\r\n\r\nvoid main() {\r\n	gl_FragColor = texture2D(texture, vec2(texCoord.x, 1.0 - texCoord.y));\r\n}\r\n",exposure:"uniform sampler2D texture;\nvarying vec2 texCoord;\nuniform float adjust;\n\nvoid main() {\n	vec4 sample = texture2D(texture, texCoord);\n\n	sample.rgb = (1.0 - exp(-(sample.rgb) * adjust));\n\n	gl_FragColor = sample;\n}\n",convolute:"uniform sampler2D texture;\r\nuniform mat3 kernel;\r\nvarying vec2 texCoord;\r\nuniform vec2 textureSize;\r\n\r\nvoid main() {\r\n	vec2 onePixel = vec2(1.0, 1.0) / textureSize;\r\n	vec4 colorSum;\r\n\r\n	float kernelWeight;\r\n	for (int y = 0; y < 3; y++) {\r\n		for (int x = 0; x < 3; x++) {\r\n			colorSum += texture2D(texture, texCoord + onePixel * vec2(1 - y, 1 - x)) * kernel[x][y];\r\n			kernelWeight += kernel[y][x];\r\n		}\r\n	}\r\n\r\n	if (kernelWeight <= 0.0) {\r\n		kernelWeight = 1.0;\r\n	}\r\n\r\n	gl_FragColor = vec4((colorSum / kernelWeight).rgb, 1);\r\n}\r\n",contrast:"uniform sampler2D texture;\r\nvarying vec2 texCoord;\r\nuniform float adjust;\r\n\r\nvoid main() {\r\n	vec4 color = texture2D(texture, texCoord);\r\n\r\n	if (adjust > 0.0) {\r\n		color.rgb = (color.rgb - 0.5) / (1.0 - adjust) + 0.5;\r\n	} else {\r\n		color.rgb = (color.rgb - 0.5) * (1.0 + adjust) + 0.5;\r\n	}\r\n\r\n	gl_FragColor = color;\r\n}\r\n",colorize:"uniform sampler2D texture;\r\nvarying vec2 texCoord;\r\nuniform float adjustR, adjustG, adjustB;\r\n\r\nvoid main() {\r\n	vec4 sample = texture2D(texture, texCoord);\r\n\r\n	sample.r *= adjustR;\r\n	sample.g *= adjustG;\r\n	sample.b *= adjustB;\r\n\r\n	gl_FragColor = sample;\r\n}\r\n",brightness:"uniform sampler2D texture;\r\nvarying vec2 texCoord;\r\nuniform float adjust;\r\n\r\nvoid main() {\r\n	vec4 color = texture2D(texture, texCoord);\r\n\r\n	color.rgb += adjust;\r\n\r\n	gl_FragColor = color;\r\n}\r\n"};return function(i){function r(e,t){j[e]=t}function o(e,t){P.width=e,P.height=t}function a(e){o(e.naturalWidth||e.width,e.naturalHeight||e.height),O.drawImage(e,0,0)}function s(e,t){var n=new Image;n.onload=function(){n.onload=null,a(n),t&&t.call(H),S()},n.src=e}function l(e,t){t.width=e.width,t.height=e.height,t.getContext("2d").drawImage(e,0,0)}function u(e){q=!e}function c(){q||(B<W.length&&W.splice(B,W.length),i.undoLevels&&B>=i.undoLevels&&(W.shift(),B--),W.push(O.getImageData(0,0,P.width,P.height)),B=W.length)}function d(){return U.getElementById(i.image)}function f(e){var t=d();t.onload=function(){t.onload=null,t.style.display="",e()},t.src=D()}function p(e){return function(){c(),O.save(),e.apply(H,arguments),O.restore(),O.setTransform(1,0,0,1,0,0),f(S)}}function h(){return B>0}function m(){return B<W.length-1}function g(e){var t;e="undefined"!=typeof e?e:W.length-1,t=W[e],o(t.width,t.height),O.putImageData(t,0,0)}function v(e,t){g(e),B=e,t&&W.splice(e)}function y(e){h()&&(B==W.length&&W.push(O.getImageData(0,0,P.width,P.height)),v(B-1,e),f(S))}function x(e){m()&&(v(B+1,e),f(S))}function b(){h()&&(v(0,!0),f(S))}function w(e){var t=0,n=0,i,r;e=0>e?360+e:e,90==e||270==e?(i=P.height,r=P.width):(i=P.width,r=P.height),(90==e||180==e)&&(t=i),(270==e||180==e)&&(n=r),l(P,L),o(i,r),O.translate(t,n),O.rotate(e*Math.PI/180),O.drawImage(L,0,0)}function _(e){l(P,L),o(e.w,e.h),O.drawImage(L,0,0,e.w,e.h)}function E(e){"v"==e?(O.scale(1,-1),O.drawImage(P,0,-P.height)):(O.scale(-1,1),O.drawImage(P,-P.width,0))}function C(e){l(P,L),o(e.w,e.h),O.drawImage(L,-e.x,-e.y)}function R(e,t,n,r,o,a){function s(){var t=d[g++],o;t?(e(t.x,t.y,t.x+t.w,t.y+t.h,f.data,f.width,f.height,p?p.data:null),o=(new Date).getTime(),1e3>o-h?s():(h=o,window.setTimeout(s,0),i.onprogress&&i.onprogress.call(H,g/d.length))):(O.putImageData(p||f,n,r),i.onprogress&&i.onprogress.call(H,1),S())}var l,u,c=600,d=[],f,p,h,m,g=0;for(n=n||0,r=r||0,o=o||P.width,a=a||P.height,u=r;a>u;u+=c)for(l=n;o>l;l+=c)d.push({x:l,y:u,w:l+c>o?o-l:c,h:u+c>a?a-u:c});h=m=(new Date).getTime(),f=O.getImageData(n,r,o,a),t&&(p=O.getImageData(n,r,o,a)),s()}function T(e){R(function(t,n,i,r,o,a,s,l){var u,c,d,f,p,h,m,g,v,y,x,b,w;for(u=Math.round(Math.sqrt(e.length)),c=Math.floor(u/2),f=n;r>f;f++)for(d=t;i>d;d++){for(p=h=m=0,v=0;u>v;v++)for(g=0;u>g;g++)y=d+g-c,x=f+v-c,y=0>y?0:y>a?a:y,x=0>x?0:x>s?s:x,b=4*(x*a+y),w=e[v*u+g],p+=o[b]*w,h+=o[b+1]*w,m+=o[b+2]*w;b=4*(f*a+d),l[b]=p>255?255:0>p?0:p,l[b+1]=h>255?255:0>h?0:h,l[b+2]=m>255?255:0>m?0:m}},!0)}function A(){return{w:P.width,h:P.height}}function S(){i.onchange&&i.onchange.call(this)}function D(e){var t,n={jpg:"image/jpeg",jpeg:"image/jpeg",png:"image/png"};return e=e||"png",t=n[e.substr(e.lastIndexOf(".")+1).toLowerCase()],P.toDataURL(t)}function k(){var i,r;V.width=i=P.width,V.height=r=P.height,V.style.cssText=P.style.cssText,P.style.display="none",J=new e(X,null,n.flippedshader),Y=new t(X,i,r),G=new t(X,i,r),$=new t(X,i,r),Y.loadContentsOf(P)}function I(e,t,n,i){(n||Y).use(),(i||G).drawTo(function(){e.uniforms(t).drawRect()})}function N(){G.use(),J.drawRect()}function M(){function t(t,i){var r=K[t]=K[t]||new e(X,null,n[t]);I.call(this,r,i),N()}function i(e){r(e,function(n){t(e,{adjust:n})})}function o(e,n){r(e,function(){t("convolute",{textureSize:[Y.width,Y.height],kernel:n})})}if(X){for(var a in n)i(a);o("sharpen",[0,-1,0,-1,5,-1,0,-1,0]),o("emboss",[-2,-1,0,-1,1,1,0,1,2]),r("colorize",function(e,n,i){t("colorize",{adjustR:e,adjustG:n,adjustB:i})}),r("triangleblur",function(t){var i=K.triangleblur=K.triangleblur||new e(X,null,n.triangleblur);I.call(this,i,{delta:[t/Y.width,0]},Y,$),I.call(this,i,{delta:[0,t/Y.height]},$,G),N()})}}function F(e){function t(){n?X||g():(n=!0,d().style.display="none",X?(k(),V.style.display=""):(c(),P.style.display=""),e.init&&e.init())}var n;return{live:function(){var n=arguments;X&&(t(),e.liveGPU.apply(this,n))},apply:function(){var n=arguments;t(),X?e.liveGPU.apply(this,n):e.live.apply(this,n)},save:function(){function e(){var e=G.width,t=G.height,n=new Uint8Array(4*e*t);return G.drawTo(function(){X.readPixels(0,0,e,t,X.RGBA,X.UNSIGNED_BYTE,n)}),n}if(n=!1,X){for(var t=e(),i=O.createImageData(G.width,G.height),r=i.data,o=t.length;o--;)r[o]=t[o];c(),O.putImageData(i,0,0),P.style.display="",V.style.display="none"}f(function(){P.style.display="none",S()})},cancel:function(){n=!1,d().style.display="",P.style.display="none",V.style.display="none",X||(v(B-1),S())}}}var H=this,P,O,L,z,W=[],B=0,U=document,j={},q,V,X,Y,G,$,J,K={};if(P=U.createElement("canvas"),P.getContext){O=P.getContext("2d"),P.style.display="none",U.getElementById(i.viewport).appendChild(P),L=U.createElement("canvas"),z=L.getContext("2d"),V=U.createElement("canvas"),V.style.display="none";try{X=V.getContext("experimental-webgl",{premultipliedAlpha:!1}),window.opera&&(X=null),X&&U.getElementById(i.viewport).appendChild(V)}catch(Z){}}return r("grayscale",function(){R(function(e,t,n,i,r,o){var a,s,l;for(s=t;i>s;s++)for(a=e;n>a;a++)l=4*(s*o+a),r[l]=r[l+1]=r[l+2]=(r[l]+r[l+1]+r[l+2])/3})}),r("redeye",function(e,t,n){var i,r,o,a,s,l,u,c,d,f;for(e=0|e,t=0|t,n=0|n,i=O.getImageData(e-n,t-n,2*n,2*n),r=i.data,d=i.width,a=-n;n>=a;a++)for(o=-n;n>=o;o++)n*n>=o*o+a*a&&(f=4*((n+a)*d+(n+o)),l=r[f],u=r[f+1],c=r[f+2],s=u||c?2*l/(u+c):l?2:0,s>1.6&&(r[f]=u||c?(u+c)/2:0));O.putImageData(i,e-n,t-n)}),r("invert",function(){R(function(e,t,n,i,r,o){var a,s,l;for(s=t;i>s;s++)for(a=e;n>a;a++)l=4*(s*o+a),r[l]=255-r[l],r[l+1]=255-r[l+1],r[l+2]=255-r[l+2]})}),r("gamma",function(e){for(var t=256,n=[];t--;)n[t]=255*Math.pow(t/255,e);R(function(e,t,i,r,o,a){var s,l,u,c=n;for(l=t;r>l;l++)for(s=e;i>s;s++)u=4*(l*a+s),o[u]=c[o[u]],o[u+1]=c[o[u+1]],o[u+2]=c[o[u+2]]})}),r("brightness",function(e){e=Math.floor(255*e),R(function(t,n,i,r,o,a){var s,l,u;for(l=n;r>l;l++)for(s=t;i>s;s++)u=4*(l*a+s),o[u]+=e,o[u+1]+=e,o[u+2]+=e})}),r("contrast",function(e){for(var t=256,n,i=[];t--;)n=255*((t/255-.5)*e+.5),i[t]=0>n?0:n>255?255:n;R(function(e,t,n,r,o,a){var s,l,u,c=i;for(l=t;r>l;l++)for(s=e;n>s;s++)u=4*(l*a+s),o[u]=c[o[u]],o[u+1]=c[o[u+1]],o[u+2]=c[o[u+2]]})}),r("colorize",function(e,t,n){for(var i=256,r=[],o=[],a=[];i--;)r[i]=i*e,o[i]=i*t,a[i]=i*n;R(function(e,t,n,i,s,l){var u,c,d,f=r,p=o,h=a;for(c=t;i>c;c++)for(u=e;n>u;u++)d=4*(c*l+u),s[d]=f[s[d]],s[d+1]=p[s[d+1]],s[d+2]=h[s[d+2]]})}),r("exposure",function(e){for(var t=256,n=[];t--;)n[t]=255*(1-Math.exp(-(t/255)*e));R(function(e,t,i,r,o,a){var s,l,u,c=n;for(l=t;r>l;l++)for(s=e;i>s;s++)u=4*(l*a+s),o[u]=c[o[u]],o[u+1]=c[o[u+1]],o[u+2]=c[o[u+2]]})}),r("sepia",function(e){R(function(t,n,i,r,o,a){var s,l,u,c;for(l=n;r>l;l++)for(s=t;i>s;s++)u=4*(l*a+s),c=.3*o[u]+.59*o[u+1]+.11*o[u+2],o[u]=c+40,o[u+1]=c+20,o[u+2]=c-e})}),r("saturate",function(e){e=-1*e,R(function(t,n,i,r,o,a){var s,l,u,c,d,f,p;for(l=n;r>l;l++)for(s=t;i>s;s++)u=4*(l*a+s),c=o[u],d=o[u+1],f=o[u+2],p=(c+d+f)/3,o[u]+=(p-c)*e,o[u+1]+=(p-d)*e,o[u+2]+=(p-f)*e})}),r("sharpen",function(){T([0,-1,0,-1,5,-1,0,-1,0])}),r("emboss",function(){T([-2,-1,0,-1,1,1,0,1,2])}),r("blur",function(e){e=e||1,R(function(t,n,i,r,o,a,s){var l,u,c,d,f,p,h,m,g,v,y,x;for(c=e;c--;)for(u=n;r>u;u++)for(l=t;i>l;l++){for(m=f=p=h=0,v=-1;2>v;v++)for(g=-1;2>g;g++)y=l+g,x=u+v,y=0>y?0:y>a?a:y,x=0>x?0:x>s?s:x,d=4*(x*a+y),f+=o[d],p+=o[d+1],h+=o[d+2],m++;d=4*(u*a+l),o[d]=f/m,o[d+1]=p/m,o[d+2]=h/m}})}),M(),{loadFromUrl:s,loadFromImage:a,getAsDataUrl:D,getSize:A,undo:y,redo:x,revert:b,canUndo:h,canRedo:m,addUndoLevel:c,setUndoEnabled:u,onChange:S,getCanvas:function(){return P},getWebGlCanvas:function(){return V},filter:function(e){return F({liveGPU:function(){j[e].apply(this,arguments)},live:function(){j[e].apply(this,arguments)}})},resize:p(_),crop:p(C),flip:p(E),rotate:p(w),hasCanvasSupport:function(){return!!O},hasWebGlSupport:function(){return!!X}}}}),i(Y,[],function(){function e(e){return o.lastIndex=0,o.test(e)?'"'+e.replace(o,function(e){var t=l[e];return"string"==typeof t?t:"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+e+'"'}function n(t,i){var r,o,l,c,d=a,f,p=i[t];switch(p&&"object"==typeof p&&"function"==typeof p.toJSON&&(p=p.toJSON(t)),"function"==typeof u&&(p=u.call(i,t,p)),typeof p){case"string":return e(p);case"number":return isFinite(p)?String(p):"null";case"boolean":case"null":return String(p);case"object":if(!p)return"null";if(a+=s,f=[],"[object Array]"===Object.prototype.toString.apply(p)){for(c=p.length,r=0;c>r;r+=1)f[r]=n(r,p)||"null";return l=0===f.length?"[]":a?"[\n"+a+f.join(",\n"+a)+"\n"+d+"]":"["+f.join(",")+"]",a=d,l}if(u&&"object"==typeof u)for(c=u.length,r=0;c>r;r+=1)"string"==typeof u[r]&&(o=u[r],l=n(o,p),l&&f.push(e(o)+(a?": ":":")+l));else for(o in p)Object.prototype.hasOwnProperty.call(p,o)&&(l=n(o,p),l&&f.push(e(o)+(a?": ":":")+l));return l=0===f.length?"{}":a?"{\n"+a+f.join(",\n"+a)+"\n"+d+"}":"{"+f.join(",")+"}",a=d,l}}var i={};if("undefined"!=typeof JSON)return JSON;var r=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,o=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,a,s,l={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},u;return"function"!=typeof i.stringify&&(i.stringify=function(e,t,i){var r;if(a="",s="","number"==typeof i)for(r=0;i>r;r+=1)s+=" ";else"string"==typeof i&&(s=i);if(u=t,t&&"function"!=typeof t&&("object"!=typeof t||"number"!=typeof t.length))throw new Error("jsJSON.stringify");return n("",{"":e})}),"function"!=typeof i.parse&&(i.parse=function(e,n){function i(e,r){var o,a,s=e[r];if(s&&"object"==typeof s)for(o in s)Object.prototype.hasOwnProperty.call(s,o)&&(a=i(s,o),a!==t?s[o]=a:delete s[o]);return n.call(e,r,s)}var o;if(e=String(e),r.lastIndex=0,r.test(e)&&(e=e.replace(r,function(e){return"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})),/^[\],:{}\s]*$/.test(e.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return o=window[String.fromCharCode(101)+"val"]("("+e+")"),"function"==typeof n?i({"":o},""):o;throw new SyntaxError("jsJSON.parse")}),i}),i(G,[],function(){return{send:function(e){function t(){}function n(){if(!u||4==i.readyState||o++>s){if(s>o&&200==i.status)d.call(a,i.responseText);else{var t=o>s?1:2;f.call(a,{code:t,message:-1==t?"Request timed out":"Unknown error",httpRequest:i,options:e,status:i.status})}i=null}else l.setTimeout(n,10)}var i,r,o=0,a=this,s=1e4,l=window,u,c,d,f;if(u=e.async!==!1,c=e.data||"",d=e.success||t,f=e.error||t,c&&!e.contentType&&(e.contentType="application/x-www-form-urlencoded; charset=UTF-8"),l.XMLHttpRequest?i=new XMLHttpRequest:l.ActiveXObject&&(i=new ActiveXObject("Microsoft.XMLHTTP")),i){if(i.overrideMimeType&&i.overrideMimeType(e.contenType),i.open(e.method||(c?"POST":"GET"),e.url,u),e.contentType&&i.setRequestHeader("Content-Type",e.contentType),i.setRequestHeader("X-Requested-With","XMLHttpRequest"),i.send(c),!u)return n();r=l.setTimeout(n,10)}}}}),i($,[Y,G],function(e,t){function n(e){window.console?console.log("Error",e):alert("Error: "+e.message+"\n"+e)}function i(o){o=o||{},this.exec=function(a,s,l,u){function c(e){e={code:-32603,message:"Server returned an invalid response",data:e},u(e)}var d;u=u||i.errorHandler||n,d=e.stringify({id:"i"+r++,method:a,params:s||[],jsonrpc:"2.0"}),t.send({url:o.url||i.url,data:"json="+encodeURIComponent(d),success:function(t){try{t=e.parse(t)}catch(n){return c(t),void 0}t.error?u(t.error):l&&l(t.result)},error:function(e){c({statusCode:e.status})}})}}var r=0;return i.exec=function(e,t,n,r){return(new i).exec(e,t,n||i.successCallback,r||i.errorCallback)},i}),i(J,[],function(){return{normalize:function(e){var t,n,i,r=[];for(e=e.split("/"),t=0,n=e.length;n>t;t++)i=e[t],"."!==i&&(0===t||t==n-1||i.length>0)&&(".."===i?r.length>1&&r.pop():r.push(i));return 1===r.length&&0===r[0].length?"/":r.join("/")},join:function(e,t){return e.replace(/\/$/,"")+"/"+t.replace(/^\//,"")},resolve:function(e,t){return/^\//.test(t)?this.normalize(t):this.normalize(this.join(e,t))},relative:function(e,t){var n,i,r=[],o;if(e=this.normalize(e).split("/"),t=this.normalize(t).split("/"),e.length>=t.length){for(n=0,i=e.length;i>n;n++)if(n>=t.length||e[n]!=t[n]){o=n;break}}else{for(n=0,i=t.length;i>n;n++)if(n>=e.length||e[n]!=t[n]){o=n;break}o>e.length-1&&(e=[])}if(0===o)return r.join("/");for(n=0,i=e.length-o;i>n;n++)r.push("..");for(n=o,i=t.length;i>n;n++)r.push(t[n]);return e.length>0&&r.length>0&&(0===e[e.length-1].length&&e.pop(),0===r[0].length&&r.shift()),e.concat(r).join("/")},dirname:function(e){return e.replace(/\\/g,"/").replace(/\/[^\/]*\/?$/,"")},basename:function(e,t){return e=e.replace(/\/$/,"").replace(/^.*[\/\\]/g,""),t&&e.substr(e.length-t.length)==t&&(e=e.substr(0,e.length-t.length)),e},extname:function(e){var t=e.lastIndexOf(".");return-1!=t?e.substr(t):""}}}),i(K,[],function(){return{apiPageName:"api.php",ie7:document.all&&!window.opera&&!document.documentMode}}),i(Z,[],function(){var e=function(e){var t;return e===t?"undefined":null===e?"null":e.nodeType?"node":{}.toString.call(e).match(/\s([a-z|A-Z]+)/)[1].toLowerCase()},t=function(i){var r;return n(arguments,function(a,s){s>0&&n(a,function(n,a){n!==r&&(e(i[a])===e(n)&&~o(e(n),["array","object"])?t(i[a],n):i[a]=n)})}),i},n=function(e,t){var n,i,r,o;if(e){try{n=e.length}catch(a){n=o}if(n===o){for(i in e)if(e.hasOwnProperty(i)&&t(e[i],i)===!1)return}else for(r=0;n>r;r++)if(t(e[r],r)===!1)return}},i=function(t){var n;if(!t||"object"!==e(t))return!0;for(n in t)return!1;return!0},r=function(t,n){function i(r){"function"===e(t[r])&&t[r](function(e){++r<o&&!e?i(r):n(e)})}var r=0,o=t.length;"function"!==e(n)&&(n=function(){}),t&&t.length||n(),i(r)},o=function(e,t){if(t){if(Array.prototype.indexOf)return Array.prototype.indexOf.call(t,e);for(var n=0,i=t.length;i>n;n++)if(t[n]===e)return n}return-1},a=function(t,n){var i=[];"array"!==e(t)&&(t=[t]),"array"!==e(n)&&(n=[n]);for(var r in t)-1===o(t[r],n)&&i.push(t[r]);return i.length?i:!1},s=function(e,t){var i=[];return n(e,function(e){-1!==o(e,t)&&i.push(e)}),i.length?i:null},l=function(e){var t,n=[];for(t=0;t<e.length;t++)n[t]=e[t];return n},u=function(){var e=0;return function(t){var n=(new Date).getTime().toString(32),i;for(i=0;5>i;i++)n+=Math.floor(65535*Math.random()).toString(32);return(t||"o_")+n+(e++).toString(32)}}(),c=function(e){return e?String.prototype.trim?String.prototype.trim.call(e):e.toString().replace(/^\s*/,"").replace(/\s*$/,""):e},d=function(e){if("string"!=typeof e)return e;var t={t:1099511627776,g:1073741824,m:1048576,k:1024},n;return e=/^([0-9]+)([mgk]?)$/.exec(e.toLowerCase().replace(/[^0-9mkg]/g,"")),n=e[2],e=+e[1],t.hasOwnProperty(n)&&(e*=t[n]),e};return{guid:u,typeOf:e,extend:t,each:n,isEmptyObj:i,inSeries:r,inArray:o,arrayDiff:a,arrayIntersect:s,toArray:l,trim:c,parseSizeStr:d}}),i(Q,[Z],function(e){function t(e,t){var n;for(n in e)if(e[n]===t)return n;return null}return{RuntimeError:function(){function n(e){this.code=e,this.name=t(i,e),this.message=this.name+": RuntimeError "+this.code}var i={NOT_INIT_ERR:1,NOT_SUPPORTED_ERR:9,JS_ERR:4};return e.extend(n,i),n.prototype=Error.prototype,n}(),OperationNotAllowedException:function(){function t(e){this.code=e,this.name="OperationNotAllowedException"}return e.extend(t,{NOT_ALLOWED_ERR:1}),t.prototype=Error.prototype,t}(),ImageError:function(){function n(e){this.code=e,this.name=t(i,e),this.message=this.name+": ImageError "+this.code}var i={WRONG_FORMAT:1,MAX_RESOLUTION_ERR:2};return e.extend(n,i),n.prototype=Error.prototype,n}(),FileException:function(){function n(e){this.code=e,this.name=t(i,e),this.message=this.name+": FileException "+this.code}var i={NOT_FOUND_ERR:1,SECURITY_ERR:2,ABORT_ERR:3,NOT_READABLE_ERR:4,ENCODING_ERR:5,NO_MODIFICATION_ALLOWED_ERR:6,INVALID_STATE_ERR:7,SYNTAX_ERR:8};return e.extend(n,i),n.prototype=Error.prototype,n}(),DOMException:function(){function n(e){this.code=e,this.name=t(i,e),this.message=this.name+": DOMException "+this.code}var i={INDEX_SIZE_ERR:1,DOMSTRING_SIZE_ERR:2,HIERARCHY_REQUEST_ERR:3,WRONG_DOCUMENT_ERR:4,INVALID_CHARACTER_ERR:5,NO_DATA_ALLOWED_ERR:6,NO_MODIFICATION_ALLOWED_ERR:7,NOT_FOUND_ERR:8,NOT_SUPPORTED_ERR:9,INUSE_ATTRIBUTE_ERR:10,INVALID_STATE_ERR:11,SYNTAX_ERR:12,INVALID_MODIFICATION_ERR:13,NAMESPACE_ERR:14,INVALID_ACCESS_ERR:15,VALIDATION_ERR:16,TYPE_MISMATCH_ERR:17,SECURITY_ERR:18,NETWORK_ERR:19,ABORT_ERR:20,URL_MISMATCH_ERR:21,QUOTA_EXCEEDED_ERR:22,TIMEOUT_ERR:23,INVALID_NODE_TYPE_ERR:24,DATA_CLONE_ERR:25};return e.extend(n,i),n.prototype=Error.prototype,n}(),EventException:function(){function t(e){this.code=e,this.name="EventException"}return e.extend(t,{UNSPECIFIED_EVENT_TYPE_ERR:0}),t.prototype=Error.prototype,t}()}}),i(et,[Q,Z],function(e,t){function n(){var n={};t.extend(this,{uid:null,init:function(){this.uid||(this.uid=t.guid("uid_"))},addEventListener:function(e,i,r,o){var a=this,s;return e=t.trim(e),/\s/.test(e)?(t.each(e.split(/\s+/),function(e){a.addEventListener(e,i,r,o)}),void 0):(e=e.toLowerCase(),r=parseInt(r,10)||0,s=n[this.uid]&&n[this.uid][e]||[],s.push({fn:i,priority:r,scope:o||this}),n[this.uid]||(n[this.uid]={}),n[this.uid][e]=s,void 0)},hasEventListener:function(e){return e?!(!n[this.uid]||!n[this.uid][e]):!!n[this.uid]},removeEventListener:function(e,i){e=e.toLowerCase();var r=n[this.uid]&&n[this.uid][e],o;if(r){if(i){for(o=r.length-1;o>=0;o--)if(r[o].fn===i){r.splice(o,1);break}}else r=[];r.length||(delete n[this.uid][e],t.isEmptyObj(n[this.uid])&&delete n[this.uid])}},removeAllEventListeners:function(){n[this.uid]&&delete n[this.uid]},dispatchEvent:function(i){var r,o,a,s,l={};if("string"!==t.typeOf(i)){if(s=i,"string"!==t.typeOf(s.type))throw new e.EventException(e.EventException.UNSPECIFIED_EVENT_TYPE_ERR);i=s.type,s.total&&s.loaded&&(l.total=s.total,l.loaded=s.loaded),l.async=s.async||!1}if(-1!==i.indexOf("::")?!function(e){r=e[0],i=e[1]}(i.split("::")):r=this.uid,i=i.toLowerCase(),o=n[r]&&n[r][i]){o.sort(function(e,t){return t.priority-e.priority}),a=[].slice.call(arguments),a.shift(),l.type=i,a.unshift(l);var u=[];t.each(o,function(e){a[0].target=e.scope,l.async?u.push(function(t){setTimeout(function(){t(e.fn.apply(e.scope,a)===!1)},1)}):u.push(function(t){t(e.fn.apply(e.scope,a)===!1)})}),u.length&&t.inSeries(u)}return!0},bind:function(){this.addEventListener.apply(this,arguments)},unbind:function(){this.removeEventListener.apply(this,arguments)},unbindAll:function(){this.removeAllEventListeners.apply(this,arguments)},trigger:function(){this.dispatchEvent.apply(this,arguments)},convertEventPropsToHandlers:function(e){var n;"array"!==t.typeOf(e)&&(e=[e]);for(var i=0;i<e.length;i++)n="on"+e[i],"function"===t.typeOf(this[n])?this.addEventListener(e[i],this[n]):"undefined"===t.typeOf(this[n])&&(this[n]=null)}})}return n.instance=new n,n}),i(tt,[],function(){var e=function(e){return unescape(encodeURIComponent(e))},t=function(e){return decodeURIComponent(escape(e))},n=function(e,n){if("function"==typeof window.atob)return n?t(window.atob(e)):window.atob(e);var i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",r,o,a,s,l,u,c,d,f=0,p=0,h="",m=[];if(!e)return e;e+="";do s=i.indexOf(e.charAt(f++)),l=i.indexOf(e.charAt(f++)),u=i.indexOf(e.charAt(f++)),c=i.indexOf(e.charAt(f++)),d=s<<18|l<<12|u<<6|c,r=255&d>>16,o=255&d>>8,a=255&d,m[p++]=64==u?String.fromCharCode(r):64==c?String.fromCharCode(r,o):String.fromCharCode(r,o,a);while(f<e.length);return h=m.join(""),n?t(h):h},i=function(t,n){if(n&&e(t),"function"==typeof window.btoa)return window.btoa(t);var i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",r,o,a,s,l,u,c,d,f=0,p=0,h="",m=[];if(!t)return t;do r=t.charCodeAt(f++),o=t.charCodeAt(f++),a=t.charCodeAt(f++),d=r<<16|o<<8|a,s=63&d>>18,l=63&d>>12,u=63&d>>6,c=63&d,m[p++]=i.charAt(s)+i.charAt(l)+i.charAt(u)+i.charAt(c);while(f<t.length);h=m.join("");var g=t.length%3;return(g?h.slice(0,g-3):h)+"===".slice(g||3)};return{utf8_encode:e,utf8_decode:t,atob:n,btoa:i}}),i(nt,[],function(){var e=function(e){for(var t=["source","scheme","authority","userInfo","user","pass","host","port","relative","path","directory","file","query","fragment"],n=t.length,i={http:80,https:443},r={},o=/^(?:([^:\/?#]+):)?(?:\/\/()(?:(?:()(?:([^:@]*):?([^:@]*))?@)?([^:\/?#]*)(?::(\d*))?))?()(?:(()(?:(?:[^?#\/]*\/)*)()(?:[^?#]*))(?:\\?([^#]*))?(?:#(.*))?)/,a=o.exec(e||"");n--;)a[n]&&(r[t[n]]=a[n]);if(/^[^\/]/.test(r.path)&&!r.scheme){var s=document.location.pathname;/(\/|\/[^\.]+)$/.test(s)||(s=s.replace(/[^\/]+$/,"")),r.host=document.location.hostname,r.path=s+(r.path||"")}return r.scheme||(r.scheme=document.location.protocol.replace(/:$/,"")),r.host||(r.host=document.location.hostname),r.port||(r.port=document.location.port||i[r.scheme]||80),r.port=parseInt(r.port,10),r.path||(r.path="/"),delete r.source,r},t=function(t){var n={http:80,https:443},i=e(t);return i.scheme+"://"+i.host+(i.port!==n[i.scheme]?":"+i.port:"")+i.path+(i.query?i.query:"")},n=function(t){function n(e){return[e.scheme,e.host,e.port].join("/")}return"string"==typeof t&&(t=e(t)),n(e())===n(t)};return{parseUrl:e,resolveUrl:t,hasSameOrigin:n}}),i(it,[Z],function(e){function t(e){for(var t,n,i=0;i<e.length;i++)if(t=e[i].s1,n=e[i].prop,o=e[i].sv||e[i].id,t){if(-1!=t.indexOf(e[i].s2))return e[i].id}else if(n)return e[i].id}function n(e){var t=e.indexOf(o);if(-1!=t)return parseFloat(e.substring(t+o.length+1))}var i=[{s1:navigator.userAgent,s2:"Android",id:"Android Browser",sv:"Version"},{s1:navigator.userAgent,s2:"Chrome",id:"Chrome"},{s1:navigator.vendor,s2:"Apple",id:"Safari",sv:"Version"},{prop:window.opera&&window.opera.buildNumber,id:"Opera",sv:"Version"},{s1:navigator.vendor,s2:"KDE",id:"Konqueror"},{s1:navigator.userAgent,s2:"Firefox",id:"Firefox"},{s1:navigator.vendor,s2:"Camino",id:"Camino"},{s1:navigator.userAgent,s2:"Netscape",id:"Netscape"},{s1:navigator.userAgent,s2:"MSIE",id:"IE",sv:"MSIE"},{s1:navigator.userAgent,s2:"Gecko",id:"Mozilla",sv:"rv"}],r=[{s1:navigator.platform,s2:"Win",id:"Windows"},{s1:navigator.platform,s2:"Mac",id:"Mac"},{s1:navigator.userAgent,s2:"iPhone",id:"iOS"},{s1:navigator.userAgent,s2:"iPad",id:"iOS"},{s1:navigator.userAgent,s2:"Android",id:"Android"},{s1:navigator.platform,s2:"Linux",id:"Linux"}],o,a=function(){var t={define_property:function(){return!1}(),create_canvas:function(){var e=document.createElement("canvas");return!(!e.getContext||!e.getContext("2d"))}(),return_response_type:function(t){try{if(-1!==e.inArray(t,["","text","document"]))return!0;if(window.XMLHttpRequest){var n=new XMLHttpRequest;if(n.open("get","/"),"responseType"in n)return n.responseType=t,n.responseType!==t?!1:!0}}catch(i){}return!1},use_data_uri:function(){var e=new Image;return e.onload=function(){t.use_data_uri=1===e.width&&1===e.height},setTimeout(function(){e.src="data:image/gif;base64,R0lGODlhAQABAIAAAP8AAAAAACH5BAAAAAAALAAAAAABAAEAAAICRAEAOw=="},1),!1}(),use_data_uri_over32kb:function(){return t.use_data_uri&&("IE"!==s.browser||s.version>=9)},use_data_uri_of:function(e){return t.use_data_uri&&33e3>e||t.use_data_uri_over32kb()},use_fileinput:function(){var e=document.createElement("input");return e.setAttribute("type","file"),!e.disabled}};return function(n){var i=[].slice.call(arguments);return i.shift(),"function"===e.typeOf(t[n])?t[n].apply(this,i):!!t[n]
}}(),s={can:a,browser:t(i),version:n(navigator.userAgent)||n(navigator.appVersion),OS:t(r),swf_url:"../flash/Moxie.swf",xap_url:"../silverlight/Moxie.xap",global_event_dispatcher:"moxie.core.EventTarget.instance.dispatchEvent"};return s}),i(rt,[it],function(e){var t=function(e){return"string"!=typeof e?e:document.getElementById(e)},n=function(e,t){var n;return""===e.className?!1:(n=new RegExp("(^|\\s+)"+t+"(\\s+|$)"),n.test(e.className))},i=function(e,t){n(e,t)||(e.className=""===e.className?t:e.className.replace(/\s+$/,"")+" "+t)},r=function(e,t){var n=new RegExp("(^|\\s+)"+t+"(\\s+|$)");e.className=e.className.replace(n,function(e,t,n){return" "===t&&" "===n?" ":""})},o=function(e,t){return e.currentStyle?e.currentStyle[t]:window.getComputedStyle?window.getComputedStyle(e,null)[t]:void 0},a=function(t,n){function i(e){var t,n,i=0,r=0;return e&&(n=e.getBoundingClientRect(),t="CSS1Compat"===s.compatMode?s.documentElement:s.body,i=n.left+t.scrollLeft,r=n.top+t.scrollTop),{x:i,y:r}}var r=0,o=0,a,s=document,l,u;if(t=t,n=n||s.body,t&&t.getBoundingClientRect&&"IE"===e.browser&&(!s.documentMode||s.documentMode<8))return l=i(t),u=i(n),{x:l.x-u.x,y:l.y-u.y};for(a=t;a&&a!=n&&a.nodeType;)r+=a.offsetLeft||0,o+=a.offsetTop||0,a=a.offsetParent;for(a=t.parentNode;a&&a!=n&&a.nodeType;)r-=a.scrollLeft||0,o-=a.scrollTop||0,a=a.parentNode;return{x:r,y:o}},s=function(e){return{w:e.offsetWidth||e.clientWidth,h:e.offsetHeight||e.clientHeight}};return{get:t,hasClass:n,addClass:i,removeClass:r,getStyle:o,getPos:a,getSize:s}}),i(ot,[Z,rt,et],function(e,t,n){function i(n,r,a,s,l){function u(t,i){var r=null,o=n&&n.required_caps;return i=i||"browser",null!==this.mode?this.mode:(o&&!e.isEmptyObj(t)&&(e.each(o,function(n,i){if(t.hasOwnProperty(i)){var o=t[i](n);if("string"==typeof o&&(o=[o]),r){if(!(r=e.arrayIntersect(r,o)))return r=!1}else r=o}}),r?this.mode=-1!==e.inArray(i,r)?i:r[0]:r===!1&&(this.mode=!1)),null===this.mode&&(this.mode=i),this.mode&&o&&!this.can(o)&&(this.mode=!1),void 0)}var c=this,d,f=e.guid(r+"_");o[f]=this,a=e.extend({access_binary:!1,access_image_binary:!1,display_media:!1,do_cors:!1,drag_and_drop:!1,resize_image:!1,report_upload_progress:!1,return_response_headers:!1,return_response_type:!1,return_status_code:!0,send_custom_headers:!1,select_file:!1,select_folder:!1,select_multiple:!0,send_binary_string:!1,send_browser_cookies:!0,send_multipart:!0,slice_blob:!1,stream_upload:!1,summon_file_dialog:!1,upload_filesize:!0,use_http_method:!0},a),d=function(){var t={};return{exec:function(e,n,i,r){return d[n]&&(t[e]||(t[e]={context:this,instance:new d[n]}),t[e].instance[i])?t[e].instance[i].apply(this,r):void 0},removeInstance:function(e){delete t[e]},removeAllInstances:function(){var n=this;e.each(t,function(t,i){"function"===e.typeOf(t.instance.destroy)&&t.instance.destroy.call(t.context),n.removeInstance(i)})}}}(),e.extend(this,{initialized:!1,uid:f,type:r,mode:null,shimid:f+"_container",clients:0,options:n,can:function(t,n){var r=arguments[2]||a;if("string"===e.typeOf(t)&&"undefined"===e.typeOf(n)&&(t=i.parseCaps(t)),"object"===e.typeOf(t)){for(var o in t)if(!this.can(o,t[o],r))return!1;return!0}return"function"===e.typeOf(r[t])?r[t].call(this,n):n===r[t]},getShimContainer:function(){var n,i=t.get(this.shimid);return i||(n=this.options.container?t.get(this.options.container):document.body,i=document.createElement("div"),i.id=this.shimid,i.className="moxie-shim moxie-shim-"+this.type,e.extend(i.style,{position:"absolute",top:"0px",left:"0px",width:"1px",height:"1px",overflow:"hidden"}),n.appendChild(i),n=null),i},getShim:function(){return d},shimExec:function(e,t){var n=[].slice.call(arguments,2);return c.getShim().exec.call(this,this.uid,e,t,n)},exec:function(e,t){var n=[].slice.call(arguments,2);return c[e]&&c[e][t]?c[e][t].apply(this,n):c.shimExec.apply(this,arguments)},destroy:function(){if(c){var e=t.get(this.shimid);e&&e.parentNode.removeChild(e),d&&d.removeAllInstances(),this.unbindAll(),delete o[this.uid],this.uid=null,f=c=d=e=null}}}),u.call(this,s,l)}var r={},o={};return i.order="html5,flash,silverlight,html4",i.getRuntime=function(e){return o[e]?o[e]:!1},i.addConstructor=function(e,t){t.prototype=n.instance,r[e]=t},i.getConstructor=function(e){return r[e]||null},i.getInfo=function(e){var t=i.getRuntime(e);return t?{uid:t.uid,type:t.type,can:function(){return t.can.apply(t,arguments)}}:null},i.parseCaps=function(t){var n={};return"string"!==e.typeOf(t)?t||{}:(e.each(t.split(","),function(e){n[e]=!0}),n)},i.can=function(e,t){var n,r=i.getConstructor(e),o;return r?(n=new r({required_caps:t}),o=n.mode,n.destroy(),!!o):!1},i.thatCan=function(e,t){var n=(t||i.order).split(/\s*,\s*/);for(var r in n)if(i.can(n[r],e))return n[r];return null},i.capTrue=function(){return!0},i.capFalse=function(){return!1},i.capTest=function(e){return function(){return!!e}},i}),i(at,[Q,Z,ot],function(e,t,n){return function i(){var i;t.extend(this,{connectRuntime:function(r){function o(t){var s,l;return t.length?(s=t.shift(),(l=n.getConstructor(s))?(i=new l(r),i.bind("Init",function(){i.initialized=!0,setTimeout(function(){i.clients++,a.trigger("RuntimeInit",i)},1)}),i.bind("Error",function(){i.destroy(),o(t)}),i.mode?(i.init(),void 0):(i.trigger("Error"),void 0)):(o(t),void 0)):(a.trigger("RuntimeError",new e.RuntimeError(e.RuntimeError.NOT_INIT_ERR)),i=null,void 0)}var a=this,s;if("string"===t.typeOf(r)?s=r:"string"===t.typeOf(r.ruid)&&(s=r.ruid),s){if(i=n.getRuntime(s))return i.clients++,i;throw new e.RuntimeError(e.RuntimeError.NOT_INIT_ERR)}o((r.runtime_order||n.order).split(/\s*,\s*/))},getRuntime:function(){return i&&i.uid?i:(i=null,null)},disconnectRuntime:function(){i&&--i.clients<=0&&(i.destroy(),i=null)}})}}),i(st,[Z,at,et],function(e,t,n){function i(){this.uid=e.guid("uid_"),t.call(this),this.destroy=function(){this.disconnectRuntime(),this.unbindAll()}}return i.prototype=n.instance,i}),i(lt,[Z,tt,at],function(e,t,n){function i(o,a){function s(t,n,o){var a,s=r[this.uid];return"string"===e.typeOf(s)&&s.length?(a=new i(null,{type:o,size:n-t}),a.detach(s.substr(t,a.size)),a):null}n.call(this),o&&this.connectRuntime(o),a?"string"===e.typeOf(a)&&(a={data:a}):a={},e.extend(this,{uid:a.uid||e.guid("uid_"),ruid:o,size:a.size||0,type:a.type||"",slice:function(e,t,n){return this.isDetached()?s.apply(this,arguments):this.getRuntime().exec.call(this,"Blob","slice",this.getSource(),e,t,n)},getSource:function(){return r[this.uid]?r[this.uid]:null},detach:function(e){this.ruid&&(this.getRuntime().exec.call(this,"Blob","destroy",r[this.uid]),this.disconnectRuntime(),this.ruid=null),e=e||"";var n=e.match(/^data:([^;]*);base64,/);n&&(this.type=n[1],e=t.atob(e.substring(e.indexOf("base64,")+7))),this.size=e.length,r[this.uid]=e},isDetached:function(){return!this.ruid&&"string"===e.typeOf(r[this.uid])},destroy:function(){this.detach(),delete r[this.uid]}}),a.data?this.detach(a.data):r[this.uid]=a}var r={};return i}),i(ut,[Z,at,tt],function(e,t,n){return function(){function i(e,t){if(!t.isDetached()){var i=this.connectRuntime(t.ruid).exec.call(this,"FileReaderSync","read",e,t);return this.disconnectRuntime(),i}var r=t.getSource();switch(e){case"readAsBinaryString":return r;case"readAsDataURL":return"data:"+t.type+";base64,"+n.btoa(r);case"readAsText":for(var o="",a=0,s=r.length;s>a;a++)o+=String.fromCharCode(r[a]);return o}}t.call(this),e.extend(this,{uid:e.guid("uid_"),readAsBinaryString:function(e){return i.call(this,"readAsBinaryString",e)},readAsDataURL:function(e){return i.call(this,"readAsDataURL",e)},readAsText:function(e){return i.call(this,"readAsText",e)}})}}),i(ct,[Q,Z,lt],function(e,t,n){function i(){var e,i={},r="";t.extend(this,{append:function(r,o){var a=this,s=t.typeOf(o);o instanceof n?(e&&delete i[e],e=r,i[r]=[o]):"array"===s?(r+="[]",t.each(o,function(e){a.append.call(a,r,e)})):"object"===s?t.each(o,function(e,t){a.append.call(a,r+"["+t+"]",e)}):(o=o.toString(),i[r]||(i[r]=[]),i[r].push(o))},hasBlob:function(){return!!e},getBlob:function(){return i[e]&&i[e][0]||null},getBlobName:function(){return e||null},each:function(e){t.each(i,function(n,i){t.each(n,function(t){e(t,i)})})},destroy:function(){e=null,r="",i={}}})}return i}),i(dt,[Z],function(e){var t={};return{addI18n:function(n){return e.extend(t,n)},translate:function(e){return t[e]||e},_:function(e){return this.translate(e)},sprintf:function(t){var n=[].slice.call(arguments,1),i="";return e.each(t.split(/%[a-z]/),function(e){i+=e,n.length&&(i+=n.shift())}),i}}}),i(ft,[Z,dt],function(e,t){var n="application/msword,doc dot,application/pdf,pdf,application/pgp-signature,pgp,application/postscript,ps ai eps,application/rtf,rtf,application/vnd.ms-excel,xls xlb,application/vnd.ms-powerpoint,ppt pps pot,application/zip,zip,application/x-shockwave-flash,swf swfl,application/vnd.openxmlformats-officedocument.wordprocessingml.document,docx,application/vnd.openxmlformats-officedocument.wordprocessingml.template,dotx,application/vnd.openxmlformats-officedocument.spreadsheetml.sheet,xlsx,application/vnd.openxmlformats-officedocument.presentationml.presentation,pptx,application/vnd.openxmlformats-officedocument.presentationml.template,potx,application/vnd.openxmlformats-officedocument.presentationml.slideshow,ppsx,application/x-javascript,js,application/json,json,audio/mpeg,mp3 mpga mpega mp2,audio/x-wav,wav,audio/mp4,m4a,audio/ogg,oga ogg,audio/aiff,aiff aif,audio/flac,flac,audio/aac,aac,audio/ac3,ac3,audio/x-ms-wma,wma,image/bmp,bmp,image/gif,gif,image/jpeg,jpg jpeg jpe,image/photoshop,psd,image/png,png,image/svg+xml,svg svgz,image/tiff,tiff tif,text/plain,asc txt text diff log,text/html,htm html xhtml,text/css,css,text/csv,csv,text/rtf,rtf,video/mpeg,mpeg mpg mpe m2v,video/quicktime,qt mov,video/mp4,mp4,video/x-m4v,m4v,video/x-flv,flv,video/x-ms-wmv,wmv,video/avi,avi,video/webm,webm,video/3gpp,3gpp 3gp,video/3gpp2,3g2,video/vnd.rn-realvideo,rv,video/ogg,ogv,video/x-matroska,mkv,application/vnd.oasis.opendocument.formula-template,otf,application/octet-stream,exe",i={mimes:{},extensions:{},addMimeType:function(e){var t=e.split(/,/),n,i,r;for(n=0;n<t.length;n+=2){for(r=t[n+1].split(/ /),i=0;i<r.length;i++)this.mimes[r[i]]=t[n];this.extensions[t[n]]=r}},extList2mimes:function(t){var n=this,i,r,o,a,s=[];e:for(r=0;r<t.length;r++)for(i=t[r].extensions.split(/\s*,\s*/),o=0;o<i.length;o++){if("*"===i[o]){s=[];break e}if(a=n.mimes[i[o]],!a)return[];a&&!~e.inArray(a,s)&&s.push(a)}return s},mimes2extList:function(n){var i=this,r=[],o=[];return n=e.trim(n).split(/\s*,\s*/),"*"!==n&&e.each(n,function(t){var n=t.match(/^(\w+)\/(\*|\w+)$/);n&&("*"===n[2]?e.each(i.extensions,function(e,t){new RegExp("^"+n[1]+"/").test(t)&&[].push.apply(r,i.extensions[t])}):i.extensions[t]&&[].push.apply(r,i.extensions[t]))}),o.push({title:t.translate("Files"),extensions:r.length?r.join(","):"*"}),o.mimes=n,o},getFileExtension:function(e){var t=e&&e.match(/\.([^.]+)$/);return t?t[1].toLowerCase():""},getFileMime:function(e){return this.mimes[this.getFileExtension(e)]||""}};return i.addMimeType(n),i}),i(pt,[Z,Q,et,tt,nt,ot,st,lt,ut,ct,it,ft],function(e,t,n,i,r,o,a,s,l,u,c,d){function f(){this.uid=e.guid("uid_")}function p(){function n(e,t){return y.hasOwnProperty(e)?1===arguments.length?c.can("define_property")?y[e]:v[e]:(c.can("define_property")?y[e]=t:v[e]=t,void 0):void 0}function l(t){function i(){L.destroy(),L=null,s.dispatchEvent("loadend"),s=null}function r(r){L.bind("LoadStart",function(e){n("readyState",p.LOADING),s.dispatchEvent("readystatechange"),s.dispatchEvent(e),D&&s.upload.dispatchEvent(e)}),L.bind("Progress",function(e){n("readyState")!==p.LOADING&&(n("readyState",p.LOADING),s.dispatchEvent("readystatechange")),s.dispatchEvent(e)}),L.bind("UploadProgress",function(e){D&&s.upload.dispatchEvent({type:"progress",lengthComputable:!1,total:e.total,loaded:e.loaded})}),L.bind("Load",function(t){n("readyState",p.DONE),n("status",Number(r.exec.call(L,"XMLHttpRequest","getStatus")||0)),n("statusText",h[n("status")]||""),n("response",r.exec.call(L,"XMLHttpRequest","getResponse",n("responseType"))),~e.inArray(n("responseType"),["text",""])?n("responseText",n("response")):"document"===n("responseType")&&n("responseXML",n("response")),z=r.exec.call(L,"XMLHttpRequest","getAllResponseHeaders"),s.dispatchEvent("readystatechange"),n("status")>0?(D&&s.upload.dispatchEvent(t),s.dispatchEvent(t)):(I=!0,s.dispatchEvent("error")),i()}),L.bind("Abort",function(e){s.dispatchEvent(e),i()}),L.bind("Error",function(e){I=!0,n("readyState",p.DONE),s.dispatchEvent("readystatechange"),k=!0,s.dispatchEvent(e),i()}),r.exec.call(L,"XMLHttpRequest","send",{url:b,method:w,async:x,user:E,password:C,headers:_,mimeType:T,encoding:R,responseType:s.responseType,withCredentials:s.withCredentials,options:O},t)}var s=this;M=(new Date).getTime(),L=new a,"string"==typeof O.required_caps&&(O.required_caps=o.parseCaps(O.required_caps)),O.required_caps=e.extend({},O.required_caps,{return_response_type:s.responseType}),t instanceof u&&(O.required_caps.send_multipart=!0),N||(O.required_caps.do_cors=!0),O.ruid?r(L.connectRuntime(O)):(L.bind("RuntimeInit",function(e,t){r(t)}),L.bind("RuntimeError",function(e,t){s.dispatchEvent("RuntimeError",t)}),L.connectRuntime(O))}function g(){n("responseText",""),n("responseXML",null),n("response",null),n("status",0),n("statusText",""),M=F=null}var v=this,y={timeout:0,readyState:p.UNSENT,withCredentials:!1,status:0,statusText:"",responseType:"",responseXML:null,responseText:null,response:null},x=!0,b,w,_={},E,C,R=null,T=null,A=!1,S=!1,D=!1,k=!1,I=!1,N=!1,M,F,H=null,P=null,O={},L,z="",W;e.extend(this,y,{uid:e.guid("uid_"),upload:new f,open:function(o,a,s,l,u){var c;if(!o||!a)throw new t.DOMException(t.DOMException.SYNTAX_ERR);if(/[\u0100-\uffff]/.test(o)||i.utf8_encode(o)!==o)throw new t.DOMException(t.DOMException.SYNTAX_ERR);if(~e.inArray(o.toUpperCase(),["CONNECT","DELETE","GET","HEAD","OPTIONS","POST","PUT","TRACE","TRACK"])&&(w=o.toUpperCase()),~e.inArray(w,["CONNECT","TRACE","TRACK"]))throw new t.DOMException(t.DOMException.SECURITY_ERR);if(a=i.utf8_encode(a),c=r.parseUrl(a),N=r.hasSameOrigin(c),b=r.resolveUrl(a),(l||u)&&!N)throw new t.DOMException(t.DOMException.INVALID_ACCESS_ERR);if(E=l||c.user,C=u||c.pass,x=s||!0,x===!1&&(n("timeout")||n("withCredentials")||""!==n("responseType")))throw new t.DOMException(t.DOMException.INVALID_ACCESS_ERR);A=!x,S=!1,_={},g.call(this),n("readyState",p.OPENED),this.convertEventPropsToHandlers(["readystatechange"]),this.dispatchEvent("readystatechange")},setRequestHeader:function(r,o){var a=["accept-charset","accept-encoding","access-control-request-headers","access-control-request-method","connection","content-length","cookie","cookie2","content-transfer-encoding","date","expect","host","keep-alive","origin","referer","te","trailer","transfer-encoding","upgrade","user-agent","via"];if(n("readyState")!==p.OPENED||S)throw new t.DOMException(t.DOMException.INVALID_STATE_ERR);if(/[\u0100-\uffff]/.test(r)||i.utf8_encode(r)!==r)throw new t.DOMException(t.DOMException.SYNTAX_ERR);return r=e.trim(r).toLowerCase(),~e.inArray(r,a)||/^(proxy\-|sec\-)/.test(r)?!1:(_[r]?_[r]+=", "+o:_[r]=o,!0)},getAllResponseHeaders:function(){return z||""},getResponseHeader:function(t){return t=t.toLowerCase(),I||~e.inArray(t,["set-cookie","set-cookie2"])?null:z&&""!==z&&(W||(W={},e.each(z.split(/\r\n/),function(t){var n=t.split(/:\s+/);2===n.length&&(n[0]=e.trim(n[0]),W[n[0].toLowerCase()]={header:n[0],value:e.trim(n[1])})})),W.hasOwnProperty(t))?W[t].header+": "+W[t].value:null},overrideMimeType:function(i){var r,o;if(~e.inArray(n("readyState"),[p.LOADING,p.DONE]))throw new t.DOMException(t.DOMException.INVALID_STATE_ERR);if(i=e.trim(i.toLowerCase()),/;/.test(i)&&(r=i.match(/^([^;]+)(?:;\scharset\=)?(.*)$/))&&(i=r[1],r[2]&&(o=r[2])),!d.mimes[i])throw new t.DOMException(t.DOMException.SYNTAX_ERR);H=i,P=o},send:function(n,r){if(O="string"===e.typeOf(r)?{ruid:r}:r?r:{},this.convertEventPropsToHandlers(m),this.upload.convertEventPropsToHandlers(m),this.readyState!==p.OPENED||S)throw new t.DOMException(t.DOMException.INVALID_STATE_ERR);if(n instanceof s)O.ruid=n.ruid,T=n.type||"application/octet-stream";else if(n instanceof u){if(n.hasBlob()){var o=n.getBlob();O.ruid=o.ruid,T=o.type||"application/octet-stream"}}else"string"==typeof n&&(R="UTF-8",T="text/plain;charset=UTF-8",n=i.utf8_encode(n));this.withCredentials||(this.withCredentials=O.required_caps&&O.required_caps.send_browser_cookies&&!N),D=!A&&this.upload.hasEventListener(),I=!1,k=!n,A||(S=!0),l.call(this,n)},abort:function(){if(I=!0,A=!1,~e.inArray(n("readyState"),[p.UNSENT,p.OPENED,p.DONE]))n("readyState",p.UNSENT);else{if(n("readyState",p.DONE),S=!1,!L)throw new t.DOMException(t.DOMException.INVALID_STATE_ERR);L.getRuntime().exec.call(L,"XMLHttpRequest","abort",k),k=!0}},destroy:function(){L&&("function"===e.typeOf(L.destroy)&&L.destroy(),L=null),this.unbindAll(),this.upload&&(this.upload.unbindAll(),this.upload=null)}})}var h={100:"Continue",101:"Switching Protocols",102:"Processing",200:"OK",201:"Created",202:"Accepted",203:"Non-Authoritative Information",204:"No Content",205:"Reset Content",206:"Partial Content",207:"Multi-Status",226:"IM Used",300:"Multiple Choices",301:"Moved Permanently",302:"Found",303:"See Other",304:"Not Modified",305:"Use Proxy",306:"Reserved",307:"Temporary Redirect",400:"Bad Request",401:"Unauthorized",402:"Payment Required",403:"Forbidden",404:"Not Found",405:"Method Not Allowed",406:"Not Acceptable",407:"Proxy Authentication Required",408:"Request Timeout",409:"Conflict",410:"Gone",411:"Length Required",412:"Precondition Failed",413:"Request Entity Too Large",414:"Request-URI Too Long",415:"Unsupported Media Type",416:"Requested Range Not Satisfiable",417:"Expectation Failed",422:"Unprocessable Entity",423:"Locked",424:"Failed Dependency",426:"Upgrade Required",500:"Internal Server Error",501:"Not Implemented",502:"Bad Gateway",503:"Service Unavailable",504:"Gateway Timeout",505:"HTTP Version Not Supported",506:"Variant Also Negotiates",507:"Insufficient Storage",510:"Not Extended"};f.prototype=n.instance;var m=["loadstart","progress","abort","error","load","timeout","loadend"],g=1,v=2;return p.UNSENT=0,p.OPENED=1,p.HEADERS_RECEIVED=2,p.LOADING=3,p.DONE=4,p.prototype=n.instance,p}),i(ht,[Z,ft,lt],function(e,t,n){function i(i,r){var o,a;if(r||(r={}),a=r.type&&""!==r.type?r.type:t.getFileMime(r.name),r.name)o=r.name.replace(/\\/g,"/"),o=o.substr(o.lastIndexOf("/")+1);else{var s=a.split("/")[0];o=e.guid((""!==s?s:"file")+"_"),t.extensions[a]&&(o+="."+t.extensions[a][0])}n.apply(this,arguments),e.extend(this,{type:a||"",name:o||e.guid("file_"),lastModifiedDate:r.lastModifiedDate||(new Date).toLocaleString()})}return i.prototype=n.prototype,i}),i(mt,[Z,Q,lt,ht,ut],function(e,t,n,i,r){function o(){function o(){var t="";return e.each(a,function(i){if("string"===e.typeOf(i))t+=i;else if(i instanceof n){var o=new r;t+=o.readAsBinaryString(i)}}),t}var a=[];e.extend(this,{uid:e.guid("uid_"),append:function(i){if("string"!==e.typeOf(i)&&!(i instanceof n))throw new t.DOMException(t.DOMException.TYPE_MISMATCH_ERR);a.push(i)},getBlob:function(e){var t=o(),i;return i=new n(null,{size:t.length,type:e}),i.detach(t),i},getFile:function(e,t){var n=o(),r;return r=new i(null,{size:n.length,type:e,name:t}),r.detach(n),r},destroy:function(){a=[]}})}return o}),i(gt,[v,g,D,l,X,$,J,K,Y,pt,ct,mt,tt,it,et],function(e,t,n,i,r,o,a,s,l,u,c,d,f,p,h){function m(e,t,n){return e>n?e=n:t>e&&(e=t),e}function g(){}var v=Math.floor,y={n:[.5,0,0,-1,0,1],e:[1,.5,1,0,0,0],s:[.5,1,0,1,0,0],w:[0,.5,-1,0,1,0],nw:[0,0,-1,-1,1,1],ne:[1,0,1,-1,0,1],se:[1,1,1,1,0,0],sw:[0,1,-1,1,1,0]};return e.extend({init:function(e){var t=this;t._super(e),t.addClass("imagecanvas"),t._mirror=t._rotation=0},applyAction:g,endAction:g,renderHtml:function(){var e=this,t=e._id,n=e.classPrefix;return'<div id="'+t+'" class="'+e.classes()+'">'+'<div id="'+t+'-clip" class="'+n+'imagecanvas-clip"></div>'+"</div>"},filter:function(e){var t=this;return t._currentFilter=t._currentFilter||t._imageEditor.filter(e),t._currentFilter},revert:function(){var e=this;e._imageEditor.hasCanvasSupport()?e._imageEditor.revert():e.loadFromPath(e.path,function(){e.tempname=null,e.zoom("fit"),e.fire("change")})},undo:function(){this._imageEditor.undo()},redo:function(){this._imageEditor.redo()},canUndo:function(){return this._imageEditor.canUndo()||!!this.tempname},canRedo:function(){return this._imageEditor.canRedo()},zoom:function(e){var n=this,i,r,o,a,s,l,u,c,d=20;return"undefined"!=typeof e?.1>e?n:(o=n.getEl(),a=o.offsetWidth-2,s=o.offsetHeight-2,l=n.size(),"fit"==e&&(e=Math.min((a-d)/l.w,(s-d)/l.h),e>=1&&(e=1)),n._zoom=e,i=v(l.w*e),r=v(l.h*e),n._zoomPos=u=n._zoomPos||{},u.x=a>i?v(a/2-i/2):0,u.y=s>r?v(s/2-r/2):0,u.w=i,u.h=r,c=n.getCanvas(),c&&t.css(c,{left:u.x,top:u.y,width:i,height:r}),t.css(n.getEl("clip"),{left:u.x,top:u.y,width:i,height:r}),t.css(t.get(n._id+"-img"),{width:i,height:r}),n.repaintCropRect(!0),n):n._zoom},startTransation:function(){this._imageEditor.hasCanvasSupport()&&(this.inTransact=!0,this._imageEditor.addUndoLevel(),this._imageEditor.setUndoEnabled(!1))},apply:function(){var e=this;e._currentFilter&&(e._currentFilter.save(),e._currentFilter=null),e.inTransact=!1,e._imageEditor.setUndoEnabled(!0),e.applyAction(),e.applyAction=g},cancel:function(){var e=this;e._currentFilter&&(e._currentFilter.cancel(),e._currentFilter=null),e.inTransact&&(e._imageEditor.undo(!0),e.inTransact=!1,e._imageEditor.setUndoEnabled(!0)),e.hasCanvasSupport()||(e._mirror=e._rotation=0,e.updateOldIE()),e.endAction(),e.applyAction=g},resize:function(e,t){var n=this;n.hasCanvasSupport()?n._imageEditor.resize({w:e,h:t}):o.exec("alterimage",{action:"alter",resize:{w:e,h:t},path:n.path,tempname:n.tempname},function(e){n.loadFromUrl(s.apiPageUrl+"?action=streamfile&stream=true&path="+encodeURIComponent(n.path)+"&tempname=true&r="+(new Date).getTime(),function(){n.zoom("fit"),n.tempname=e.tempname,n.fire("change")})})},flip:function(e){var t=this;t.hasCanvasSupport()?t._imageEditor.flip(e):(t._mirror=t._mirror?0:1,"v"==e&&(t._rotation=(t._rotation+180)%360),t.updateOldIE()),t.applyAction=function(){var e=t._imageEditor;e.hasCanvasSupport()||o.exec("alterimage",{action:"alter",rotate:t._rotation,flip:t._mirror?"h":null,path:t.path,tempname:t.tempname},function(e){t.loadFromUrl(s.apiPageUrl+"?action=streamfile&stream=true&path="+encodeURIComponent(t.path)+"&tempname=true&r="+(new Date).getTime(),function(){t.zoom("fit"),t.tempname=e.tempname,t.fire("change")})})}},rotate:function(e){var t=this;t.hasCanvasSupport()?t._imageEditor.rotate(e):(t._rotation=(t._rotation+(0>e?360+e:e))%360,t.updateOldIE()),t.applyAction=function(){var e=t._imageEditor;e.hasCanvasSupport()||o.exec("alterimage",{action:"alter",rotate:t._rotation,flip:t._mirror?"h":null,path:t.path,tempname:t.tempname},function(e){t.loadFromUrl(s.apiPageUrl+"?action=streamfile&stream=true&path="+encodeURIComponent(t.path)+"&tempname=true&r="+(new Date).getTime(),function(){t.zoom("fit"),t.tempname=e.tempname,t.fire("change")})})}},updateOldIE:function(){var e=this,n=t.get(e._id+"-img");n.style.filter="progid:DXImageTransform.Microsoft.BasicImage(rotation="+e._rotation/90+",mirror="+e._mirror+");",n.parentNode.style.width=n.offsetWidth+"px",n.parentNode.style.height=n.offsetHeight+"px"},redeye:function(e){var n=this;if(e=e||60,!n._redEyeInit){n.getEl("clip").appendChild(t.createFragment('<div id="'+n._id+'-circle" class="moxman-imagecanvas-circle"></div>'));var i=t.getPos(n.getEl("clip"));n.getEl("clip").style.overflow="hidden",n.on("mousemove",function(e){t.css(n.getEl("circle"),{left:e.clientX-i.x-n._redEyeRadius,top:e.clientY-i.y-n._redEyeRadius})}),n._redEyeInit=!0}t.css(n.getEl("circle"),{width:2*e,height:2*e,borderRadius:e}),n._redEyeRadius=e},crop:function(e,r,a,l){function u(){var e,n="",r=d._id,o=d.classPrefix;for(e in y)n+='<div id="'+r+"-"+e+'" class="'+o+'imagecanvas-handle" style="cursor:'+e+'-resize"></div>';i.each("top right bottom left middle".split(" "),function(e){n+='<div id="'+r+"-"+e+'" class="moxman-imagecanvas-ants moxman-imagecanvas-'+e+'"></div>'}),d.getEl().appendChild(t.createFragment('<div id="'+r+'-overlay" class="moxman-imagecanvas-overlay">'+n+"</div>"));var a=d.getEl("img").cloneNode(!0);a.id=r+"-mimg",d.getEl("middle").appendChild(a)}function c(){function e(e){var i=d.getEl(e);d.dragHelper=new n(d._id,{handle:i.id,start:function(e){g=d.zoom(),f=d._cropRect,r=e.screenX,o=e.screenY,a=f.x,s=f.y,l=f.w,u=f.h;for(var n in y)if(d._id+"-"+n==e.target.id){c=y[n],h=d.getEl(n);break}t.addClass(h,d.classPrefix+"imagecanvas-handle-selected")},drag:function(e){var t,n,i,p,h;i=p=0,t=v((e.screenX-r)/g),n=v((e.screenY-o)/g),f.x=t*c[4]+a,f.y=n*c[5]+s,f.x<0&&(i=f.x,f.x=0),f.y<0&&(p=f.y,f.y=0),f.w=t*c[2]+l+i,f.h=n*c[3]+u+p,h=d.size(),f.x+f.w>h.w&&(f.w=h.w-f.x,f.x=h.w-f.w),f.y+f.h>h.h&&(f.h=h.h-f.y,f.y=h.h-f.h),f.x=m(f.x,0,a+l),f.y=m(f.y,0,u+s),f.w=m(f.w,0,h.w),f.h=m(f.h,0,h.h),d.repaintCropRect()},stop:function(){t.removeClass(h,d.classPrefix+"imagecanvas-handle-selected")}})}var i,r,o,a,s,l,u,c,h,g;d.dragHelper=new n(d._id,{handle:d._id+"-mimg",start:function(e){f=d._cropRect,g=d.zoom(),r=e.screenX,o=e.screenY,a=f.x,s=f.y},drag:function(e){var t,n;t=v((e.screenX-r)/g),n=v((e.screenY-o)/g),f.x=t+a,f.y=n+s,f.x=m(f.x,0,p.w-f.w),f.y=m(f.y,0,p.h-f.h),d.repaintCropRect()}});for(i in y)e(i)}var d=this,f=d._cropRect,p=d.size();d._cropRect=f={x:e||0,y:r||0,w:a||p.w,h:l||p.h},f.w=m(f.w,0,p.w),f.h=m(f.h,0,p.h),f.x=m(f.x,0,p.w-f.w),f.y=m(f.y,0,p.h-f.h),d._cropInit?d.getEl("mimg").src=d.getEl("img").src:(d._cropInit=!0,u(),c()),d.addClass("imagecanvas-crop"),d.repaintCropRect(!0),d.applyAction=function(){var e=d._imageEditor;e.hasCanvasSupport()?e.crop(d._cropRect):o.exec("alterimage",{action:"alter",crop:d._cropRect,path:d.path,tempname:d.tempname},function(e){d.loadFromUrl(s.apiPageUrl+"?action=streamfile&stream=true&path="+encodeURIComponent(d.path)+"&tempname=true&r="+(new Date).getTime(),function(){d.zoom("fit"),d.tempname=e.tempname,d.fire("change")})})},d.endAction=function(){d.removeClass("imagecanvas-crop")}},repaintCropRect:function(e){function n(e,n){t.css(i.getEl(e),{left:n.x,top:n.y,width:n.w,height:n.h})}var i=this,r=i._cropRect,o,a,s,l,u=i.zoom(),c=i._zoomPos;if(r){o=v(r.x*u),a=v(r.y*u),s=v(r.w*u),l=v(r.h*u);for(var d in y){var f=y[d];n(d,{x:s*f[0]+o+c.x,y:l*f[1]+a+c.y})}if(e){n("clip",{x:c.x,y:c.y});var p=i.size();n("mimg",{w:v(p.w*u),h:v(p.h*u)}),n("img",{w:v(p.w*u),h:v(p.h*u)})}n("mimg",{x:-o,y:-a}),n("middle",{x:o+c.x,y:a+c.y,w:s,h:l}),n("top",{x:o+c.x,y:a+c.y,w:s}),n("right",{x:o+s+c.x,y:a+c.y,h:l}),n("bottom",{x:o+c.x,y:a+l+c.y,w:s}),n("left",{x:o+c.x,y:a+c.y,h:l}),i.fire("cropchange",{rect:r})}},loadFromPath:function(e,t){this.path=e,this.loadFromUrl(s.apiPageUrl+"?action=streamfile&stream=true&path="+encodeURIComponent(e)+"&r="+(new Date).getTime(),t)},loadFromUrl:function(e,n){var i=this,r,o=i.getEl("clip"),a=t.get(i._id+"-img");r=a||new Image,r.onload=function(){r.onload=g,i.size({w:r.naturalWidth||r.width||r.clientWidth,h:r.naturalHeight||r.height||r.clientHeight}),o.style.visibility="",n.call(i,r)},r.src=e,r.id=i._id+"-img",r.style.cssText="",o.style.visibility="hidden",a||o.appendChild(r)},saveAs:function(e,t,n){var i=this;if(i._imageEditor.hasCanvasSupport()){var r=i._imageEditor.getCanvas().toDataURL(/\.png$/i.test(e)?"image/png":"image/jpeg",.8);r=f.atob(r.substr(r.indexOf(",")+1)),p.swf_url=s.baseUrl+"/js/Moxie.swf",p.global_event_dispatcher="moxman.dispatchEvent",window.moxman.dispatchEvent=h.instance.dispatchEvent;var m=new d;m.append(r);var g=new c;g.append("file",m.getBlob());var v=new u;v.open("POST",s.apiPageUrl+"?action=upload&path="+encodeURIComponent(a.dirname(i.path))+"&name="+encodeURIComponent(e)+"&overwrite=true"),v.onload=function(){var e=l.parse(v.responseText);i.fire("change"),e.error?n(e.error):t(e.result)},v.send(g)}else{var y=a.join(a.dirname(i.path),e);o.exec("alterimage",{action:"save",path:y,tempname:i.tempname},function(e){i.loadFromUrl(s.apiPageUrl+"?action=streamfile&stream=true&path="+encodeURIComponent(y)+"&tempname=true&r="+(new Date).getTime(),function(){i.zoom("fit"),i.tempname=e.tempname,i.fire("change"),t(e)})})}},size:function(e){var t=this;return e?(t._size=e,t):t._size},getCanvas:function(){var e=this._imageEditor;return e?e.getCanvas():null},postRender:function(){var e=this;e._imageEditor=new r({viewport:e._id+"-clip",image:e._id+"-img",onchange:function(){e.size(e._imageEditor.getSize()),e.zoom(e.zoom()),e.fire("change")}}),e._super()},hasCanvasSupport:function(){return this._imageEditor.hasCanvasSupport()},hasWebGlSupport:function(){return this._imageEditor.hasWebGlSupport()}})}),i(vt,[g],function(e){return function(t){function n(){if(!h)if(h=[],d.find)d.find("*").each(function(e){e.canFocus&&h.push(e.getEl())});else for(var e=d.getEl().getElementsByTagName("*"),t=0;t<e.length;t++)e[t].id&&e[t]&&h.push(e[t])}function i(){return document.getElementById(m)}function r(e){return e=e||i(),e&&e.getAttribute("role")}function o(e){for(var t,n=e||i();n=n.parentNode;)if(t=r(n))return t}function a(e){var t=document.getElementById(m);return t?t.getAttribute("aria-"+e):void 0}function s(){var n=i();if(!n||"TEXTAREA"!=n.nodeName&&"text"!=n.type)return t.onAction?t.onAction(m):e.fire(i(),"click",{keyboard:!0}),!0}function l(){var e;t.onCancel?((e=i())&&e.blur(),t.onCancel()):t.root.fire("cancel")}function u(e){function i(e){for(var t=d?d.getEl():document.body;e&&e!=t;){if("none"==e.style.display)return!1;e=e.parentNode}return!0}var r=-1,o,a,l=[];for(n(),a=l.length,a=0;a<h.length;a++)i(h[a])&&l.push(h[a]);for(a=l.length;a--;)if(l[a].id===m){r=a;break}r+=e,0>r?r=l.length-1:r>=l.length&&(r=0),o=l[r],o.focus(),m=o.id,t.actOnFocus&&s()}function c(){var e,i;for(i=r(t.root.getEl()),n(),e=h.length;e--;)if("toolbar"==i&&h[e].id===m)return h[e].focus(),void 0;h[0].focus()}var d=t.root,f=t.enableUpDown!==!1,p=t.enableLeftRight!==!1,h=t.items,m;return d.on("keydown",function(e){var n=37,i=39,c=38,d=40,h=27,m=14,g=13,v=32,y=9,x;switch(e.keyCode){case n:p&&(t.leftAction?t.leftAction():u(-1),x=!0);break;case i:p&&("menuitem"==r()&&"menu"==o()?a("haspopup")&&s():u(1),x=!0);break;case c:f&&(u(-1),x=!0);break;case d:f&&("menuitem"==r()&&"menubar"==o()?s():"button"==r()&&a("haspopup")?s():u(1),x=!0);break;case y:x=!0,e.shiftKey?u(-1):u(1);break;case h:x=!0,l();break;case m:case g:case v:x=s()}x&&(e.stopPropagation(),e.preventDefault())}),d.on("focusin",function(e){n(),m=e.target.id}),{moveFocus:u,focusFirst:c,cancel:l}}}),i(yt,[b,g],function(e,t){return e.extend({init:function(e){var t=this;t._super(e),t.addClass("widget"),t.addClass("label"),t.canFocus=!1,e.multiline&&t.addClass("autoscroll"),e.strong&&t.addClass("strong")},initLayoutRect:function(){var e=this,n=e._super();if(e.settings.multiline){var i=t.getSize(e.getEl());i.width>n.maxW&&(n.minW=n.maxW,e.addClass("multiline")),e.getEl().style.width=n.minW+"px",n.startMinH=n.h=n.minH=Math.min(n.maxH,t.getSize(e.getEl()).height)}return n},repaint:function(){var e=this;return e.settings.multiline||(e.getEl().style.lineHeight=e.layoutRect().h+"px"),e._super()},text:function(e){var t=this;return t._rendered&&e&&this.innerHtml(t.encode(e)),t._super(e)},renderHtml:function(){var e=this,t=e.settings.forId;return'<label id="'+e._id+'" class="'+e.classes()+'"'+(t?' for="'+t:"")+'">'+e.encode(e._text)+"</label>"}})}),i(xt,[E,vt],function(e,t){return e.extend({Defaults:{role:"toolbar",layout:"flow"},init:function(e){var t=this;t._super(e),t.addClass("toolbar")},postRender:function(){var e=this;return e.items().addClass("toolbar-item"),e.keyNav=new t({root:e,enableLeftRight:!0}),e._super()}})}),i(bt,[xt],function(e){return e.extend({Defaults:{role:"menubar",containerCls:"menubar",defaults:{type:"menubutton"}}})}),i(wt,[w,_,bt],function(e,t,n){function i(e,t){for(;e;){if(t===e)return!0;e=e.parentNode}return!1}var r=e.extend({init:function(e){var t=this;t._renderOpen=!0,t._super(e),t.addClass("menubtn"),e.fixedWidth&&t.addClass("fixed-width"),t.aria("haspopup",!0),t.hasPopup=!0
},showMenu:function(){var e=this,n=e.settings,i;return e.menu&&e.menu.visible()?e.hideMenu():(e.menu||(i=n.menu||[],i.length?i={type:"menu",items:i}:i.type=i.type||"menu",e.menu=t.create(i).parent(e).renderTo(e.getContainerElm()),e.fire("createmenu"),e.menu.reflow(),e.menu.on("cancel",function(t){t.control===e.menu&&e.focus()}),e.menu.on("show hide",function(t){t.control==e.menu&&e.activeMenu("show"==t.type)}).fire("show"),e.aria("expanded",!0)),e.menu.show(),e.menu.layoutRect({w:e.layoutRect().w}),e.menu.moveRel(e.getEl(),e.isRtl()?["br-tr","tr-br"]:["bl-tl","tl-bl"]),void 0)},hideMenu:function(){var e=this;e.menu&&(e.menu.items().each(function(e){e.hideMenu&&e.hideMenu()}),e.menu.hide(),e.aria("expanded",!1))},activeMenu:function(e){this.toggleClass("active",e)},renderHtml:function(){var e=this,t=e._id,i=e.classPrefix,r=e.settings.icon?i+"ico "+i+"i-"+e.settings.icon:"";return e.aria("role",e.parent()instanceof n?"menuitem":"button"),'<div id="'+t+'" class="'+e.classes()+'" tabindex="-1">'+'<button id="'+t+'-open" role="presentation" type="button" tabindex="-1">'+(r?'<i class="'+r+'"></i>':"")+"<span>"+(e._text?(r?"\xa0":"")+e.encode(e._text):"")+"</span>"+' <i class="'+i+'caret"></i>'+"</button>"+"</div>"},postRender:function(){var e=this;return e.on("click",function(t){t.control===e&&i(t.target,e.getEl())&&(e.showMenu(),t.keyboard&&e.menu.items()[0].focus())}),e.on("mouseenter",function(t){var n=t.control,i=e.parent(),o;n&&i&&n instanceof r&&n.parent()==i&&(i.items().filter("MenuButton").each(function(e){e.hideMenu&&e!=n&&(e.menu&&e.menu.visible()&&(o=!0),e.hideMenu())}),o&&(n.focus(),n.showMenu()))}),e._super()},text:function(e){var t=this,n,i;if(t._rendered)for(i=t.getEl("open").getElementsByTagName("span"),n=0;n<i.length;n++)i[n].innerHTML=t.encode(e);return this._super(e)},remove:function(){this._super(),this.menu&&this.menu.remove()}});return r}),i(_t,[wt],function(e){return e.extend({init:function(e){var t=this,n,i,r,o,a;if(t._values=n=e.values,n){for(i=0;i<n.length;i++)r=n[i].selected||e.value===n[i].value,r&&(o=o||n[i].text,t._value=n[i].value);e.menu=n}e.text=e.text||o||n[0].text,t._super(e),t.addClass("listbox"),t.on("select",function(n){var i=n.control;a&&(n.lastControl=a),e.multiple?i.active(!i.active()):t.value(n.control.settings.value),a=i})},value:function(e){function t(e,n){e.items().each(function(e){i=e.value()===n,i&&(r=r||e.text()),e.active(i),e.menu&&t(e.menu,n)})}var n=this,i,r,o,a;if("undefined"!=typeof e){if(n.menu)t(n.menu,e);else for(o=n.settings.menu,a=0;a<o.length;a++)i=o[a].value==e,i&&(r=r||o[a].text),o[a].active=i;n.text(r||this.settings.text)}return n._super(e)}})}),i(Et,[b,_],function(e,t){return e.extend({Defaults:{border:0,role:"menuitem"},init:function(e){var t=this;t.hasPopup=!0,t._super(e),e=t.settings,t.addClass("menu-item"),e.menu&&t.addClass("menu-item-expand"),e.preview&&t.addClass("menu-item-preview"),("-"===t._text||"|"===t._text)&&(t.addClass("menu-item-sep"),t.aria("role","separator"),t.canFocus=!1,t._text="-"),e.selectable&&(t.aria("role","menuitemcheckbox"),t.aria("checked",!0),t.addClass("menu-item-checkbox"),e.icon="selected"),e.preview||e.selectable||t.addClass("menu-item-normal"),t.on("mousedown",function(e){e.preventDefault()}),t.on("mouseenter click",function(n){n.control===t&&(e.menu||"click"!==n.type?(t.showMenu(),n.keyboard&&setTimeout(function(){t.menu.items()[0].focus()},0)):(t.parent().hideAll(),t.fire("cancel"),t.fire("select")))}),e.menu&&t.aria("haspopup",!0)},hasMenus:function(){return!!this.settings.menu},showMenu:function(){var e=this,n=e.settings,i,r=e.parent();if(r.items().each(function(t){t!==e&&t.hideMenu()}),n.menu){i=e.menu,i?i.show():(i=n.menu,i.length?i={type:"menu",items:i}:i.type=i.type||"menu",r.settings.itemDefaults&&(i.itemDefaults=r.settings.itemDefaults),i=e.menu=t.create(i).parent(e).renderTo(e.getContainerElm()),i.reflow(),i.fire("show"),i.on("cancel",function(){e.focus()}),i.on("hide",function(t){t.control===i&&e.removeClass("selected")})),i._parentMenu=r,i.addClass("menu-sub");var o=i.testMoveRel(e.getEl(),e.isRtl()?["tl-tr","bl-br","tr-tl","br-bl"]:["tr-tl","br-bl","tl-tr","bl-br"]);i.moveRel(e.getEl(),o),o="menu-sub-"+o,i.removeClass(i._lastRel),i.addClass(o),i._lastRel=o,e.addClass("selected"),e.aria("expanded",!0)}},hideMenu:function(){var e=this;return e.menu&&(e.menu.items().each(function(e){e.hideMenu&&e.hideMenu()}),e.menu.hide(),e.aria("expanded",!1)),e},renderHtml:function(){var e=this,t=e._id,n=e.settings,i=e.classPrefix,r=e.encode(e._text),o=e.settings.icon,a="";return o&&e.parent().addClass("menu-has-icons"),n.image&&(o="none",a=" style=\"background-image: url('"+n.image+"')\""),o=i+"ico "+i+"i-"+(e.settings.icon||"none"),'<div id="'+t+'" class="'+e.classes()+'" tabindex="-1">'+("-"!==r?'<i class="'+o+'"'+a+"></i>&nbsp;":"")+("-"!==r?'<span id="'+t+'-text" class="'+i+'text">'+r+"</span>":"")+(n.shortcut?'<div id="'+t+'-shortcut" class="'+i+'menu-shortcut">'+n.shortcut+"</div>":"")+(n.menu?'<div class="'+i+'caret"></div>':"")+"</div>"},postRender:function(){var e=this,t=e.settings,n=t.textStyle;if("function"==typeof n&&(n=n.call(this)),n){var i=e.getEl("text");i&&i.setAttribute("style",n)}return e._super()},remove:function(){this._super(),this.menu&&this.menu.remove()}})}),i(Ct,[L,vt,Et,l],function(e,t,n,i){var r=e.extend({Defaults:{defaultType:"menuitem",border:1,layout:"stack",role:"menu"},init:function(e){var r=this;if(e.autohide=!0,e.constrainToViewport=!0,e.itemDefaults)for(var o=e.items,a=o.length;a--;)o[a]=i.extend({},e.itemDefaults,o[a]);r._super(e),r.addClass("menu"),r.keyNav=new t({root:r,enableUpDown:!0,enableLeftRight:!0,leftAction:function(){r.parent()instanceof n&&r.keyNav.cancel()},onCancel:function(){r.fire("cancel",{},!1),r.hide()}})},repaint:function(){return this.toggleClass("menu-align",!0),this._super(),this.getEl().style.height="",this.getEl("body").style.height="",this},cancel:function(){var e=this;e.hideAll(),e.fire("cancel"),e.fire("select")},hideAll:function(){var e=this;return this.find("menuitem").exec("hideMenu"),e._super()},preRender:function(){var e=this;return e.items().each(function(t){var n=t.settings;return n.icon||n.selectable?(e._hasIcons=!0,!1):void 0}),e._super()}});return r}),i(Rt,[L,P,g,vt,D],function(e,t,n,i,r){var o=e.extend({modal:!0,Defaults:{border:1,layout:"flex",containerCls:"panel",role:"dialog",callbacks:{submit:function(){this.fire("submit",{data:this.toJSON()})},close:function(){this.close()}}},init:function(e){var n=this;n._super(e),n.isRtl()&&n.addClass("rtl"),n.addClass("window"),n._fixed=!0,e.buttons&&(n.statusbar=new t({layout:"flex",border:"1 0 0 0",spacing:3,padding:10,align:"center",pack:n.isRtl()?"start":"end",defaults:{type:"button"},items:e.buttons}),n.statusbar.addClass("foot"),n.statusbar.parent(n)),n.on("click",function(e){-1!=e.target.className.indexOf(n.classPrefix+"close")&&n.close()}),n.aria("label",e.title),n._fullscreen=!1},recalc:function(){var e=this,t=e.statusbar,i,r,o;e._fullscreen&&(e.layoutRect(n.getWindowSize()),e.layoutRect().contentH=e.layoutRect().innerH),e._super(),i=e.layoutRect(),e.settings.title&&!e._fullscreen&&(r=i.headerW,r>i.w&&(e.layoutRect({w:r}),o=!0)),t&&(t.layoutRect({w:e.layoutRect().innerW}).recalc(),r=t.layoutRect().minW+i.deltaW,r>i.w&&(e.layoutRect({w:r}),o=!0)),o&&e.recalc()},initLayoutRect:function(){var e=this,t=e._super(),i=0,r;if(e.settings.title&&!e._fullscreen){r=e.getEl("head");var o=n.getSize(r);t.headerW=o.width,t.headerH=o.height,i+=t.headerH}e.statusbar&&(i+=e.statusbar.layoutRect().h),t.deltaH+=i,t.minH+=i,t.h+=i;var a=n.getWindowSize();return t.x=Math.max(0,a.w/2-t.w/2),t.y=Math.max(0,a.h/2-t.h/2),t},renderHtml:function(){var e=this,t=e._layout,n=e._id,i=e.classPrefix,r=e.settings,o="",a="",s=r.html;return e.preRender(),t.preRender(e),r.title&&(o='<div id="'+n+'-head" class="'+i+'window-head">'+'<div class="'+i+'title">'+e.encode(r.title)+"</div>"+'<button type="button" class="'+i+'close" aria-hidden="true">&times;</button>'+'<div id="'+n+'-dragh" class="'+i+'dragh"></div>'+"</div>"),r.url&&(s='<iframe src="'+r.url+'" tabindex="-1"></iframe>'),"undefined"==typeof s&&(s=t.renderHtml(e)),e.statusbar&&(a=e.statusbar.renderHtml()),'<div id="'+n+'" class="'+e.classes()+'" hideFocus="1" tabIndex="-1">'+o+'<div id="'+n+'-body" class="'+e.classes("body")+'">'+s+"</div>"+a+"</div>"},fullscreen:function(e){var t=this,i=document.documentElement,r,o=t.classPrefix,a;if(e!=t._fullscreen)if(n.on(window,"resize",function(){var e;if(t._fullscreen)if(r)t._timer||(t._timer=setTimeout(function(){var e=n.getWindowSize();t.moveTo(0,0).resizeTo(e.w,e.h),t._timer=0},50));else{e=(new Date).getTime();var i=n.getWindowSize();t.moveTo(0,0).resizeTo(i.w,i.h),(new Date).getTime()-e>50&&(r=!0)}}),a=t.layoutRect(),t._fullscreen=e,e){t._initial={x:a.x,y:a.y,w:a.w,h:a.h},t._borderBox=t.parseBox("0"),t.getEl("head").style.display="none",a.deltaH-=a.headerH+2,n.addClass(i,o+"fullscreen"),n.addClass(document.body,o+"fullscreen"),t.addClass("fullscreen");var s=n.getWindowSize();t.moveTo(0,0).resizeTo(s.w,s.h)}else t._borderBox=t.parseBox(t.settings.border),t.getEl("head").style.display="",a.deltaH+=a.headerH,n.removeClass(i,o+"fullscreen"),n.removeClass(document.body,o+"fullscreen"),t.removeClass("fullscreen"),t.moveTo(t._initial.x,t._initial.y).resizeTo(t._initial.w,t._initial.h);return t.reflow()},postRender:function(){var e=this,t=[],n,o,a;setTimeout(function(){e.addClass("in")},0),e.keyboardNavigation=new i({root:e,enableLeftRight:!1,enableUpDown:!1,items:t,onCancel:function(){e.close()}}),e.find("*").each(function(e){e.canFocus&&(o=o||e.settings.autofocus,n=n||e,"filepicker"==e.type?(t.push(e.getEl("inp")),e.getEl("open")&&t.push(e.getEl("open"))):t.push(e.getEl()))}),e.statusbar&&e.statusbar.find("*").each(function(e){e.canFocus&&(o=o||e.settings.autofocus,n=n||e,t.push(e.getEl()))}),e._super(),e.statusbar&&e.statusbar.postRender(),!o&&n&&n.focus(),this.dragHelper=new r(e._id+"-dragh",{start:function(){a={x:e.layoutRect().x,y:e.layoutRect().y}},drag:function(t){e.moveTo(a.x+t.deltaX,a.y+t.deltaY)}}),e.on("submit",function(t){t.isDefaultPrevented()||e.close()})},submit:function(){return this.fire("submit",{data:this.toJSON()})},remove:function(){var e=this,t=e.classPrefix;e.dragHelper.destroy(),e._super(),e.statusbar&&this.statusbar.remove(),e._fullscreen&&(n.removeClass(document.documentElement,t+"fullscreen"),n.removeClass(document.body,t+"fullscreen"))}});return o}),i(Tt,[Rt],function(e){var t=e.extend({init:function(e){e={border:1,padding:20,layout:"flex",pack:"center",align:"center",containerCls:"panel",autoScroll:!0,buttons:{type:"button",text:"Ok",action:"ok"},items:{type:"label",multiline:!0,maxWidth:500,maxHeight:200}},this._super(e)},Statics:{OK:1,OK_CANCEL:2,YES_NO:3,YES_NO_CANCEL:4,msgBox:function(n){var i,r=n.callback||function(){};switch(n.buttons){case t.OK_CANCEL:i=[{type:"button",text:"Ok",subtype:"primary",onClick:function(e){e.control.parents()[1].close(),r(!0)}},{type:"button",text:"Cancel",onClick:function(e){e.control.parents()[1].close(),r(!1)}}];break;case t.YES_NO:i=[{type:"button",text:"Ok",subtype:"primary",onClick:function(e){e.control.parents()[1].close(),r(!0)}}];break;case t.YES_NO_CANCEL:i=[{type:"button",text:"Ok",subtype:"primary",onClick:function(e){e.control.parents()[1].close()}}];break;default:i=[{type:"button",text:"Ok",subtype:"primary",onClick:function(e){e.control.parents()[1].close(),r(!0)}}]}return new e({padding:20,x:n.x,y:n.y,minWidth:300,minHeight:100,layout:"flex",pack:"center",align:"center",buttons:i,title:n.title,items:{type:"label",multiline:!0,maxWidth:500,maxHeight:200,text:n.text},onClose:n.onClose}).renderTo(document.body).reflow()},alert:function(e,n){return"string"==typeof e&&(e={text:e}),e.callback=n,t.msgBox(e)},confirm:function(e,n){return"string"==typeof e&&(e={text:e}),e.callback=n,e.buttons=t.OK_CANCEL,t.msgBox(e)}}});return t}),i(At,[w,L],function(e,t){return e.extend({showPanel:function(){var e=this,n=e.settings;if(e.active(!0),e.panel)e.panel.show();else{var i=n.panel;i.type&&(i={layout:"grid",items:i}),i.popover=!0,i.autohide=!0,e.panel=new t(i).on("hide",function(){e.active(!1)}).parent(e).renderTo(e.getContainerElm()),e.panel.fire("show"),e.panel.reflow()}e.panel.moveRel(e.getEl(),n.popoverAlign||(e.isRtl()?["bc-tr","bc-tc"]:["bc-tl","bc-tc"]))},hidePanel:function(){var e=this;e.panel&&e.panel.hide()},postRender:function(){var e=this;return e.on("click",function(t){t.control===e&&(e.panel&&e.panel.visible()?e.hidePanel():e.showPanel())}),e._super()}})}),i(St,[b,vt],function(e,t){return e.extend({init:function(e){var t=this;e.delimiter||(e.delimiter="\xbb"),t._super(e),t.addClass("path"),t.canFocus=!0,t.on("click",function(e){var n,i=e.target;(n=i.getAttribute("data-index"))&&t.fire("select",{value:t.data()[n],index:n})})},focus:function(){var e=this;return e.keyNav=new t({root:e,enableLeftRight:!0}),e.keyNav.focusFirst(),e},data:function(e){var t=this;return"undefined"!=typeof e?(t._data=e,t.update(),t):t._data},update:function(){this.innerHtml(this._getPathHtml())},postRender:function(){var e=this;e._super(),e.data(e.settings.data)},renderHtml:function(){var e=this;return'<div id="'+e._id+'" class="'+e.classes()+'">'+e._getPathHtml()+"</div>"},_getPathHtml:function(){var e=this,t=e._data||[],n,i,r="",o=e.classPrefix;for(n=0,i=t.length;i>n;n++)r+=(n>0?'<div class="'+o+'divider" aria-hidden="true"> '+e.settings.delimiter+" </div>":"")+'<div role="button" class="'+o+"path-item"+(n==i-1?" "+o+"last":"")+'" data-index="'+n+'" tabindex="-1" id="'+e._id+"-"+n+'">'+t[n].name+"</div>";return r||(r='<div class="'+o+'path-item">&nbsp;</div>'),r}})}),i(Dt,[b],function(e){return e.extend({init:function(e){var t=this;t._super(e),t.addClass("progress")},value:function(e){var t=this;return"undefined"!=typeof e?(t._value=e,t._rendered&&(t.getEl().firstChild.innerHTML=e+"%",t.getEl().lastChild.style.width=e+"%"),t):t._value},renderHtml:function(){var e=this,t=e._id,n=this.classPrefix;return'<div id="'+t+'" class="'+e.classes()+'">'+'<div class="'+n+'text">0%</div>'+'<div class="'+n+'bar"></div>'+"</div>"},postRender:function(){var e=this;return e._super(),e.value(e.settings.value),e}})}),i(kt,[T],function(e){return e.extend({Defaults:{classes:"radio",role:"radio"}})}),i(It,[E],function(e){return e.extend({})}),i(Nt,[b,D,g],function(e,t,n){function i(e,t,n){return t>e&&(e=t),e>n&&(e=n),e}return e.extend({init:function(e){var t=this;e.previewFilter||(e.previewFilter=function(e){return Math.round(100*e)/100}),t._super(e),t.addClass("slider"),"v"==e.orientation&&t.addClass("vertical"),t._minValue=e.minValue||0,t._maxValue=e.maxValue||100,t.value("undefined"!=typeof e.value?e.value:0),t._initValue=t._value},renderHtml:function(){var e=this,t=e._id,n=e.classPrefix;return'<div id="'+t+'" class="'+e.classes()+'">'+'<div id="'+t+'-handle" class="'+n+'slider-handle"></div>'+"</div>"},reset:function(){this.value(this._initValue).repaint()},value:function(e){var t=this;return"undefined"!=typeof e?(t.fire("change"),t._value=i(e,t._minValue,t._maxValue),t):t._value},postRender:function(){var e=this,r,o,a=0,s,l,u,c,d,f,p,h;l=e._minValue,u=e._maxValue,s=e.value(),"v"==e.settings.orientation?(d="screenY",f="top",p="height",h="h"):(d="screenX",f="left",p="width",h="w"),e._super(),e._dragHelper=new t(e._id,{handle:e._id+"-handle",start:function(t){r=t[d],o=parseInt(e.getEl("handle").style[f],10),c=(e.layoutRect()[h]||100)-n.getSize(e.getEl("handle"))[p],e.fire("dragstart",{value:s})},drag:function(t){var n=t[d]-r,p=e.getEl("handle");a=i(o+n,0,c),p.style[f]=a+"px",s=l+a/c*(u-l),e.value(s),e.tooltip().text(""+e.settings.previewFilter(s)).show().moveRel(p,"bc tc"),e.fire("drag",{value:s})},stop:function(){e.tooltip().hide(),e.fire("dragend",{value:s})}})},repaint:function(){var e=this,t,i,r,o;"v"==e.settings.orientation?(o="top",r="height",i="h"):(o="left",r="width",i="w"),t=(e.layoutRect()[i]||100)-n.getSize(e.getEl("handle"))[r],e._super(),e.getEl("handle").style[o]=t*((e.value()-e._minValue)/(e._maxValue-e._minValue))+"px",e.getEl("handle").style.height=e.layoutRect().h+"px"}})}),i(Mt,[b],function(e){return e.extend({renderHtml:function(){var e=this;return e.addClass("spacer"),e.canFocus=!1,'<div id="'+e._id+'" class="'+e.classes()+'"></div>'}})}),i(Ft,[wt,g],function(e,t){return e.extend({Defaults:{classes:"widget btn splitbtn",role:"splitbutton"},repaint:function(){var e=this,n=e.getEl(),i=e.layoutRect(),r,o,a;return e._super(),r=n.firstChild,o=n.lastChild,t.css(r,{width:i.w-t.getSize(o).width,height:i.h-2}),t.css(o,{height:i.h-2}),a=r.firstChild.style,a.width=a.height="100%",a=o.firstChild.style,a.width=a.height="100%",e},activeMenu:function(e){var n=this;t.toggleClass(n.getEl().lastChild,n.classPrefix+"active",e)},renderHtml:function(){var e=this,t=e._id,n=e.classPrefix,i=e.settings.icon?n+"ico "+n+"i-"+e.settings.icon:"";return'<div id="'+t+'" class="'+e.classes()+'">'+'<button type="button" hidefocus tabindex="-1">'+(i?'<i class="'+i+'"></i>':"")+(e._text?(i?" ":"")+e._text:"")+"</button>"+'<button type="button" class="'+n+'open" hidefocus tabindex="-1">'+(e._menuBtnText?(i?"\xa0":"")+e._menuBtnText:"")+' <i class="'+n+'caret"></i>'+"</button>"+"</div>"},postRender:function(){var e=this,t=e.settings.onclick;return e.on("click",function(e){var n=e.target;if(e.control==this)for(;n;){if("BUTTON"==n.nodeName&&-1==n.className.indexOf("open"))return e.stopImmediatePropagation(),t.call(this,e),void 0;n=n.parentNode}}),delete e.settings.onclick,e._super()}})}),i(Ht,[z],function(e){return e.extend({Defaults:{containerClass:"stack-layout",controlClass:"stack-layout-item",endClass:"break"}})}),i(Pt,[P,g],function(e,t){return e.extend({lastIdx:0,Defaults:{layout:"absolute",defaults:{type:"panel"}},activateTab:function(e){this.activeTabId&&t.removeClass(this.getEl(this.activeTabId),this.classPrefix+"active"),this.activeTabId="t"+e,t.addClass(this.getEl("t"+e),this.classPrefix+"active"),e!=this.lastIdx&&(this.items()[this.lastIdx].hide(),this.lastIdx=e),this.items()[e].show().fire("showtab"),this.reflow()},renderHtml:function(){var e=this,t=e._layout,n="",i=e.classPrefix;return e.preRender(),t.preRender(e),e.items().each(function(t,r){n+='<div id="'+e._id+"-t"+r+'" class="'+i+'tab" unselectable="on">'+e.encode(t.settings.title)+"</div>"}),'<div id="'+e._id+'" class="'+e.classes()+'" hideFocus="1" tabIndex="-1">'+'<div id="'+e._id+'-head" class="'+i+'tabs">'+n+"</div>"+'<div id="'+e._id+'-body" class="'+e.classes("body")+'">'+t.renderHtml(e)+"</div>"+"</div>"},postRender:function(){var e=this;e._super(),e.settings.activeTab=e.settings.activeTab||0,e.activateTab(e.settings.activeTab),this.on("click",function(t){var n=t.target.parentNode;if(t.target.parentNode.id==e._id+"-head")for(var i=n.childNodes.length;i--;)n.childNodes[i]==t.target&&e.activateTab(i)})},initLayoutRect:function(){var e=this,n,i,r;i=t.getSize(e.getEl("head")).width,i=0>i?0:i,r=0,e.items().each(function(t,n){i=Math.max(i,t.layoutRect().minW),r=Math.max(r,t.layoutRect().minH),e.settings.activeTab!=n&&t.hide()}),e.items().each(function(e){e.settings.x=0,e.settings.y=0,e.settings.w=i,e.settings.h=r,e.layoutRect({x:0,y:0,w:i,h:r})});var o=t.getSize(e.getEl("head")).height;return e.settings.minWidth=i,e.settings.minHeight=r+o,n=e._super(),n.deltaH+=o,n.innerH=n.h-n.deltaH,n}})}),i(Ot,[b,g],function(e,t){return e.extend({init:function(e){var t=this;t._super(e),t._value=e.value||"",t.addClass("textbox"),e.multiline?t.addClass("multiline"):t.on("keydown",function(e){13==e.keyCode&&t.parents().reverse().each(function(t){return e.preventDefault(),t.hasEventListeners("submit")&&t.toJSON?(t.fire("submit",{data:t.toJSON()}),!1):void 0})})},disabled:function(e){var t=this;return t._rendered&&"undefined"!=typeof e&&(t.getEl().disabled=e),t._super(e)},value:function(e){var t=this;return"undefined"!=typeof e?(t._value=e,t._rendered&&(t.getEl().value=e),t):t._rendered?t.getEl().value:t._value},repaint:function(){var e=this,t,n,i,r=0,o=0,a;t=e.getEl().style,n=e._layoutRect,a=e._lastRepaintRect||{};var s=document;return!e.settings.multiline&&s.all&&(!s.documentMode||s.documentMode<=8)&&(t.lineHeight=n.h-o+"px"),i=e._borderBox,r=i.left+i.right+8,o=i.top+i.bottom+(e.settings.multiline?8:0),n.x!==a.x&&(t.left=n.x+"px",a.x=n.x),n.y!==a.y&&(t.top=n.y+"px",a.y=n.y),n.w!==a.w&&(t.width=n.w-r+"px",a.w=n.w),n.h!==a.h&&(t.height=n.h-o+"px",a.h=n.h),e._lastRepaintRect=a,e.fire("repaint",{},!1),e},renderHtml:function(){var e=this,t=e._id,n=e.settings,i=e.encode(e._value,!1),r="";return"spellcheck"in n&&(r+=' spellcheck="'+n.spellcheck+'"'),n.maxLength&&(r+=' maxlength="'+n.maxLength+'"'),n.size&&(r+=' size="'+n.size+'"'),n.subtype&&(r+=' type="'+n.subtype+'"'),e.disabled()&&(r+=' disabled="disabled"'),n.multiline?'<textarea id="'+t+'" class="'+e.classes()+'" '+(n.rows?' rows="'+n.rows+'"':"")+' hidefocus="true"'+r+">"+i+"</textarea>":'<input id="'+t+'" class="'+e.classes()+'" value="'+i+'" hidefocus="true"'+r+">"},postRender:function(){var e=this;return t.on(e.getEl(),"change",function(t){e.fire("change",t)}),e._super()},remove:function(){t.off(this.getEl()),this._super()}})}),i(Lt,[g],function(e){return function(t){var n=this,i;n.show=function(r){return n.hide(),i=!0,window.setTimeout(function(){i&&t.appendChild(e.createFragment('<div class="moxman-throbber"></div>'))},r||0),n},n.hide=function(){var e=t.lastChild;return e&&-1!=e.className.indexOf("throbber")&&e.parentNode.removeChild(e),i=!1,n}}}),i(zt,[E,g,l,K],function(e,t,n,i){return e.extend({Defaults:{layout:"flow",classes:"thumbnailview"},init:function(e){var i=this;i._super(e),i.on("click",function(e){var r,o,a,s=e.target;do{if(-1!=s.className.indexOf("info")){if(s.parentNode.getAttribute("data-moxman-isparent"))break;a=s.parentNode,o=n.inArray(a,a.parentNode.childNodes),r=!i.isSelected(o),i.setRowState(o,o,r);break}if(t.hasClass(s,"moxman-image")){a=s,o=n.inArray(a,a.parentNode.childNodes);var l=i.data()[o];i.fire("thumbclick",{cellIndex:1,row:l,value:l.name,rowIndex:o,inValue:!0})}s=s.parentNode}while(s!=i.getEl())}),i.on("show",function(){i.update()})},clear:function(){return this._data=[],this._selected={},this.getEl("body").innerHTML="",this},data:function(e){var t=this;if("undefined"!=typeof e){for(var n=e.length;n--;)e[n].index=n;return t._data=e,t._selected={},t.update(),t}return t._data},append:function(e){var t=this,n=t._data;if("undefined"!=typeof e){for(var i=e.length;i--;)e[i].index=n.length-1+i;return t._data=t._data.concat(e),t.update(e),t.repaint(),t}return t._data},isSelected:function(e){return!!this._selected[e]},selected:function(){var e=this,t=e._data,n,i,r=e._selected,o=[];for(n=0,i=t.length;i>n;n++)r[n]&&o.push(t[n]);return o},unselect:function(e,t){return this.setRowState(e,t,!1)},select:function(e,t){return this.setRowState(e,t,!0)},setRowState:function(e,n,i){var r=this,o,a,s,l;"undefined"==typeof e&&"undefined"==typeof n?(e=0,n=r._data.length):"undefined"==typeof n&&(n=e),l=r._data.length-1,e=e?e>l?l:e:0,n=n?n>l?l:n:0,a=r._selected,a||(r._selected=a={}),e>n&&(s=e,e=n,n=s);var u;for(r._rendered&&(u=r.getEl("body").childNodes),o=e;n>=o;o++)a[o]=i,u&&t.toggleClass(u[o],r.classPrefix+"checked",i);return r.fire("select",{selected:r.selected()}),r},update:function(e){function n(e,t,n){function i(e,i){return e=parseFloat(e[t]),i=parseFloat(i[t]),e=isNaN(e)?0:e,i=isNaN(i)?0:i,n?e-i:i-e}function r(e,i){return e=(""+e[t]).toLowerCase(),i=(""+i[t]).toLowerCase(),n?e.localeCompare(i):i.localeCompare(e)}function o(e,i){return e=e[t].getTime(),i=i[t].getTime(),e=isNaN(e)?0:e,i=isNaN(i)?0:i,n?e-i:i-e}if(e.length){var a=e[0][t],s=r;a instanceof Date&&(s=o),"number"==typeof a&&(s=i),e=e.sort(s)}return e}var r=this,o="",a,s,l=e||r.data(),u=r.settings,c=r.classPrefix;if(r.visible()){for(u.sortBy&&u.autoSort!==!1&&(l=n(l,"index",!0),l=n(l,r._sortBy,r._sortOrder)),l=r.fire("beforeUpdate",{data:l}).data,a=0;a<l.length;a++){s=l[a];var d={row:s};u.filter&&u.filter(d);var f=d.icon,p=s.path;s.info&&s.info.link&&(p=s.info.link);var h=s.thumbnailUrl;h||(h=i.apiPageUrl+"?action=streamfile&stream=true&path="+encodeURIComponent(p)+"&thumb=true&u="+s.size),o+='<div class="'+c+'image" unselectable="on" data-moxman-isparent="'+(d.row.isParent?"parent":"")+'">'+(s.thumbnail?'<img src="'+h+'" />':"")+(f&&!s.thumbnail?'<i class="'+c+"ico "+c+"thumb "+c+"i-"+f+'"></i>':"")+'<div class="'+c+'info" title="'+d.row.name+'">'+(d.row.isParent?"":'<i class="'+c+"ico "+c+'i-checkbox"></i>')+d.row.name+"</div>"+"</div>"}e?r.getEl("body").appendChild(t.createFragment(o)):(r.getEl().scrollTop=0,r.getEl("body").innerHTML=o,r.getEl().scrollTop=1,r._selected={},r._data=l)}},postRender:function(){var e=this;return e._super(),e.data(e.settings.data||[]),e}})}),i(Wt,[E],function(e){var t=e.extend({Defaults:{defaultType:"treeitem",layout:"stack",expanded:!1},init:function(e){this._super(e),e=this.settings,this.addClass("treeitem"),this.addClass("treeitem-body","body"),this.addClass("treeitem-title","title"),(e.expanded||e.fixed)&&this.open(),e.fixed&&this.addClass("treeitem-title-fixed","title")},open:function(){this.addClass("treeitem-expanded","body"),this.addClass("treeitem-title-expanded","title"),this.expanded=!0},close:function(){this.removeClass("treeitem-expanded","body"),this.removeClass("treeitem-title-expanded","title"),this.expanded=!1,this.find("treeitem").exec("close")},selected:function(e){this.removeClass("treeitem-title-selected","title"),e&&this.addClass("treeitem-title-selected","title")},renderHtml:function(){var e=this,n=e._layout,i=e.settings,r,o,a="",s=e.classPrefix;for(e.preRender(),n.preRender(e),o=e,r=0;o&&o instanceof t;)r++,o.depth=r,o=o.parent();return i.icon?a='<i class="'+s+"ico "+s+"i-"+i.icon+'"></i>':i.iconUrl&&(a='<i class="'+s+'ico" style="background-image: url(\''+i.iconUrl+"')\"></i>"),'<span id="'+e._id+'" class="'+e.classes()+'"><span id="'+e._id+'-title" class="'+e.classes("title")+'" style="padding-left: '+10*r+'px">'+'<i class="'+s+"expander "+(e.items().length?"":s+"hidden")+'"></i>'+a+'<span id="'+e._id+'-text" class="'+s+'text" unselectable="true">'+e.encode(e._text)+"</span>"+"</span>"+'<span id="'+e._id+'-body" class="'+e.classes("body")+'">'+n.renderHtml(e)+"</span></span>"}});return t}),i(Bt,[P,Wt],function(e,t){return e.extend({Defaults:{defaultType:"treeitem",layout:"stack"},init:function(e){var n=this;n._super(e),n.on("click",function(e){var i=e.control;i instanceof t&&(e.preventDefault(),i.settings.fixed||(n.find("treeitem").removeClass("treeitem-title-selected","title"),i.addClass("treeitem-title-selected","title"),i.items().length>0&&(i.expanded?i.close():i.open())))})}})}),i(Ut,[u],function(e){return e.extend({render:function(){}})}),i(jt,[E,g],function(e,t){return e.extend({Defaults:{defaultType:"panel"},init:function(e){var t=this;this._super(e),t.addClass("viewport")},postRender:function(){var e=this,n=document.documentElement,i,r=e.classPrefix;t.addClass(n,r+"viewport"),t.addClass(document.body,r+"viewport"),t.on(window,"resize",function(){var t;i?e._timer||(e._timer=setTimeout(function(){e.reflow(),e._timer=0},50)):(t=(new Date).getTime(),e.reflow(),(new Date).getTime()-t>50&&(i=!0))}),e._super(),e.reflow()},recalc:function(){var e=this,n=t.getWindowSize();return e.layoutRect(n),e._super()},remove:function(){var e=document,n=this.classPrefix;return t.removeClass(e.documentElement,n+"viewport"),t.removeClass(e.body,n+"viewport"),this._super()}})}),i(qt,[],function(){var e="January February March April May June July August September October November December".split(" "),t="Jan Feb Mar Apr May Jun Jul Aug Sep Oct Nov Dec".split(" "),n="Sunday Monday Tuesday Wednesday Thursday Friday Saturday".split(" "),i="Sun Mon Tue Wed Thu Fri Sat".split(" ");return{format:function(r,o){function a(e){return(10>e?"0":"")+e}function s(e,t){o=o.replace(e,t)}return r.getTime||(r=new Date(r)),o=o||"%Y-%d-%m %H:%M:%S",s("%D","%m/%d/%Y"),s("%r","%I:%M:%S %p"),s("%Y",""+r.getFullYear()),s("%y",""+r.getYear()),s("%m",a(r.getMonth()+1)),s("%d",a(r.getDate())),s("%H",""+a(r.getHours())),s("%M",""+a(r.getMinutes())),s("%S",""+a(r.getSeconds())),s("%I",""+((r.getHours()+11)%12+1)),s("%p",""+(r.getHours()<12?"AM":"PM")),s("%B",""+e[r.getMonth()]),s("%b",""+t[r.getMonth()]),s("%A",""+n[r.getDay()]),s("%a",""+i[r.getDay()]),s("%%","%"),o}}}),i(Vt,[],function(){function e(e,t){var n,i,r;for(t=t.split(" "),r=t.length;r--;){if(n=t[r],i=e[n],"undefined"!=typeof i)return i;n=n.substr(0,1).toUpperCase()+n.substr(1);for(var o="o ms moz webkit".split(" "),a=o.length;a--;)if(i=e[o[a]+n],"undefined"!=typeof i)return i}}return{canFullScreen:function(){return e(document,"fullScreenEnabled FullscreenEnabled")===!0},isFullScreen:function(){return e(document,"isFullScreen fullScreen")},requestFullScreen:function(t){t=t||document.body,e(t,"requestFullScreen").call(t)},cancelFullScreen:function(){e(document,"cancelFullScreen").call(document)}}}),i(Xt,[],function(){function e(e){for(var t=window,n=e.split(/\//),i=0;i<n.length;++i){if(!t[n[i]])return;t=t[n[i]]}return t}var t=e("moxman/util/I18n");if(t)return t;var n={};return{add:function(e,t){for(var i in t)n[i]=t[i]},translate:function(e){if("undefined"==typeof e)return e;if("string"!=typeof e&&"raw"in e)return e.raw;if(e.push){var t=e.slice(1);e=(n[e[0]]||e[0]).replace(/\{([^\}]+)\}/g,function(e,n){return t[n]})}return n[e]||e},data:n}}),i(Yt,[l],function(e){function t(e,t){function n(n){function o(o){a.parentNode.removeChild(a),i[n]=o,r++==e.length-1&&t(i)}var a=new Image;a.onload=function(){o({url:e[n],width:a.clientWidth,height:a.clientHeight})},a.onerror=function(){o({url:e[n],width:-1,height:-1})},a.src=e[n];var s=a.style;s.visibility="hidden",s.position="fixed",s.bottom=s.left=0,document.body.appendChild(a)}for(var i=new Array(e.length),r=0,o=0;o<e.length;o++)n(o)}function n(n,i){var r=[];return e.each(n,function(e){var t=/\.(gif|jpe?g|png)$/i.test(e.name);t&&(e.meta.thumb_url&&!e.meta.thumb_width&&r.push(e.meta.thumb_url),e.meta.width||r.push(e.meta.url)),e.meta.thumb_url=e.meta.thumb_url||e.meta.url}),r.length?(t(r,function(e){for(var t=0;t<e.length;t++)for(var r=0;r<n.length;r++)e[t].url==n[r].meta.url&&(n[r].meta.width=e[t].width,n[r].meta.height=e[t].height),e[t].url==n[r].meta.thumb_url&&(n[r].meta.thumb_width=e[t].width,n[r].meta.thumb_height=e[t].height);i(n)}),void 0):(i(n),void 0)}return{populateImageSizes:n}}),i(Gt,[],function(){function e(){}function t(e){document.getElementsByTagName("head")[0].appendChild(e)}var n=0,i={},r={maxLoadTime:5,load:function(e,t,n){function i(){s.length?r.loadScript(s.shift(),i,n):o()}function o(){a.length?r.loadCss(a.shift(),o,n):t()}var a=e.css||[],s=e.js||[];i()},loadScript:function(n,r,o){function a(){i[n]=!0,r()}var s,l;if(i[n])return r(),void 0;if(r=r||e,o=o||e,l=document.createElement("script"),l.type="text/javascript","object"==typeof n)for(s in n)l.setAttribute(s,n[s]);else l.src=n;"onload"in l?(l.onload=a,l.onerror=o):(l.onreadystatechange=function(){var e=l.readyState;("complete"==e||"loaded"==e)&&a()},l.onerror=o),t(l)},loadCss:function(o,a,s){function l(){i[o]=!0,a()}function u(){var e=navigator.userAgent.match(/WebKit\/(\d*)/);return!!(e&&e[1]<536)}function c(){for(var e=f.styleSheets,t,n=e.length,i;n--;)if(t=e[n],i=t.ownerNode?t.ownerNode:t.owningElement,i&&i.id===p.id)return l(),void 0;(new Date).getTime()-m<1e3*r.maxLoadTime?window.setTimeout(c,0):s()}function d(){try{var e=h.sheet.cssRules;return l(),e}catch(t){}(new Date).getTime()-m<1e3*r.maxLoadTime?window.setTimeout(d,0):s()}var f=document,p,h,m;if(i[o])return a(),void 0;if(a=a||e,s=s||e,p=f.createElement("link"),p.rel="stylesheet",p.type="text/css",p.href=o,p.id="u"+n++,m=(new Date).getTime(),"onload"in p&&!u())p.onload=l,p.onerror=s;else{if(navigator.userAgent.indexOf("Firefox")>0)return h=f.createElement("style"),h.textContent='@import "'+o+'"',d(),t(h),void 0;c()}t(p)}};return r}),i($t,[],function(){function e(e){return"undefined"!=typeof e}function n(e){return"string"==typeof e}function i(e){var t,n,i;for(i=h.createElement("div"),t=h.createDocumentFragment(),i.innerHTML=e;n=i.firstChild;)t.appendChild(n);
return t}function r(e,t,n){var o;if("string"==typeof t)t=i(t);else if(t.length){for(o=0;o<t.length;o++)r(e,t[o],n);return e}for(o=e.length;o--;)n.call(e[o],t.parentNode?t:t);return e}function o(e,t){return e&&t&&-1!==(" "+e.className+" ").indexOf(" "+t+" ")}function a(e,t){var n;for(e=e||[],"string"==typeof e&&(e=e.split(" ")),t=t||{},n=e.length;n--;)t[e[n]]={};return t}function s(e,t){return new s.fn.init(e,t)}function l(e){var t=arguments,n,i,r;for(i=1;i<t.length;i++){n=t[i];for(r in n)e[r]=n[r]}return e}function u(e){var t=[],n,i;for(n=0,i=e.length;i>n;n++)t[n]=e[n];return t}function c(e,t){var n;if(e.indexOf)return e.indexOf(t);for(n=e.length;n--;)if(e[n]===t)return n;return-1}function d(e,t){var n,i,r,o,a;if(e)if(n=e.length,n===o){for(i in e)if(e.hasOwnProperty(i)&&(a=e[i],t.call(a,i,a)===!1))break}else for(r=0;n>r&&(a=e[r],t.call(a,i,a)!==!1);r++);return e}function f(e,n,i){for(var r=[],o=e[n];o&&9!==o.nodeType&&(i===t||1!==o.nodeType||!s(o).is(i));)1===o.nodeType&&r.push(o),o=o[n];return r}function p(e,t,n,i){for(var r=[];e;e=e[n])i&&e.nodeType!==i||e===t||r.push(e);return r}var h=document,m=Array.prototype.push,g=Array.prototype.slice,v=/^(?:[^#<]*(<[\w\W]+>)[^>]*$|#([\w\-]*)$)/,y=a("fillOpacity fontWeight lineHeight opacity orphans widows zIndex zoom"),x=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)},b=/^\s*|\s*$/g,w=function(e){return e.replace(b,"")};return s.fn=s.prototype={constructor:s,selector:"",length:0,init:function(e,t){var r=this,o,a;if(!e)return r;if(e.nodeType)return r.context=r[0]=e,r.length=1,r;if(n(e)){if(o="<"===e.charAt(0)&&">"===e.charAt(e.length-1)&&e.length>=3?[null,e,null]:v.exec(e),o[1])for(a=i(e).firstChild;a;)this.add(a),a=a.nextSibling;else{if(a=h.getElementById(o[2]),a.id!==o[2])return r.find(e);r.length=1,r[0]=a}r.context=t||h,r.selector=e}else this.add(e);return r},toArray:function(){return u(this)},add:function(e){var t=this;return x(e)?m.apply(t,e):e instanceof s?t.add(e.toArray()):m.call(t,e),t},attr:function(n,i){var r=this;if("object"==typeof n)d(n,function(e,t){r.attr(t,e)});else{if(!e(i))return r[0]&&1===r[0].nodeType?r[0].getAttribute(n):t;this.each(function(){1===this.nodeType&&this.setAttribute(n,i)})}return r},css:function(n,i){var r=this;if("object"==typeof n)d(n,function(e,t){r.css(t,e)});else{if(n=n.replace(/-(\D)/g,function(e,t){return t.toUpperCase()}),!e(i))return r[0]?r[0].style[n]:t;"number"!=typeof i||y[n]||(i+="px"),r.each(function(){var e=this.style;"opacity"===n&&this.runtimeStyle&&"undefined"==typeof this.runtimeStyle.opacity&&(e.filter=""===i?"":"alpha(opacity="+100*i+")");try{e[n]=i}catch(t){}})}return r},remove:function(){for(var e=this,t,n=this.length;n--;)t=e[n],t.parentNode&&t.parentNode.removeChild(t);return this},empty:function(){for(var e=this,t,n=this.length;n--;)for(t=e[n];t.firstChild;)t.removeChild(t.firstChild);return this},html:function(t){var n=this,i;if(e(t)){for(i=n.length;i--;)n[i].innerHTML=t;return n}return n[0]?n[0].innerHTML:""},text:function(t){var n=this,i;if(e(t)){for(i=n.length;i--;)n[i].innerText=n[0].textContent=t;return n}return n[0]?n[0].innerText||n[0].textContent:""},append:function(){return r(this,arguments,function(e){1===this.nodeType&&this.appendChild(e)})},prepend:function(){return r(this,arguments,function(e){1===this.nodeType&&this.insertBefore(e,this.firstChild)})},before:function(){var e=this;return e[0]&&e[0].parentNode?r(e,arguments,function(e){this.parentNode.insertBefore(e,this.nextSibling)}):e},after:function(){var e=this;return e[0]&&e[0].parentNode?r(e,arguments,function(e){this.parentNode.insertBefore(e,this)}):e},appendTo:function(e){return s(e).append(this),this},addClass:function(e){return this.toggleClass(e,!0)},removeClass:function(e){return this.toggleClass(e,!1)},toggleClass:function(e,t){var n=this;return-1!==e.indexOf(" ")?d(e.split(" "),function(){n.toggleClass(this,t)}):n.each(function(){var n=this,i;o(n,e)!==t&&(i=n.className,t?n.className+=i?" "+e:e:n.className=w((" "+i+" ").replace(" "+e+" "," ")))}),n},hasClass:function(e){return o(this[0],e)},each:function(e){return d(this,e)},show:function(){return this.css("display","")},hide:function(){return this.css("display","none")},slice:function(){return new s(g.apply(this,arguments))},eq:function(e){return-1===e?this.slice(e):this.slice(e,+e+1)},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},replaceWith:function(e){var t=this;return t[0]&&t[0].parentNode.replaceChild(s(e)[0],t[0]),t},wrap:function(e){return e=s(e)[0],this.each(function(){var t=this,n=e.cloneNode(!1);t.parentNode.insertBefore(n,t),n.appendChild(t)})},unwrap:function(){return this.each(function(){for(var e=this,t=e.firstChild,n;t;)n=t,t=t.nextSibling,e.parentNode.insertBefore(n,e)})},clone:function(){var e=[];return this.each(function(){e.push(this.cloneNode(!0))}),s(e)},push:m,sort:[].sort,splice:[].splice},l(s,{extend:l,toArray:u,inArray:c,isArray:x,each:d,trim:w,makeMap:a}),d({parent:function(e){var t=e.parentNode;return t&&11!==t.nodeType?t:null},parents:function(e){return f(e,"parentNode")},parentsUntil:function(e,t){return f(e,"parentNode",t)},next:function(e){return p(e,"nextSibling",1)},prev:function(e){return p(e,"previousSibling",1)},nextNodes:function(e){return p(e,"nextSibling")},prevNodes:function(e){return p(e,"previousSibling")},children:function(e){return p(e.firstChild,"nextSibling",1)},contents:function(e){return u(("iframe"===e.nodeName?e.contentDocument||e.contentWindow.document:e).childNodes)}},function(e,t){s.fn[e]=function(n){var i=this,r;if(i.length>1)throw new Error("MinQuery only supports traverse functions on a single node.");return i[0]&&(r=t(i[0],n)),r=s(r),n&&"parentsUntil"!==e?r.filter(n):r}}),s.fn.filter=function(){return this},s.fn.is=function(){return!0},s.fn.init.prototype=s.fn,s}),i(Jt,[],function(){function e(){return!1}function t(){return!0}var n="__bindings";return{fire:function(i,r,o){var a=this,s,l,u,c,d;if(i=i.toLowerCase(),r=r||{},r.type=i,r.target||(r.target=a),r.preventDefault||(r.preventDefault=function(){r.isDefaultPrevented=t},r.stopPropagation=function(){r.isPropagationStopped=t},r.stopImmediatePropagation=function(){r.isImmediatePropagationStopped=t},r.isDefaultPrevented=e,r.isPropagationStopped=e,r.isImmediatePropagationStopped=e),a[n]&&(s=a[n][i]))for(l=0,u=s.length;u>l&&(s[l]=c=s[l],!r.isImmediatePropagationStopped());l++)if(c.call(a,r)===!1)return r.preventDefault(),r;if(o!==!1&&a.parent)for(d=a.parent();d&&!r.isPropagationStopped();)d.fire(i,r,!1),d=d.parent();return r},on:function(e,t){var i=this,r,o,a,s;if(t===!1&&(t=function(){return!1}),t)for(a=e.toLowerCase().split(" "),s=a.length;s--;)e=a[s],r=i[n],r||(r=i[n]={}),o=r[e],o||(o=r[e]=[],i.addRemoveNativeEvent&&i.addRemoveNativeEvent(e,!0)),o.push(t);return i},off:function(e,t){var i=this,r,o=i[n],a,s,l,u;if(o)if(e)for(l=e.toLowerCase().split(" "),r=l.length;r--;){if(e=l[r],a=o[e],!e){for(s in o)i.addRemoveNativeEvent&&i.addRemoveNativeEvent(s,!1),delete o[s];return i}if(a){if(t)for(u=a.length;u--;)a[u]===t&&a.splice(u,1);else a.length=0;!a.length&&i.addRemoveNativeEvent&&(i.addRemoveNativeEvent(e,!1),delete o[e])}}else{if(i.unbindNative)for(e in o)i.unbindNative(e);i[n]=[]}return i}}}),i(Kt,[l],function(e){var t=e.each,n={"delete":46};return function(e){var i=this,r={};e.on("keyup keypress keydown",function(e){/INPUT|TEXTAREA/.test(e.target.nodeName)||t(r,function(t){var n=e.metaKey||e.ctrlKey;if(t.ctrl==n&&t.alt==e.altKey&&t.shift==e.shiftKey)return e.keyCode==t.keyCode||e.charCode&&e.charCode==t.charCode?(e.preventDefault(),"keydown"==e.type&&t.func(),!0):void 0})}),i.add=function(e,i){t(e.toLowerCase().split(" "),function(e){var o={func:i,alt:!1,ctrl:!1,shift:!1};t(e.split("+"),function(e){switch(e){case"alt":case"ctrl":case"shift":o[e]=!0;break;default:o.charCode=e.charCodeAt(0),o.keyCode=n[e]||e.toUpperCase().charCodeAt(0)}}),r[(o.ctrl?"ctrl":"")+","+(o.alt?"alt":"")+","+(o.shift?"shift":"")+","+o.keyCode]=o})}}}),i(Zt,[l],function(e){function n(e){return null===e||e===t?"":(""+e).replace(/^\s*|\s*$/g,"")}function i(e,t){var o=this,a,s;return e=n(e),t=o.settings=t||{},/^([\w\-]+):([^\/]{2})/i.test(e)||/^\s*#/.test(e)?(o.source=e,void 0):(0===e.indexOf("/")&&0!==e.indexOf("//")&&(e=(t.base_uri?t.base_uri.protocol||"http":"http")+"://mce_host"+e),/^[\w\-]*:?\/\//.test(e)||(s=t.base_uri?t.base_uri.path:new i(location.href).directory,e=(t.base_uri&&t.base_uri.protocol||"http")+"://mce_host"+o.toAbsPath(s,e)),e=e.replace(/@@/g,"(mce_at)"),e=/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@\/]*):?([^:@\/]*))?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/.exec(e),r(["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],function(t,n){var i=e[n];i&&(i=i.replace(/\(mce_at\)/g,"@@")),o[t]=i}),a=t.base_uri,a&&(o.protocol||(o.protocol=a.protocol),o.userInfo||(o.userInfo=a.userInfo),o.port||"mce_host"!==o.host||(o.port=a.port),o.host&&"mce_host"!==o.host||(o.host=a.host),o.source=""),void 0)}var r=e.each;return i.prototype={setPath:function(e){var t=this;e=/^(.*?)\/?(\w+)?$/.exec(e),t.path=e[0],t.directory=e[1],t.file=e[2],t.source="",t.getURI()},toRelative:function(e){var t=this,n;if("./"===e)return e;if(e=new i(e,{base_uri:t}),"mce_host"!=e.host&&t.host!=e.host&&e.host||t.port!=e.port||t.protocol!=e.protocol)return e.getURI();var r=t.getURI(),o=e.getURI();return r==o||"/"==r.charAt(r.length-1)&&r.substr(0,r.length-1)==o?r:(n=t.toRelPath(t.path,e.path),e.query&&(n+="?"+e.query),e.anchor&&(n+="#"+e.anchor),n)},toAbsolute:function(e,t){return e=new i(e,{base_uri:this}),e.getURI(this.host==e.host&&this.protocol==e.protocol?t:0)},toRelPath:function(e,t){var n,i=0,r="",o,a;if(e=e.substring(0,e.lastIndexOf("/")),e=e.split("/"),n=t.split("/"),e.length>=n.length)for(o=0,a=e.length;a>o;o++)if(o>=n.length||e[o]!=n[o]){i=o+1;break}if(e.length<n.length)for(o=0,a=n.length;a>o;o++)if(o>=e.length||e[o]!=n[o]){i=o+1;break}if(1===i)return t;for(o=0,a=e.length-(i-1);a>o;o++)r+="../";for(o=i-1,a=n.length;a>o;o++)r+=o!=i-1?"/"+n[o]:n[o];return r},toAbsPath:function(e,t){var n,i=0,o=[],a,s;for(a=/\/$/.test(t)?"/":"",e=e.split("/"),t=t.split("/"),r(e,function(e){e&&o.push(e)}),e=o,n=t.length-1,o=[];n>=0;n--)0!==t[n].length&&"."!==t[n]&&(".."!==t[n]?i>0?i--:o.push(t[n]):i++);return n=e.length-i,s=0>=n?o.reverse().join("/"):e.slice(0,n).join("/")+"/"+o.reverse().join("/"),0!==s.indexOf("/")&&(s="/"+s),a&&s.lastIndexOf("/")!==s.length-1&&(s+=a),s},getURI:function(e){var t,n=this;return(!n.source||e)&&(t="",e||(n.protocol&&(t+=n.protocol+"://"),n.userInfo&&(t+=n.userInfo+"@"),n.host&&(t+=n.host),n.port&&(t+=":"+n.port)),n.path&&(t+=n.path),n.query&&(t+="?"+n.query),n.anchor&&(t+="#"+n.anchor),n.source=t),n.source}},i.parseURI=function(t,n){return n=n||{},new i(t,e.extend({base_uri:new i(n.base_url||document.location.href.split("?")[0].replace(/\/[^\/]+$/,"")+"/")},n))},i}),i(Qt,[],function(){function e(e,n,i,r){return t(e).then(n,i,r)}function t(e){var t,n;return e instanceof i?t=e:s(e)?(n=a(),e.then(function(e){n.resolve(e)},function(e){n.reject(e)},function(e){n.progress(e)}),t=n.promise):t=r(e),t}function n(t){return e(t,o)}function i(e){this.then=e}function r(e){var n=new i(function(n){try{return t("function"==typeof n?n(e):e)}catch(i){return o(i)}});return n}function o(e){var n=new i(function(n,i){try{return t("function"==typeof i?i(e):o(e))}catch(r){return o(r)}});return n}function a(){function e(e,t,n){return f(e,t,n)}function n(e){return h(t(e))}function r(e){return h(o(e))}function s(e){return p(e)}var l,u,c,d,f,p,h;return u=new i(e),l={then:e,resolve:n,reject:r,progress:s,promise:u,resolver:{resolve:n,reject:r,progress:s}},c=[],d=[],f=function(e,t,n){var i,r;return i=a(),r="function"==typeof n?function(e){try{i.progress(n(e))}catch(t){i.progress(t)}}:function(e){i.progress(e)},c.push(function(n){n.then(e,t).then(i.resolve,i.reject,r)}),d.push(r),i.promise},p=function(e){return m(d,e),e},h=function(e){return f=e.then,h=t,p=y,m(c,e),d=c=w,e},l}function s(e){return e&&"function"==typeof e.then}function l(t,n,i,r,o){return g(2,arguments),e(t,function(t){function s(e){m(e)}function l(e){h(e)}var u,c,d,f,p,h,m,g,y,x;if(y=t.length>>>0,u=Math.max(0,Math.min(n,y)),d=[],c=y-u+1,f=[],p=a(),u)for(g=p.progress,m=function(e){f.push(e),--c||(h=m=v,p.reject(f))},h=function(e){d.push(e),--u||(h=m=v,p.resolve(d))},x=0;y>x;++x)x in t&&e(t[x],l,s,g);else p.resolve(d);return p.promise.then(i,r,o)})}function u(e,t,n,i){function r(e){return t?t(e[0]):e[0]}return l(e,1,r,n,i)}function c(e,t,n,i){return g(1,arguments),f(e,y).then(t,n,i)}function d(){return f(arguments,y)}function f(t,n){return e(t,function(t){var i,r,o,s,l,u;if(o=r=t.length>>>0,i=[],u=a(),o)for(s=function c(t,r){e(t,n).then(function(e){i[r]=e,--o||u.resolve(i)},u.reject)},l=0;r>l;l++)l in t?s(t[l],l):--o;else u.resolve(i);return u.promise})}function p(t,n){var i=b.call(arguments,1);return e(t,function(t){var r;return r=t.length,i[0]=function(t,i,o){return e(t,function(t){return e(i,function(e){return n(t,e,o,r)})})},x.apply(t,i)})}function h(t,n,i){var r=arguments.length>2;return e(t,function(e){return e=r?i:e,n.resolve(e),e},function(e){return n.reject(e),o(e)},n.progress)}function m(e,t){for(var n,i=0;n=e[i++];)n(t)}function g(e,t){for(var n,i=t.length;i>e;)if(n=t[--i],n&&"function"!=typeof n)throw new Error("arg "+i+" must be a function")}function v(){}function y(e){return e}var x,b,w;return e={},e.defer=a,e.resolve=t,e.reject=n,e.join=d,e.all=c,e.map=f,e.reduce=p,e.any=u,e.some=l,e.chain=h,e.isPromise=s,i.prototype={always:function(e,t){return this.then(e,e,t)},otherwise:function(e){return this.then(w,e)},yield:function(e){return this.then(function(){return e})},spread:function(e){return this.then(function(t){return c(t,function(t){return e.apply(w,t)})})}},b=[].slice,x=[].reduce||function(e){var t,n,i,r,o;if(o=0,t=Object(this),r=t.length>>>0,n=arguments,n.length<=1)for(;;){if(o in t){i=t[o++];break}if(++o>=r)throw new TypeError}else i=n[1];for(;r>o;++o)o in t&&(i=e(i,t[o],o,t));return i},e}),i(en,[l,$,J],function(e,t,n){function i(e){e&&this.add(e)}function r(e,t){return function(n){i.FileSystemManager.convertResult(n,function(n){t?e({from:t,to:n}):e({files:n})})}}var o=Array.prototype.push,a=Array.prototype.slice;return i.prototype={length:0,add:function(t){var n=this;return e.isArray(t)?o.apply(n,t):t instanceof i?n.add(t.toArray()):o.call(n,t),n},slice:function(){return new i(a.apply(this,arguments))},eq:function(e){return-1===e?this.slice(e):this.slice(e,+e+1)},each:function(t){return e.each(this,t),this},toArray:function(){return e.toArray(this)},indexOf:function(t){return e.inArray(t,this)},toPathArray:function(){var e=[];return this.each(function(t){var n=t.path;t.info&&t.info.link&&(n=t.info.link),e.push(n)}),e},moveTo:function(e,n,i){t.exec("moveTo",{from:this.toPathArray(),to:e},r.call(this,n,this),i)},copyTo:function(e,n,i){t.exec("copyTo",{from:this.toPathArray(),to:e},r.call(this,n,this),i)},remove:function(e,n){t.exec("delete",{paths:this.toPathArray()},r.call(this,e),n)},download:function(e){var i=this,r=[],o;e=e||"files.zip",i.each(function(e){o=n.dirname(e.path),r.push(e.name)}),document.location.href=t.url+"?action=download&path="+o+"&names="+r.join(",")+"&zipname="+e},zip:function(e,r,o){var a=this,s,l=[];a.each(function(e){s=n.dirname(e.path),l.push(e.name)}),t.exec("zip",{to:e,path:s,names:l},function(e){i.FileSystemManager.convertResult(e,function(e){r({to:e})})},o)},populateMetaData:function(e,i,r){var o=this;t.exec("FileInfo",{paths:o.toPathArray(),meta:!0,insert:e.insert},function(e){var t,r={};for(t=e.length;t--;)r[e[t].path]=e[t].meta;o.each(function(e){if(!e.meta){var t=e.path;e.info&&e.info.link&&(t=e.info.link,e.path=e.info.link,e.parentPath=n.dirname(e.path)),e.meta=r[t]}}),i(o)},function(e){r?r(o):t.errorHandler.call(t,e)})}},i}),i(tn,[J,en,$],function(e,t,n){function i(e,t){if(e){var n=new o(e.path,t);return n.size=e.size,n.lastModified=new Date(1e3*e.lastModified),n.isFile=e.isFile,n.isDirectory=!e.isFile,n.canRead=e.canRead,n.canWrite=e.canWrite,n.canRename=e.canRename,n.canEdit=e.canEdit,n.canView=e.canView,n.canPreview=e.canPreview,n.hasThumbnail=e.hasThumbnail,n.exists=e.exists,n.meta=e.meta,n.info=e.info,n}}function r(e,n){return function(i){t.FileSystemManager.convertResult(i,function(t){n?e({from:n,to:t}):e({files:t})})}}function o(i,a){var s=this;s.path=i,s.fileSystem=a,s.name=e.basename(i),this.parentPath=e.dirname(i),s.isFile=!1,s.isDirectory=!1,s.canRead=!1,s.canWrite=!1,s.canRename=!1,s.canEdit=!1,s.canPreview=!1,s.hasThumbnail=!1,s.exists=!1,s.size=0,s.lastModified=new Date,s.getParentFile=function(e,t){a.getFile(this.parentPath,e,t)},s.copyTo=function(t,o,a,l){var u=e.join(t,o);n.exec("copyTo",{from:i,to:u},r(a,s),l)},s.moveTo=function(t,o,a,l){var u=e.join(t,o);n.exec("moveTo",{from:i,to:u},r(a,s),l)},s.unzip=function(e,t,i){n.exec("unzip",{from:this.path,to:e},r(t,s),i)},s.remove=function(e,t){n.exec("delete",{paths:[i]},r(e),t)},s.download=function(){document.location.href=n.url+"?action=download&path="+i},s.listFiles=function(e,n,i){e.path=e.path||this.path,t.FileSystemManager.listFiles(e,n,i)},s.putFileContents=function(e,t,i){n.exec("putFileContents",{path:this.path,content:e},function(e){t(o.resultToFile(e))},i)},s.getFileContents=function(e,t){n.exec("getFileContents",{path:this.path},e,t)},s.getMetaData=function(e,t){var i=this;return i.meta?(e(i.meta),void 0):(n.exec("FileInfo",{path:i.path,meta:!0},function(t){i.meta=t.meta,e(t.meta)},t),void 0)},s.getConfig=function(e,t){var i=this;return i.config?(e(i.config),void 0):(n.exec("getConfig",{path:i.path},function(t){i.config=t,e(t)},t),void 0)}}return o.resultToFile=i,o}),i(nn,[J],function(e){function t(t,n,i,r){var o=this;o.rootName=e.basename(n),o.rootPath=n,o.meta=i,o.config=r,o.getRootFile=function(e,n){t.getFile(o.rootPath,e,n)},o.getFile=function(e,n,i){t.getFile(e,n,i)}}return t}),i(rn,[nn,tn,en,J,$],function(e,t,n,i,r){function o(e,t){var n,i;for(n=e.length;n--;)if(i=e[n],t===i.rootPath||0===t.indexOf(i.rootPath+"/"))return i}var a,s={},l={getFileSystems:function(t,n){return a?(t(a),void 0):(r.exec("listRoots",[],function(n){var i,r=[];for(i=0;i<n.length;i++)r.push(new e(l,n[i].path,n[i].meta,n[i].config));a=r,t(a)},n),void 0)},createDocument:function(e,t,n,i){r.exec("createDocument",{path:e,name:t.name,fields:t.fields,template:t.template},function(e){l.convertResult(e,n)},i)},createDirectory:function(e,t,n,i){r.exec("createDirectory",{path:e,template:t.template,overwrite:t.overwrite},function(e){l.convertResult(e,n)},i)},getFile:function(e,t,n){"string"==typeof e&&(e={path:e}),r.exec("FileInfo",e,function(e){l.convertResult(e,t)},n)},getFiles:function(e,t,i){var o,a,u=[];for(o=0;o<e.length;o++)a=s[e[o]],a&&(u.push(a),e.splice(o,1));e.length?r.exec("FileInfo",{paths:e},function(e){l.convertResult(e,function(e){t(new n([].concat(u,e.toArray())),l)})},i):t(new n(u))},listFiles:function(e,a,s){this.getFileSystems(function(l){function u(e){var t,n,i=e.columns,r=e.data,o,a=[];for(t=0;t<r.length;t++){for(o={},n=0;n<i.length;n++)o[i[n]]=r[t][n];a.push(o)}return a}r.exec("listFiles",e,function(r){var s,c,d,f,p=[],h,m,g;for(h=u(r),m=r.file?r.file.path:e.path,g=o(l,m),s=0;s<h.length;s++)c=h[s],c.info&&c.info.link&&(m=c.info.link),m=r.file?i.join(r.file.path,c.name):i.join(e.path,c.name),d=c.attrs.split(""),f=new t(m,g),f.size=c.size,f.lastModified=new Date(1e3*c.modified),f.isFile="d"!==d[0],f.isDirectory=!f.isFile,f.canRead="-"!=d[1],f.canWrite="-"!=d[2],f.canRename="-"!=d[3],f.canEdit="-"!=d[4],f.canView="-"!=d[5],f.canPreview="-"!=d[6],f.hasThumbnail="-"!=d[7],f.info=c.info,f.exists=!0,f.hasThumbnail&&r.url&&(f.thumbnailUrl=r.url+"/"+r.thumbnailFolder+"/"+r.thumbnailPrefix+f.name),p.push(f);a({url:r.url,file:t.resultToFile(r.file,g),urlFile:t.resultToFile(r.urlFile,g),config:r.config,files:new n(p),total:r.total})},s)})},convertResult:function(e,i){this.getFileSystems(function(r){var a,l,u;if(e instanceof Array){for(u=[],a=0;a<e.length;a++)l=t.resultToFile(e[a],o(r,e[a].path)),s[l.path]=l,u.push(l);i(new n(u))}else l=t.resultToFile(e,o(r,e.path)),s[l.path]=l,i(l)})}};return n.FileSystemManager=l,l}),i(on,[Ut,_,$,Xt],function(e,t,n,i){return e.extend({render:function(e){t.create({type:"window",title:"Login",items:[{type:"form",items:[{label:"Username",name:"username",type:"textbox",minWidth:250},{label:"Password",name:"password",type:"textbox",subtype:"password",minWidth:250},{label:" ",name:"persistent",type:"checkbox",checked:!0,text:"Keep me logged in"},{type:"label",name:"msg",text:i.translate("Wrong username/password"),hidden:!0}]}],onsubmit:function(t){var i=this,r=t.data;t.preventDefault(),n.exec("login",{username:r.username,password:r.password,persistent:r.persistent},function(t){t?(e.login=!0,e.onlogin&&e.onlogin(i)):i.find("#msg").eq(0).show(!0).parent().reflow()})},onclose:function(){e.oncancel&&!e.login&&e.oncancel()},buttons:[{text:"Login",subtype:"primary",onclick:"submit"},{text:"Cancel",onclick:"close"}]}).renderTo(document.body).reflow()}})}),i(an,[Ut,_,$,K,Tt],function(e,t,n,i,r){return e.extend({render:function(e){function o(){a.find("#basicauth_details")[0].visible("basic"==a.find("#authenticator").value()).parent().reflow(),a.find("#sessionauth_details")[0].visible("basic"!=a.find("#authenticator").value()).parent().reflow()}var a;return"api.ashx"==i.apiPageName?(r.alert("You need to follow the installation instructions on the www.moxiemanager.com website.",function(){document.location.href="http://www.moxiemanager.com/documentation/index.php/Installation_net"}),void 0):(a=t.create({type:"window",title:"Installation",items:[{type:"form",items:[{type:"label",text:"This will configure the basic settings needed for the MoxieManager."},{label:"License key",name:"license",type:"textbox",placeholder:"xxxx-xxxx-xxxx-xxxx-xxxx-xxxx-xxxx-xxxx",tooltip:"Paste you license key you got from the www.moxiemanager.com website",minWidth:250},{label:"Authenticator",name:"authenticator",onselect:o,type:"listbox",values:[{text:"Basic authenticator",value:"basic",selected:!0},{text:"Session authenticator",value:"session"}]},{type:"fieldset",name:"basicauth_details",title:"Basic authenticator",items:[{type:"label",maxWidth:400,multiline:!0,text:"Enter the username/password you want to use to login to the MoxieManager"},{label:"User name",name:"username",type:"textbox"},{label:"Password",name:"password",type:"textbox",subtype:"password"}]},{type:"fieldset",hidden:!0,name:"sessionauth_details",title:"Session authenticator",items:[{type:"label",maxWidth:400,multiline:!0,text:"Enter the session key to authorize the user by."},{label:"Session name",name:"logged_in_key",type:"textbox",value:"isLoggedIn",tooltip:"Session name to check"}]}]}],onsubmit:function(i){i.preventDefault(),n.exec("install",i.data,function(n){a.close(),n===!0?e.oninstall():t.create({type:"window",title:"Couldn't write config file",padding:10,spacing:5,direction:"column",items:[{type:"label",text:"You need to manually paste this into your config file located in the root of moxiemanager."},{type:"textbox",multiline:!0,value:n,minWidth:700,minHeight:500,spellcheck:!1,onpostrender:function(e){e.control.getEl().select()},onclick:function(e){e.target.select()}}],buttons:[{text:"Close",onclick:"close"}]}).renderTo(document.body).reflow()})},buttons:[{text:"Install",subtype:"primary",onclick:"submit"},{text:"Cancel",onclick:"close"}]}).renderTo(document.body).reflow(),void 0)}})}),i(sn,[Ut,l,rn,Tt,on,an,$],function(e,t,n,i,r,o,a){var s,l=e.extend({render:function(e){function u(){n.getFileSystems(function(n){var i=n[0].config;d.renderAsDialog(t.extend({initial_disabled_tools:i["general.disabled_tools"],initial_hidden_tools:i["general.hidden_tools"]},e))})}function c(){window.setTimeout(function(){a.exec("loopback",{},c,c)},6e5)}var d=this;a.errorHandler=a.errorHandler||function(e){if(l.hideThrobber&&l.hideThrobber(),11==e.code){var t=new o;return t.render({oninstall:function(){u()}}),void 0}if(10==e.code){if(e.data&&e.data.login_url)return document.location.href=e.data.login_url,void 0;var n=new r;return n.render({onlogin:function(e){e.close(),u()}}),void 0}i.alert({title:"Error",text:e.message+(e.data?"\n"+e.data:"")})},s||(c(),s=!0),u()}});return l}),i(ln,[sn,_,rn,J],function(e,t,n,i){return e.extend({renderAsDialog:function(e){t.create({type:"window",title:"Create new folder",items:[{type:"form",items:[{label:"Name",name:"name",type:"textbox",minWidth:300}]}],buttons:[{text:"Create",subtype:"primary",onclick:"submit"},{text:"Cancel",onclick:"close"}],onsubmit:function(t){e.onbeforecreate&&e.onbeforecreate(),n.createDirectory(i.join(e.path,t.data.name),{template:e.template},function(t){e.oncreate({file:t})})}}).renderTo(document.body).reflow()}})}),i(un,[sn,_,rn],function(e,t,n){return e.extend({renderAsDialog:function(e){function i(e,t){var n,i;if(e)for(e=e.split(/\s*,\s*/),n=0;n<e.length;n++)i=e[n].split(/\s*=\s*/),t(i[0],i[1]||i[0])}n.getFile(e.path,function(r){r.getConfig(function(r){var o=[];o.push({label:"Name",name:"name",type:"textbox",minWidth:300}),i(r["createdoc.fields"],function(e,t){o.push({label:e,name:"field_"+t,type:"textbox",minWidth:300})}),t.create({type:"window",title:"Create new document",items:[{type:"form",items:o}],buttons:[{text:"Create",subtype:"primary",onclick:"submit"},{text:"Cancel",onclick:"close"}],onsubmit:function(t){var i={},r,o=t.data;for(r in o)0===r.indexOf("field_")&&(i[r.substr(6)]=o[r]);e.onbeforecreate&&e.onbeforecreate(),n.createDocument(e.path,{template:e.template,name:t.data.name,fields:i},function(t){e.oncreate({file:t})})}}).renderTo(document.body).reflow()})})}})}),i(cn,[sn,_,l,rn,J,Tt,Zt],function(e,t,n,i,r,o,a){function s(e,t){var n=t.meta.url;return e.no_host=e.no_host||e.remove_script_host,e.relative_urls?n=a.parseURI(e.document_base_url||e.default_base_url).toRelative(n):(e.document_base_url||e.no_host)&&(n=a.parseURI(e.document_base_url).toAbsolute(a.parseURI(n).getURI(!0),e.no_host)),t.url=t.meta.url=n,t}return e.extend({renderAsDialog:function(e){/^(jpe?g|gif|png)$/i.test(r.extname(e.path).substr(1))?this.renderEditImageDialog(e):this.renderEditTextDialog(e)},renderEditTextDialog:function(e){i.getFile(e.path,function(n){n.getFileContents(function(i){t.create({type:"window",title:"Edit",padding:10,items:{type:"textbox",name:"content",multiline:!0,spellcheck:!1,minWidth:500,minHeight:400,value:i.content},onsubmit:function(t){e.onbeforesave&&e.onbeforesave(),n.putFileContents(t.data.content,function(){e.onsave&&e.onsave({file:s(e,n),content:t.data.content})})},onclose:function(){e.onclose&&e.onclose()},buttons:[{text:"Save",subtype:"primary",onclick:"submit"},{text:"Cancel",onclick:"close"}]}).renderTo(document.body).reflow()})})},renderEditImageDialog:function(e){function a(e){b.find("imagecanvas")[0].zoom(e.value)}function l(t){return function(){if(w.cancel(),b.find("form:visible slider").each(function(e){e.reset()}),"crop"==t&&w.crop(),"redeye"==t&&w.redeye(20),("grayscale"==t||"invert"==t||"sharpen"==t||"emboss"==t)&&w.filter(t).apply(),"fliprotate"==t&&w.startTransation(),"resize"==t&&(E=w.size().w,C=w.size().h,b.find("#rw").value(w.size().w),b.find("#rh").value(w.size().h)),x=t,b.find("panel form").hide(),b.find("#"+t)[0].show().parent().reflow(),"save"==t){y=r.extname(e.path);var n=r.basename(e.path,y);b.find("#saveas").value(n),b.find("#saveas")[0].focus()}}}function u(){w.saveAs(b.find("#saveas").value()+y,function(t){i.convertResult(t,function(t){b.close(),s(e,t),e.onsave&&e.onsave({file:t})})},function(e){o.alert({title:"Error",text:e.message+"\n"+(e.data?e.data:"")})})}function c(e){var t=e.control;b.find("#undo,#revert,#savebtn").disabled(!t.canUndo()),b.find("#redo").disabled(!t.canRedo())}function d(){var e=b.find("treeview")[0];e.find("*").each(function(e){e.selected(!1)}),"resize"==x&&w.resize(b.find("#rw").value(),b.find("#rh").value()),w.apply(),l("main")(),_=null}function f(){var e=b.find("treeview")[0];e.find("*").each(function(e){e.selected(!1)}),this.parent().find("slider").exec("reset"),l("main")(),_=null}function p(e){return function(){var t=this;t.on("dragstart",function(){_=w.filter(e)}),t.on("drag",function(e){_.live(e.value)}),t.on("dragend",function(e){_.apply(e.value)})}}function h(){var e=this.find("slider");e.each(function(t){t.on("dragstart",function(){_=_||w.filter("colorize")}),t.on("drag",function(){_.live(e[0].value(),e[1].value(),e[2].value())}),t.on("dragend",function(){_.apply(e[0].value(),e[1].value(),e[2].value())})})}function m(e){var t,n,i,r;t=b.find("#rw")[0],n=b.find("#rh")[0],i=t.value(),r=n.value(),b.find("#constrain")[0].checked()&&E&&C&&i&&r&&(e.control==t?(r=Math.round(i/E*r),n.value(r)):(i=Math.round(r/C*i),t.value(i))),E=i,C=r}function g(){w.crop(parseInt(b.find("#x")[0].value(),10),parseInt(b.find("#y")[0].value(),10),parseInt(b.find("#w")[0].value(),10),parseInt(b.find("#h")[0].value(),10))}function v(){var e=this.parent().find("treeview")[0].items();this.hasCanvasSupport()?this.hasWebGlSupport()||e.eq(-1)[0].find("#triangleblur,#hue,#sharpen,#emboss").hide():(e.eq(-1).hide(),this.parent().find("#undo,#redo").hide(),this.parent().reflow(!0),this.parent().find("#undo")[0].parent()._layout.applyClasses(this.parent().find("#undo")[0].parent()))}var y,x,b,w,_,E,C,R=[{name:"main",hidden:!1,items:[{type:"buttongroup",items:[{text:"Save",name:"savebtn",icon:"save",onclick:l("save")},{text:"Revert",name:"revert",onclick:function(){w.revert()},disabled:!0},{text:"Undo",name:"undo",icon:"undo",onclick:function(){w.undo()},disabled:!0},{text:"Redo",name:"redo",icon:"redo",onclick:function(){w.redo()},disabled:!0}]},{type:"spacer",flex:1},{text:"Zoom fit",type:"button",onclick:function(){a({value:"fit"})}},{type:"slider",name:"zoom",label:"Zoom",ondrag:a,value:1,minValue:0,maxValue:7,previewFilter:function(e){return Math.round(100*e)+"%"}}]},{name:"save",hidden:!0,onsubmit:u,items:[{name:"saveas",label:"Save as",type:"textbox",minWidth:350},{type:"button",text:"Save",subtype:"primary",onclick:u},{type:"button",text:"Cancel",onclick:f}]},{name:"redeye",hidden:!0,items:[{label:"Radius",type:"slider",onDrag:function(e){w.redeye(e.value)}},{type:"button",text:"Apply",subtype:"primary",onclick:d},{type:"button",text:"Reset",onclick:f}]},{name:"crop",hidden:!0,items:[{label:"X",name:"x",type:"textbox",size:4,value:"0",onchange:g},{label:"Y",name:"y",type:"textbox",size:4,value:"0",onchange:g},{label:"W",name:"w",type:"textbox",size:4,value:"0",onchange:g},{label:"H",name:"h",type:"textbox",size:4,value:"0",onchange:g},{type:"button",text:"Apply",subtype:"primary",onclick:"submit"},{type:"button",text:"Reset",onclick:f}],onsubmit:d},{name:"resize",hidden:!0,items:[{label:"W",name:"rw",type:"textbox",size:4,onchange:m},{label:"H",name:"rh",type:"textbox",size:4,onchange:m},{name:"constrain",checked:!0,text:"Constrain proportions",type:"checkbox"},{type:"button",text:"Apply",subtype:"primary",onclick:"submit"},{type:"button",text:"Reset",onclick:f}],onsubmit:d},{name:"fliprotate",hidden:!0,items:[{type:"button",icon:"flip-h",text:"Flip H",onclick:function(){w.flip("h")}},{type:"button",icon:"flip-v",text:"Flip V",onclick:function(){w.flip("v")}},{type:"button",icon:"rotate-left",text:"Rotate left",onclick:function(){w.rotate(-90)}},{type:"button",icon:"rotate-right",text:"Rotate right",onclick:function(){w.rotate(90)}},{type:"button",text:"Apply",subtype:"primary",onclick:d},{type:"button",text:"Reset",onclick:f}]}],T=[{name:"brightness",title:"Brightness",min:-1,max:1,value:0},{name:"contrast",title:"Contrast",min:-1,max:1,value:0},{name:"exposure",title:"Exposure",min:0,max:2,value:2},{name:"gamma",title:"Gamma",min:0,max:2,value:1},{name:"hue",title:"Hue",min:-1,max:1,value:0},{name:"saturate",title:"Saturate",min:-1,max:1,value:0},{name:"sepia",title:"Sepia",min:0,max:1,value:0},{name:"vibrance",title:"Vibrance",min:-1,max:1,value:0},{name:"triangleblur",title:"TriangleBlur",min:0,max:200,value:0},{name:"colorize",title:"Colorize",min:0,max:2,value:1},{name:"grayscale",title:"Grayscale"},{name:"invert",title:"Invert"},{name:"sharpen",title:"Sharpen"},{name:"emboss",title:"Emboss"}];
n.each(T,function(e){"colorize"==e.name?R.push({name:"colorize",hidden:!0,defaults:{minValue:e.min,maxValue:e.max,value:e.value},onPostRender:h,items:[{type:"slider",label:"Red",name:"r"},{type:"slider",label:"Green",name:"g"},{type:"slider",label:"Blue",name:"b"},{type:"button",text:"Apply",subtype:"primary",onclick:d},{type:"button",text:"Reset",onclick:f}]}):"undefined"==typeof e.value?R.push({name:e.name,hidden:!0,items:[{text:e.title,type:"label",strong:!0},{type:"button",text:"Apply",subtype:"primary",onclick:d},{type:"button",text:"Reset",onclick:f}]}):R.push({name:e.name,items:[{type:"slider",label:e.title,minValue:e.min,maxValue:e.max,value:e.value,onPostRender:p(e.name)},{type:"button",text:"Apply",subtype:"primary",onclick:d},{type:"button",text:"Reset",onclick:f}]})});var A=[];n.each(T,function(e){A.push({name:e.name,text:e.title,onclick:l(e.name)})}),b=t.create("window",{layout:"border",minWidth:800,minHeight:600,title:"Edit image",items:[{region:"north",type:"panel",layout:"flex",padding:4,border:"0 0 1 0",defaults:{type:"form",direction:"row",spacing:4,labelGap:3,padding:3,align:"center",hidden:!0},items:R},{region:"west",type:"panel",width:200,border:"0 1 0 0",items:[{type:"treeview",autoScroll:!0,items:[{text:"Alter",fixed:!0,items:[{text:"Resize",onclick:l("resize")},{text:"Crop",onclick:l("crop")},{text:"Flip/Rotate",onclick:l("fliprotate")}]},{text:"Filters",fixed:!0,items:A}]}]},{region:"center",type:"imagecanvas",onchange:c,onPostRender:v,layout:"fit"}],onsubmit:function(e){e.preventDefault()},onclose:function(){e.onclose&&e.onclose()}}).renderTo(document.body).reflow(),b.find("imagecanvas")[0].loadFromPath(e.path,function(e){this.zoom("fit"),this.hasCanvasSupport()&&this._imageEditor.loadFromImage(e)}),w=b.find("imagecanvas")[0],w.on("cropchange",function(e){b.find("#x").value(e.rect.x),b.find("#y").value(e.rect.y),b.find("#w").value(e.rect.w),b.find("#h").value(e.rect.h)}),window.viewport=b}})}),i(dn,[Gt,K,Xt],function(e,t,n){function i(i){return function(r){function o(){moxman.Env.baseUrl=t.baseUrl,moxman.Env.apiPageUrl=t.baseUrl+"/"+t.apiPageName,moxman.util.JsonRpc.url=moxman.Env.apiPageUrl,moxman.ui.Control.translate=n.translate,moxman.ui.FloatPanel.zIndex=r.zIndex||moxman.ui.FloatPanel.zIndex;var e=new moxman.Manager(r);e.init(new moxman.views[i](e))}if(r=r||{},!t.baseUrl)for(var a=document.getElementsByTagName("script"),s=0;s<a.length;s++){var l=a[s].src;if(/(^|\/)moxman\./.test(l)){t.baseUrl=l.substring(0,l.lastIndexOf("/"))+"/..",t.apiPageUrl=t.baseUrl+"/"+t.apiPageName;break}}moxman.ui?o():e.load({js:[t.baseUrl+"/js/moxman.api.min.js",t.apiPageUrl+"?action=language"+(r.language?"&code="+r.language:""),t.apiPageUrl+"?action=PluginJs"],css:[t.baseUrl+"/skins/"+(r.skin||"lightgray")+"/skin"+(t.ie7?".ie7":"")+".min.css"]},o)}}var r=this||window,o={browse:i("FileListView"),upload:i("UploadView"),edit:i("EditView"),zip:i("ZipView"),createDir:i("CreateDirView"),createDoc:i("CreateDocView"),view:i("ViewFileView"),rename:i("RenameView")};r.moxman=r.moxman||{};for(var a in o)r.moxman[a]=o[a];return r.moxman.addI18n=n.add,o}),i(fn,[sn,dn,_,qt,J,rn,en,$,l,Tt,Lt,Kt,Rt,Zt,Yt,g],function(e,t,n,i,r,o,a,s,l,u,c,d,f,p,h,m){function g(e){b=e}function v(){return b}function y(e,t){var n=t.meta.url;return e.no_host=e.no_host||e.remove_script_host,e.relative_urls?n=p.parseURI(e.document_base_url||e.default_base_url).toRelative(n):(e.document_base_url||e.no_host)&&(n=p.parseURI(e.document_base_url).toAbsolute(p.parseURI(n).getURI(),e.no_host)),t.url=t.meta.url=n,t}function x(e,t){return t&&!/^https?:\/\//.test(t)&&0!==t.indexOf("//")&&(t=p.parseURI(e.document_base_url).toAbsolute(p.parseURI(t).getURI(!0))),0===t.indexOf("//")&&(t=document.location.protocol+t),t}var b;return e.extend({init:function(e){this.manager=e},renderAsDialog:function(f){function p(e){bt=new c(E().getEl("body"),!0).show(),-1===yt||yt>vt+xt?(vt+=xt,j(function(){e()})):(e(),bt.hide(),bt=null)}function b(e){gt||(gt=new c(ct.getEl()).show(e||500))}function w(){gt&&(gt.hide(),gt=null)}function _(){return C()[0]}function E(){return ct.find("grid:visible,thumbnailview:visible")[0]}function C(){function e(e){var t;return ft.each(function(n){return n.name==e?(t=n,!1):void 0}),t}for(var t=new a,n=ct.find("grid:visible,thumbnailview:visible")[0],i=n.selected(),r=0;r<i.length;r++)t.add(e(i[r].name));return t}function R(e,t,n){var i=E();0===vt&&ct.find("#manage").hide(),bt&&w(),o.listFiles(l.extend({url:f.url,path:e,filter:ct.find("#filter").value(),include_directory_pattern:f.include_directory_pattern,exclude_directory_pattern:f.exclude_directory_pattern,include_file_pattern:f.include_file_pattern,exclude_file_pattern:f.exclude_file_pattern,extensions:f.extensions,orderBy:i._sortBy,desc:!i._sortOrder,offset:vt,length:xt},n),function(e){bt&&(bt.hide(),bt=null),f.url=null,dt=e.file,mt.currentDir=dt,g(dt.path),ht=e.config,yt=e.total,0===vt?(ft=e.files,i.data(X(e.files))):(ft.add(e.files),i.append(X(e.files)));var n=ct.find("#filesystems")[0];n.items().each(function(e){e.selected(e.settings.data.fileSystem===dt.fileSystem)}),K(),t&&(t({files:e.files}),e.urlFile&&O(e.urlFile))})}function T(){t.edit({path:C()[0].path,onbeforesave:b,onsave:function(){j(w)}})}function A(){t.rename({from:C()[0].path,onbeforerename:b,onrename:function(e){R(dt.path,function(){O(e.to),w()})}})}function S(){t.upload({path:dt.path,onupload:function(e){R(dt.path,function(){P(e.files),w()})}})}function D(){C().download()}function k(){t.zip({from:C().toPathArray(),to:dt.path,onbeforecreate:b,oncreate:function(e){R(dt.path,function(){O(e.to),w()})}})}function I(){C()[0].unzip(dt.path,function(e){R(dt.path,function(){P(e.to)})})}function N(){var e=C();e.length>0&&u.confirm("Are you sure you want to delete the selected files?",function(t){t&&(b(),e.remove(function(){j(function(){w()})}))})}function M(){t.view({file:_(),files:C()})}function F(){var e=C();e.length>0&&(pt={path:dt.path,action:"cut",files:e},ct.find("#paste").show().parent().reflow())}function H(){var e=C();e.length>0&&(pt={path:dt.path,action:"copy",files:e},ct.find("#paste").show().parent().reflow())}function P(e){var t=ct.find("grid:visible,thumbnailview:visible")[0];e.each(function(e){var n,i=t.data();for(n=i.length;n--;)if(i[n].name===e.name)return t.select(n),void 0})}function O(e){var t=ct.find("grid:visible,thumbnailview:visible")[0],n,i=t.data();for(n=i.length;n--;)if(i[n].name===e.name)return t.select(n),void 0}function L(e){var t=ct.find("grid:visible,thumbnailview:visible")[0],n,i=t.data();for(n=i.length;n--;)if(i[n].path===e)return t.select(n),void 0}function z(){pt&&(dt.path!=pt.path?(b(),"cut"==pt.action?pt.files.moveTo(dt.path,function(e){R(dt.path,function(){P(e.to),w()})}):pt.files.copyTo(dt.path,function(e){R(dt.path,function(){P(e.to),w()})})):P(pt.files),pt=null,ct.find("#paste").hide().parent().reflow())}function W(){b(),C().populateMetaData({insert:!0},function(e){h.populateImageSizes(e,function(e){var t=_();w(),ct.close(),e.each(function(e){y(f,e)}),y(f,t),f.fields&&l.each(f.fields.split(/[, ]/),function(e){var n;if(n=document.getElementById(e))if(n.value=t.url,"fireEvent"in n)n.fireEvent("onchange");else{var i=document.createEvent("HTMLEvents");i.initEvent("change",!1,!0),n.dispatchEvent(i)}}),f.oninsert&&f.oninsert({focusedFile:t,files:e})})})}function B(e){t.createDir({path:dt.path,template:e,onbeforecreate:b,oncreate:function(e){R(dt.path,function(){O(e.file),w()})}})}function U(e){t.createDoc({path:dt.path,template:e,onbeforecreate:b,oncreate:function(e){R(dt.path,function(){O(e.file),w()})}})}function j(e,t){var n;t&&(n={force:!0}),b(),R(dt.path,function(){w(),e&&e()},n)}function q(e){var t=e.isFile?e.parentPath:e.path;R(t,function(){O(e)})}function V(){b(),o.getFileSystems(function(e){function t(e,t){b(),vt=0,yt=-1,"thumbs"==f.view&&G(),R(e,function(){w()},{lastPath:t||!f.remember_last_path?null:v()})}function n(e){return/^\/(History|Favorites|Uploaded)$/.test(e.rootPath)?e.rootName:f.rootpath&&0===f.rootpath.indexOf(e.rootPath)?{raw:r.basename(f.rootpath)}:{raw:e.rootName}}function i(e){return f.rootpath&&0===f.rootpath.indexOf(e.rootPath)?f.rootpath:e.rootPath}function o(){t(i(this.settings.data.fileSystem))}var a,s,l=ct.find("#filesystems")[0];for(a=0;a<e.length;a++){var u,c;f.path&&0===f.path.indexOf(e[a].rootPath)&&(t(f.path,!0),s=!0),c=e[a].meta["ui.icon_16x16"]||"folder",u=e[a].meta["ui.icon_16x16_url"],l.append({text:n(e[a]),data:{fileSystem:e[a]},icon:c,iconUrl:u,onclick:o}),e[a].meta.standalone===!1&&ct.find("#logout").hide()}s||t(i(e[0]))},s.errorHandler)}function X(e){var t=[];return e.each(function(e){t.push({name:e.name,size:e.isFile?e.size:-1,isFile:e.isFile,lastModified:e.lastModified,canPreview:e.canPreview,info:e.info,path:e.path,extension:e.isFile?r.extname(e.name).toLowerCase().substr(1):"dir",thumbnailUrl:e.thumbnailUrl})}),t}function Y(){var e=ct.find("#toggleviews")[0];xt=200,vt=0,yt=-1,ct.find("thumbnailview").hide(),ct.find("grid")[0].show().clear().parent().reflow(),e.items()[0].active(!0),e.items()[1].active(!1),ct.reflow()}function G(){var e=ct.find("#toggleviews")[0],t=ct.find("grid")[0],n=ct.find("thumbnailview")[0];xt=400,vt=0,yt=-1,n._sortBy=t._sortBy,n._sortOrder=t._sortOrder,t.hide(),n.show().clear().parent().reflow(),e.items()[0].active(!1),e.items()[1].active(!0),ct.reflow()}function $(e){vt=0,yt=-1,R(e.value.path)}function J(e){var t=[],n,i,o=e.data;if(dt){for(n=dt.path;n&&(!f.rootpath||n!==r.dirname(f.rootpath));)t.push({name:r.basename(n),path:n}),n=r.dirname(n);ct.find("path").data(t.reverse());var a=[],s=[];for(i=0;i<o.length;i++)o[i].isFile?a.push(o[i]):s.push(o[i]);if(e.data=o=s.concat(a),dt.parentPath){if(f.rootpath&&f.rootpath===dt.path)return;for(i=o.length;i--;)if(o[i].isParent){o.splice(i,1);break}0===vt&&o.unshift({name:"..",size:-1,isFile:!1,isParent:!0,lastModified:new Date})}}}function K(){var e=ct.find("#manage");C().length>0?(f.multiple===!1&&C().length>1?ct.statusbar.find("#insert").disabled(!0):ct.statusbar.find("#insert").disabled(!1),e.show()):(e.hide(),ct.statusbar.find("#insert").disabled(!0)),ct.find("#create,#upload").visible(dt.canWrite),rt(ht["general.hidden_tools"],ht["general.disabled_tools"]),e.parent().reflow()}function Z(e){var t;if(1==e.cellIndex&&e.inValue&&(t=e.value,!e.row.isFile)){b();var n=dt.path;if(e.preventDefault(),e.row.info&&e.row.info.link)return R(e.row.info.link,function(){w()}),void 0;n=e.row.isParent?r.dirname(n):r.join(n,t),vt=0,yt=-1,R(n,function(){w()})}}function Q(e){e.icon=e.row.isParent?"parent":e.row.isFile?"file":"folder",-1!=e.row.name.indexOf(".txt")&&(e.icon="file-text"),-1!=e.row.name.indexOf(".doc")&&(e.icon="file-word"),-1!=e.row.name.indexOf(".pdf")&&(e.icon="file-pdf"),-1!=e.row.name.indexOf(".xls")&&(e.icon="file-excel"),-1!=e.row.name.indexOf(".html")&&(e.icon="file-xml"),-1!=e.row.name.indexOf(".zip")&&(e.icon="file-zip"),/\.(jpe?g|png|gif)$/i.test(e.row.name)&&(e.icon="file-image"),e.row.canPreview&&(e.row.thumbnail=!0)}function et(e){e.row.isParent&&(e.icon="")}function tt(e){return-1==e?"":e>1048576?Math.round(e/1048576,1)+" MB":e>1024?Math.round(e/1024,1)+" KB":e+" b"}function nt(e){var t,n=e.control.menu;n.append({text:"Folder",icon:"folder",onclick:function(){B()}}),(t=ht["createdir.templates"])&&l.each(t.split(","),function(e){e=e.split("="),n.append({text:r.basename(e[0]),icon:"folder",onclick:function(){B(e[1]||e[0])}})}),(t=ht["createdoc.templates"])&&(n.append({text:"-"}),l.each(t.split(","),function(e){e=e.split("="),n.append({text:r.basename(e[0]),icon:"file",onclick:function(){U(e[1]||e[0])}})}))}function it(e){"menu"==e.control.type&&(e.control.parent().menu=null,e.control.remove())}function rt(e,t){var n=l.makeMap(f.hidden_tools||"",","),i=l.makeMap(f.disabled_tools||"",",");l.each("upload create manage filter".split(" "),function(e){n[e]&&ct.find("#"+e).hide(),i[e]||ct.find("#"+e).disabled(!1)}),e&&l.each(e.split(","),function(e){ct.find("#"+e).visible()&&ct.find("#"+e).hide()}),t&&l.each(t.split(","),function(e){ct.find("#"+e).disabled(!0)})}function ot(e){var t=e.control.menu||this,n=mt.fire("BeforeRenderManageMenu",{menu:t});if(!n.isDefaultPrevented()){var i=[{name:"clipboard",menu:[{text:"Cut",icon:"cut",shortcut:"Ctrl+X",onclick:F},{text:"Copy",icon:"copy",shortcut:"Ctrl+C",onclick:H},{text:"Paste",name:"paste",icon:"paste",shortcut:"Ctrl+V",onclick:z,disabled:!0}]},{name:"tools",menu:[{text:"View",name:"view",icon:"view",onclick:M},{text:"Edit",name:"edit",icon:"edit",onclick:T},{text:"Rename",name:"rename",onclick:A},{text:"Download",name:"download",icon:"download",onclick:D}]},{name:"zip",menu:[{text:"Zip",name:"zip",icon:"zip",onclick:k},{text:"Unzip",name:"unzip",onclick:I}]},{name:"remove",menu:[{text:"Remove",name:"delete",icon:"delete",shortcut:"Delete",onclick:N}]}];l.each(i,function(e,n){n>0&&n<=i.length-1&&t.append({text:"-"}),l.each(e.menu,function(e){t.append(e)});var r=mt.menuItems;r&&l.each(r,function(n){l.each(n.contexts,function(i){i=="manage."+e.name&&t.append(n)})})}),rt(ht["general.hidden_tools"],ht["general.disabled_tools"]),t.find("#paste").disabled(!pt),t.find("#unzip").disabled(".zip"!=r.extname(_().name).toLowerCase()),t.find("#edit").disabled(!_().canEdit),t.find("#rename").disabled(!_().canRename),t.find("#view").disabled(!_().canView)}}function at(){var e=[];e.push({text:"Local machine",icon:"upload",onclick:S});var t=mt.menuItems;return t&&l.each(t,function(t){l.each(t.contexts,function(n){"upload"==n&&(1===e.length&&e.push({text:"-"}),e.push(t))})}),1===e.length?{type:"button",name:"upload",text:"Upload",icon:"upload",onclick:S}:{type:"menubutton",name:"upload",text:"Upload",icon:"upload",menu:e}}function st(){s.exec("logout",{},function(){ct.close()})}function lt(e){if(e.row.isFile){if(f.insert===!1)return;e.control.unselect(),L(e.row.path),W()}else Z(e)}var ut,ct,dt,ft,pt,ht={},mt=this.manager,gt,vt=0,yt=-1,xt=200,bt;ct=n.create("window",{title:f.title||"MoxieManager",minWidth:f.width||800,minHeight:f.height||500,defaults:{type:"panel",layout:"fit"},layout:"border",onclose:function(){f.onclose&&f.onclose()},items:[{region:"north",layout:"flex",border:"0 0 1 0",spacing:4,padding:4,items:[{type:"menubutton",name:"create",text:"Create",icon:"create",onCreateMenu:nt,onhide:it},at(),{type:"button",icon:"paste",name:"paste",text:"Paste",hidden:!0,onclick:z},{type:"menubutton",name:"manage",text:"Manage",icon:"manage",hidden:!0,onCreateMenu:ot,onhide:it},{type:"spacer",flex:1},{type:"button",name:"refresh",icon:"refresh",tooltip:"Refresh file list",onclick:function(){b(),vt=0,yt=-1,j(function(){w()},!0)}},{type:"buttongroup",name:"toggleviews",items:[{type:"button",icon:"list",active:!0,tooltip:"List",onclick:function(){vt=0,yt=-1,Y(),j()}},{type:"button",icon:"thumbs",tooltip:"Thumbnails",onclick:function(){vt=0,yt=-1,G(),j()}}]},{type:"menubutton",text:"Sort",menu:[{text:"Name",data:"name",selectable:!0},{text:"Size",data:"size",selectable:!0},{text:"Type",data:"extension",selectable:!0},{text:"Modification date",data:"lastModified",selectable:!0}],onclick:function(e){var t=E()._sortBy,n=e.control.settings.data;n&&n!=t&&(this.menu.items().active(!1),e.control.active(!0),E()._sortBy=n,E()._sortOrder=!0,ct.find("grid")[0]._sortBy=n,ct.find("grid")[0]._sortOrder=!0,ct.find("grid")[0].updateColumns(),vt=0,yt=-1,j())},onshow:function(){var e=E()._sortBy;this.menu.items().each(function(t){t.active(t.settings.data==e)})}},{type:"combobox",name:"filter",icon:"search",flex:1,maxWidth:200,placeholder:"Filter",onaction:function(){vt=0,yt=-1,j()}},{type:"button",name:"logout",icon:"logout",tooltip:"Logout",onclick:st}]},{region:"west",width:190,border:"0 1 0 0",hidden:f.leftpanel===!1,items:[{type:"treeview",autoScroll:!0,items:[{text:"FileSystems",name:"filesystems",fixed:!0,items:[]}]}]},{region:"center",layout:"flex",direction:"column",align:"stretch",items:[{type:"panel",flex:1,align:"stretch",border:"0 0 0 0",layout:"flex",direction:"column",autoResize:!1,items:[{type:"path",name:"path",delimiter:"/",onSelect:$},{type:"grid",border:"1 0 0 0",flex:1,sortBy:f.sort_by||"name",sortDir:f.sort_order||"asc",autoSort:!1,columns:[{name:"hidden",type:"checkbox",width:25,sorting:!1,icon:"checkbox",filter:et},{name:"name",title:"Filename",filter:Q},{name:"size",title:"Size",width:60,filter:function(e){e.value=tt(e.value)}},{name:"extension",title:"Type",width:70},{name:"lastModified",title:"Modification date",width:200,filter:function(e){e.value=i.format(e.value,"%D %H:%M:%S")}}],onSort:function(){vt=0,yt=-1,j()},onPostRender:function(){var e=this.getEl("body"),t,n=400;m.on(e,"scroll",function(){!t&&-1!=yt&&e.scrollTop+e.clientHeight+n>=e.scrollHeight&&(t=!0,p(function(){t=!1}))},!1)},onBeforeUpdate:J,onSelect:K,onCellClick:Z},{type:"thumbnailview",border:"1 0 0 0",flex:1,hidden:!0,sortBy:f.sort_by||"name",sortDir:f.sort_order||"asc",nameField:"name",srcField:"src",minWidth:10,minHeight:10,filter:Q,onBeforeUpdate:J,onSelect:K,onThumbClick:lt,autoSort:!1,onPostRender:function(){var e=this.getEl(),t,n=400;m.on(e,"scroll",function(){!t&&-1!=yt&&e.scrollTop+e.clientHeight+n>=e.scrollHeight&&(t=!0,p(function(){t=!1}))},!1)}}]}]}],onsubmit:function(e){e.preventDefault(),vt=0,yt=-1,j()},buttons:f.insert===!1?[]:[{text:"Insert",name:"insert",subtype:"primary",onclick:W,disabled:!0,autofocus:!0},{text:"Close",onclick:"close"}]}),rt(f.hidden_tools,f.disabled_tools),rt(f.initial_hidden_tools,f.initial_disabled_tools),ct.renderTo(document.body).reflow().fullscreen(f.fullscreen===!0),f.filter&&ct.find("#filter").value(f.filter);var wt=new d(ct);wt.add("ctrl+x",F),wt.add("ctrl+c",H),wt.add("ctrl+v",z),wt.add("delete",N),!f.url&&f.fields?(f.multiple=!1,l.each(f.fields.split(/[, ]/),function(e){var t;(t=document.getElementById(e))&&(f.url=x(f,t.value))})):f.url&&(f.url=x(f,f.url)),V(),mt.getSelectedFiles=ct.getSelectedFiles=C,mt.open=q,mt.refresh=j,mt.showThrobber=b,mt.hideThrobber=w,mt.selectByPath=L,e.hideThrobber=w,ct.on("contextmenu",function(e){function t(e,t,n){for(;e&&e!=t;){if(n(e))return e;e=e.parentNode}}function i(e){if(e)for(var t=e.parentNode.childNodes,n=t.length;n--;)if(t[n]===e)return n;return-1}var r=l.makeMap(f.hidden_tools||"",","),o=l.makeMap(f.disabled_tools||"",",");if(r.manage||o.manage)return e.preventDefault(),void 0;var a,s=e.control.type;if("grid"!=s&&"thumbnailview"!=s)return ut&&(ut.remove(),ut=null),void 0;if(e.preventDefault(),"grid"==s){if(a=i(t(e.target,e.control.getEl(),function(e){return"TR"==e.nodeName&&-1!=e.className.indexOf("grid-row")})),-1===a||e.control.data()[a].isParent)return ut&&ut.hide(),void 0;e.control.isSelected(a)||(e.control.unselect(),e.control.select(a))}else{if(a=i(t(e.target,e.control.getEl(),function(e){return-1!=e.className.indexOf("moxman-image")})),-1===a||e.control.data()[a].isParent)return ut&&ut.hide(),void 0;e.control.isSelected(a)||(e.control.unselect(),e.control.select(a))}if(ut)ut.show();else{var u=[];ut=new n.create({type:"menu",items:u,context:"contextmenu",onPostRender:ot,contrainToViewport:!0}),ut.renderTo(document.body)}ut.moveTo(e.pageX,e.pageY),ut.on("hide",function(){ut&&(ut.remove(),ut=null)})})}})}),i(pn,[sn,_,rn,J],function(e,t,n,i){return e.extend({renderAsDialog:function(e){n.getFile(e.from,function(n){var r="",o;n&&n.isFile?(r=i.extname(n.name),o=i.basename(n.name,r)):o=n.name,t.create({type:"window",title:"Rename file",items:[{type:"form",items:[{label:"Filename",name:"newname",type:"textbox",minWidth:300,value:o}]}],onsubmit:function(t){e.onbeforerename&&e.onbeforerename(),n.moveTo(n.parentPath,t.data.newname+r,function(t){e.onrename&&e.onrename({from:n,to:t.to})})},buttons:[{text:"Rename",subtype:"primary",onclick:"submit"},{text:"Cancel",onclick:"close"}]}).renderTo(document.body).reflow()})}})}),i(hn,[Z,ft,rt,Q,et,dt,ht,ot,at],function(e,t,n,i,r,o,a,s,l){function u(r){var u=this,d,f,p;if(-1!==e.inArray(e.typeOf(r),["string","node"])&&(r={browse_button:r}),f=n.get(r.browse_button),!f)throw new i.DOMException(i.DOMException.NOT_FOUND_ERR);p={accept:[{title:o.translate("All Files"),extensions:"*"}],name:"file",multiple:!1,required_caps:!1,container:f.parentNode||document.body},r=e.extend({},p,r),"string"==typeof r.required_caps&&(r.required_caps=s.parseCaps(r.required_caps)),"string"==typeof r.accept&&(r.accept=t.mimes2extList(r.accept)),d=n.get(r.container),d||(d=document.body),"static"===n.getStyle(d,"position")&&(d.style.position="relative"),d=f=null,l.call(u),e.extend(u,{uid:e.guid("uid_"),ruid:null,files:null,init:function(){u.convertEventPropsToHandlers(c),u.bind("RuntimeInit",function(t,i){u.ruid=i.uid,u.bind("Ready",function(){u.trigger("Refresh")},999),u.bind("Change",function(){var t=i.exec.call(u,"FileInput","getFiles");u.files=[],e.each(t,function(e){u.files.push(new a(u.ruid,e))})},999),u.bind("Refresh",function(){var t,o,a,s;a=n.get(r.browse_button),s=n.get(i.shimid),a&&(t=n.getPos(a,n.get(r.container)),o=n.getSize(a),s&&e.extend(s.style,{top:t.y+"px",left:t.x+"px",width:o.w+"px",height:o.h+"px"})),s=a=null}),i.exec.call(u,"FileInput","init",r)}),u.connectRuntime(e.extend({},r,{required_caps:{select_file:!0}}))},disable:function(t){var n=this.getRuntime();n&&n.exec.call(this,"FileInput","disable","undefined"===e.typeOf(t)?!0:t)},refresh:function(){u.trigger("Refresh")},destroy:function(){var t=this.getRuntime();t&&(t.exec.call(this,"FileInput","destroy"),this.disconnectRuntime()),"array"===e.typeOf(this.files)&&e.each(this.files,function(e){e.destroy()}),this.files=null}})}var c=["ready","change","cancel","mouseenter","mouseleave","mousedown","mouseup"];return u.prototype=r.instance,u}),i(mn,[dt,rt,Q,Z,ht,at,et,ft],function(e,t,n,i,r,o,a,s){function l(n){var a=this,l;"string"==typeof n&&(n={drop_zone:n}),l={accept:[{title:e.translate("All Files"),extensions:"*"}],required_caps:{drag_and_drop:!0}},n="object"==typeof n?i.extend({},l,n):l,n.container=t.get(n.drop_zone)||document.body,"static"===t.getStyle(n.container,"position")&&(n.container.style.position="relative"),"string"==typeof n.accept&&(n.accept=s.mimes2extList(n.accept)),o.call(a),i.extend(a,{uid:i.guid("uid_"),ruid:null,files:null,init:function(){a.convertEventPropsToHandlers(u),a.bind("RuntimeInit",function(e,t){a.ruid=t.uid,a.bind("Drop",function(){var e=t.exec.call(a,"FileDrop","getFiles");a.files=[],i.each(e,function(e){a.files.push(new r(a.ruid,e))})},999),t.exec.call(a,"FileDrop","init",n),a.dispatchEvent("ready")}),a.connectRuntime(n)},destroy:function(){var e=this.getRuntime();e&&(e.exec.call(this,"FileDrop","destroy"),this.disconnectRuntime()),this.files=null}})}var u=["ready","dragenter","dragleave","drop","error"];return l.prototype=a.instance,l}),i(gn,[sn,K,_,Tt,Y,rn,J,hn,mn,pt,ct,it,ft,et,ot,Zt],function(e,t,n,i,r,o,a,s,l,u,c,d,f,p,h,m){function g(e,t){var n=t.meta.url;return e.no_host=e.no_host||e.remove_script_host,e.relative_urls?n=m.parseURI(e.document_base_url||e.default_base_url).toRelative(n):(e.document_base_url||e.no_host)&&(n=m.parseURI(e.document_base_url).toAbsolute(m.parseURI(n).getURI(!0),e.no_host)),t.url=t.meta.url=n,t}function v(e){var t;return"string"==typeof e&&(e=/^([0-9]+)([mgk]?)$/.exec(e.toLowerCase().replace(/[^0-9mkg]/g,"")),t=e[2],e=+e[1],"g"==t&&(e*=1073741824),"m"==t&&(e*=1048576),"k"==t&&(e*=1024)),e}function y(e){return-1==e?"":e>1048576?Math.round(e/1048576,1)+" MB":e>1024?Math.round(e/1024,1)+" KB":e+" b"}return f.addMimeType("application/epub+zip,epub"),e.extend({renderAsDialog:function(e){var f=h.getConstructor("html5"),m=(new f).can("drag_and_drop");d.swf_url=t.baseUrl+"/js/Moxie.swf",d.global_event_dispatcher="moxman.dispatchEvent",window.moxman.dispatchEvent=p.instance.dispatchEvent,o.getFile(e.path,function(d){d.getConfig(function(d){function f(e){for(var t=a.extname(e).substr(1).toLowerCase(),n=0;n<x.length;n++)if("*"==x[n]||x[n]==t)return!0;return!1}function p(e){var t,n=A.find("#dragmsg"),i=A.find("#files")[0],r=0,o;for(n.hide(),i.show(),t=0;t<e.length;t++)o="",f(e[t].name)||(o="Invalid extension"),i.append({type:"container",layout:"flex",spacing:10,align:"stretch",style:"border: 1px solid #CCC",border:"0 0 1 0",padding:"7 15 7 15",items:[{type:"label",flex:1,maxWidth:350,minHeight:25,text:{raw:e[t].name}},{type:"spacer",flex:1},o?{type:"label",style:"color: #AA0000; text-decoration: underline",text:"Error",tooltip:o,maxWidth:150}:{type:"progress",minWidth:150}]}),o?h.push({error:o,size:0}):h.push(e[t]);for(i.reflow(),t=0;t<h.length;t++)r+=h[t].size;A.find("#filecount")[0].text(["Files: {0}",h.length+" ("+y(r)+")"]).parent().reflow()}var h=[],x=[],b,w,_,E,C;b=d["upload.extensions"].toLowerCase().split(/\s*,\s*/),w=d["filesystem.extensions"].toLowerCase().split(/\s*,\s*/),E=v(d["upload.chunk_size"]),"*"==b[0]&&(b=w),"*"==w[0]&&(w=b),_=d["upload.maxsize"].replace(/\s+/,""),_=_.replace(/([0-9]+)/g,"$1 ");for(var R=0;R<b.length;R++){b[R]=b[R].toLowerCase();for(var T=0;T<w.length;T++)if(w[T]=w[T],b[R]==w[T]){x.push(b[R]);break}}var A=n.create({type:"window",title:"Upload",minWidth:600,maxHeight:400,layout:"flex",direction:"column",align:"stretch",padding:10,spacing:10,items:[{type:"label",text:["Valid extensions: {0}",x.join(", ")],maxWidth:600},{type:"label",text:["Max size: {0}",_]},m?{type:"label",name:"dragmsg",text:"Drag files here",style:"text-align: center; border-style: dashed",minHeight:200,maxHeight:200,border:1}:{type:"label",name:"dragmsg",text:"Select files to upload",style:"text-align: center",minHeight:200,maxHeight:200,border:1},{type:"panel",name:"files",layout:"flex",direction:"column",align:"stretch",autoScroll:!0,style:"border: 1px solid #CCC",minHeight:200,maxHeight:200,border:1,hidden:!0},{type:"container",layout:"flex",align:"stretch",items:[{type:"label",name:"filecount",text:" ",flex:1},{type:"button",name:"addfiles",text:"Add files",icon:"upload"}]}],onsubmit:function(n){function a(){return(new Date).getTime()}function s(n,o,d,h){var g=n.slice(h,h+E),w=new c;w.append("file",g),C=new u,C.open("POST",t.apiPageUrl+"?action=upload&path="+encodeURIComponent(e.path)+"&name="+encodeURIComponent(n.name)+"&loaded="+h+"&total="+n.size+"&id="+o),C.upload.onprogress=function(e){var t=e.loaded-(e.total-g.size);b=Math.ceil(h+t/((a()-x)/1e3)),d.items().filter("progress").value(Math.round(100*((h+t)/n.size))),A.find("#filecount").text("Uploading file: "+(f+1)+"/"+v+" at "+y(b)+"/s")},C.onload=function(){var e;C.upload.onprogress({loaded:g.size,total:g.size});try{e=r.parse(C.responseText)}catch(t){return i.alert("Error response is not proper JSON\n\nResponse:\n"+C.responseText),void 0}e.error&&(d.append({type:"label",style:"color: #AA0000; text-decoration: underline",text:"Error",tooltip:e.error.message,maxWidth:150}),d.items().filter("progress")[0].remove(),d.reflow(),p++),d.scrollIntoView(),!e.error&&h+E<n.size?s(n,e.result,d,h+E):(e.result&&m.push(e.result),l())},C.send(w)}function l(){var t=h.shift();return f++,t&&t.error?(l(),void 0):(t?s(t,null,d.items()[f],0):(A.find("#filecount").text(["Uploaded {0} files(s) at {1}/s",v,y(b)]),p&&i.alert("Some of the files failed to upload. Check the upload status of each file."),e.onupload&&o.convertResult(m,function(t){t.each(function(t){g(e,t)}),e.onupload({files:t})})),void 0)}var d=A.find("#files")[0],f=-1,p=0,m=[],v=h.length,x,b;x=a(),n.preventDefault(),S.disable(!0),A.find("#addfiles").disabled(!0),A.statusbar.find("#upload").hide(),l()},onclose:function(){e.onclose&&e.onclose()},buttons:[{text:"Upload",name:"upload",subtype:"primary",onclick:"submit"},{text:"Close",onclick:function(){C&&C.abort(),A.close()}}]}).renderTo(document.body).reflow(),S=new s({browse_button:A.find("#addfiles")[0]._id,accept:[{title:"Image files",extensions:x.join(",")}],multiple:!0});if(S.onchange=function(e){p(e.target.files)},S.init(),m){var D=new l(A._id);D.ondrop=function(){p(this.files)},D.init()}})})}})}),i(vn,[sn,_,rn,K,J],function(e,t,n,i,r){function o(e){return/^(jpe?g|gif|png)$/i.test(r.extname(e).substr(1))}return e.extend({renderAsDialog:function(e){if(e.path){if(!o(e.path))return this.renderIframeDialog(e),void 0}else if(e.file&&!o(e.file.path))return this.renderIframeDialog(e),void 0;this.renderGalleryDialog(e)},renderIframeDialog:function(e){function r(e){t.create({type:"window",title:"View",minWidth:800,minHeight:600,url:i.apiPageUrl+"?action=streamfile&path="+encodeURIComponent(e.path)+"&u="+e.size,onclose:function(){this.getEl().getElementsByTagName("iframe")[0].src="about:blank"}}).renderTo(document.body).reflow()}e.path?n.getFile(e.path,function(e){r(e)}):e.file&&r(e.file)},renderGalleryDialog:function(e){function r(e,n){var r,a=[],s=[],l=0,u;for(n=n.toArray(),r=0;r<n.length;r++)o(n[r].name)||(n.splice(r,1),r--);if(n.length>1){for(r=0;r<n.length;r++)e&&e.path==n[r].path&&(l=r),a.push({url:i.apiPageUrl+"?action=streamfile&path="+encodeURIComponent(n[r].path)+"&u="+n[r].size}),s.push({type:"image",text:n[r].name,url:i.apiPageUrl+"?action=streamfile&path="+encodeURIComponent(n[r].path)+"&thumb=true&u="+n[r].size});u={region:"south",height:120,layout:"flex",pack:"center",align:"center",autoScroll:!0,padding:10,spacing:10,onclick:function(e){this.parent().items().eq(0)[0].index(this.items().indexOf(e.control))},items:s}}else l=0,a.push({url:i.apiPageUrl+"?action=streamfile&path="+encodeURIComponent(e.path)+"&u="+e.size});t.create({type:"window",title:"View",defaults:{type:"panel",layout:"fit"},layout:"border",minWidth:800,minHeight:600,items:[{region:"center",type:"carousel",data:a,selectedIndex:l,onchange:function(e){var t=this;n.length>1&&window.setTimeout(function(){var n=t.parent().items().eq(-1)[0].items();n.eq(e.index)[0].active(!0).scrollIntoView("center"),n.eq(e.lastIndex).active(!1)},0)}},u]}).renderTo(document.body).reflow()}var a=e.path,s=e.paths;s?a||(a=s[0]):s=[],a?(s&&s.unshift(a),n.getFiles(s,function(e){r(e[0],e.slice(1))})):e.file&&r(e.file,e.files)}})}),i(yn,[sn,_,rn,en,J],function(e,t,n,i,r){return e.extend({renderAsDialog:function(e){t.create({type:"window",title:"Create zip file",items:[{type:"form",items:[{label:"Filename",name:"name",type:"textbox",minWidth:300}]}],onsubmit:function(t){e.onbeforecreate&&e.onbeforecreate(),n.getFiles(e.from,function(n){n.zip(r.join(e.to,t.data.name),function(t){e.oncreate({from:n,to:t.to})})})},buttons:[{text:"Create",subtype:"primary",onclick:"submit"},{text:"Cancel",onclick:"close"}]}).renderTo(document.body).reflow()}})}),i(xn,[],function(){function e(e){for(var n=t,i=e.split(/[.\/]/),r=0;r<i.length;++r){if(!n[i[r]])return;n=n[i[r]]}return n}var t=this||window,n={plugins:{},require:function(t,n){for(var i=0;i<t.length;i++)if(t[i]=e(t[i]),!t[i])throw"module definition dependecy not found: "+t[i];n.apply(null,t)},add:function(e,t){this.plugins[e]=t}};return t.moxman=t.moxman||{},t.moxman.require=n.require,n}),i(bn,[Jt,xn,l],function(e,t,n){return function(i){var r=[];n.extend(this,e),this.init=function(e){var n=t.plugins;for(var r in n)n[r](this);this.view=e.render(i)},this.addMenuItem=function(e){r.push(e)},this.menuItems=r}}),i(wn,[Z,Q,ot,it],function(e,t,n,i){function r(t){var r=this,s=n.capTest,l=n.capTrue,u=e.extend({access_binary:s(window.FileReader||window.File&&window.File.getAsDataURL),access_image_binary:function(){return r.can("access_binary")&&!!a.Image},display_media:s(i.can("create_canvas")||i.can("use_data_uri_over32kb")),do_cors:s(window.XMLHttpRequest&&"withCredentials"in new XMLHttpRequest),drag_and_drop:s(function(){var e=document.createElement("div");return("draggable"in e||"ondragstart"in e&&"ondrop"in e)&&("IE"!==i.browser||i.version>9)}()),return_response_headers:l,return_response_type:function(e){return"json"===e?!0:i.can("return_response_type",e)},report_upload_progress:s(window.XMLHttpRequest&&(new XMLHttpRequest).upload),resize_image:function(){return r.can("access_binary")&&i.can("create_canvas")},select_file:function(){return i.can("use_fileinput")&&window.File},select_folder:function(){return r.can("select_file")&&"Chrome"===i.browser&&i.version>=21},select_multiple:function(){return r.can("select_file")&&!("Safari"===i.browser&&"Windows"===i.OS)},send_binary_string:s(window.XMLHttpRequest&&((new XMLHttpRequest).sendAsBinary||window.Uint8Array&&window.ArrayBuffer)),send_custom_headers:s(window.XMLHttpRequest),send_multipart:function(){return!!(window.XMLHttpRequest&&(new XMLHttpRequest).upload&&window.FormData)||r.can("send_binary_string")
},slice_blob:s(window.File&&(File.prototype.mozSlice||File.prototype.webkitSlice||File.prototype.slice)),stream_upload:function(){return r.can("slice_blob")&&r.can("send_multipart")},summon_file_dialog:s(function(){return"Firefox"===i.browser&&i.version>=4||"Opera"===i.browser&&i.version>=12||"IE"===i.browser&&i.version>=10||!!~e.inArray(i.browser,["Chrome","Safari"])}()),upload_filesize:l},arguments[2]);n.call(this,t,arguments[1]||o,u),e.extend(this,{init:function(){this.trigger("Init")},destroy:function(e){return function(){e.call(r),e=r=null}}(this.destroy)}),e.extend(this.getShim(),a)}var o="html5",a={};return n.addConstructor(o,r),a}),i(_n,[wn,lt],function(e,t){function n(){function e(e,t,n){var i;if(!window.File.prototype.slice)return(i=window.File.prototype.webkitSlice||window.File.prototype.mozSlice)?i.call(e,t,n):null;try{return e.slice(),e.slice(t,n)}catch(r){return e.slice(t,n-t)}}this.slice=function(){return new t(this.getRuntime().uid,e.apply(this,arguments))}}return e.Blob=n}),i(En,[Z],function(e){function t(){this.returnValue=!1}function n(){this.cancelBubble=!0}var i={},r="moxie_"+e.guid(),o=function(o,a,s,l){var u,c;a=a.toLowerCase(),o.addEventListener?(u=s,o.addEventListener(a,u,!1)):o.attachEvent&&(u=function(){var e=window.event;e.target||(e.target=e.srcElement),e.preventDefault=t,e.stopPropagation=n,s(e)},o.attachEvent("on"+a,u)),o[r]||(o[r]=e.guid()),i.hasOwnProperty(o[r])||(i[o[r]]={}),c=i[o[r]],c.hasOwnProperty(a)||(c[a]=[]),c[a].push({func:u,orig:s,key:l})},a=function(t,n,o){var a,s;if(n=n.toLowerCase(),t[r]&&i[t[r]]&&i[t[r]][n]){a=i[t[r]][n];for(var l=a.length-1;l>=0&&(a[l].orig!==o&&a[l].key!==o||(t.removeEventListener?t.removeEventListener(n,a[l].func,!1):t.detachEvent&&t.detachEvent("on"+n,a[l].func),a[l].orig=null,a[l].func=null,a.splice(l,1),o===s));l--);if(a.length||delete i[t[r]][n],e.isEmptyObj(i[t[r]])){delete i[t[r]];try{delete t[r]}catch(u){t[r]=s}}}},s=function(t,n){t&&t[r]&&e.each(i[t[r]],function(e,i){a(t,i,n)})};return{addEvent:o,removeEvent:a,removeAllEvents:s}}),i(Cn,[wn,Z,rt,En,ft],function(e,t,n,i,r){function o(){function e(e){var n=u.accept.mimes||r.extList2mimes(u.accept),i=e.type||r.getFileMime(e.name)||"";return n.length&&-1===t.inArray(i,n)?!1:!0}function o(e,n){var i=[];t.each(e,function(e){i.push(function(t){a(e,t)})}),t.inSeries(i,function(){n()})}function a(t,n){t.isFile?t.file(function(t){e(t)&&l.push(t),n()},function(){n()}):t.isDirectory?s(t,n):n()}function s(e,t){function n(e){r.readEntries(function(t){t.length?([].push.apply(i,t),n(e)):e()},e)}var i=[],r=e.createReader();n(function(){o(i,t)})}var l=[],u;t.extend(this,{init:function(n){var r=this,a;u=n,a=u.container,i.addEvent(a,"dragover",function(e){e.preventDefault(),e.stopPropagation(),e.dataTransfer.dropEffect="copy"},r.uid),i.addEvent(a,"drop",function(n){if(n.preventDefault(),n.stopPropagation(),l=[],n.dataTransfer.items&&n.dataTransfer.items[0].webkitGetAsEntry){var i=[];t.each(n.dataTransfer.items,function(e){i.push(e.webkitGetAsEntry())}),o(i,function(){r.trigger("drop")})}else t.each(n.dataTransfer.files,function(t){e(t)&&l.push(t)}),r.trigger("drop")},r.uid),i.addEvent(a,"dragenter",function(e){e.preventDefault(),e.stopPropagation(),r.trigger("dragenter")},r.uid),i.addEvent(a,"dragleave",function(e){e.preventDefault(),e.stopPropagation(),r.trigger("dragleave")},r.uid)},getFiles:function(){return l},destroy:function(){i.removeAllEvents(u&&n.get(u.container),this.uid),l=u=null}})}return e.FileDrop=o}),i(Rn,[wn,Z,rt,En,ft,it],function(e,t,n,i,r,o){function a(){var e=[],a;t.extend(this,{init:function(s){var l=this,u=l.getRuntime(),c,d,f,p,h,m;a=s,e=[],f=(a.accept.mimes||r.extList2mimes(a.accept)).join(","),d=u.getShimContainer(),d.innerHTML='<input id="'+u.uid+'" type="file" style="font-size:999px;opacity:0;"'+(a.multiple&&u.can("select_multiple")?"multiple":"")+(a.directory&&u.can("select_folder")?"webkitdirectory directory":"")+(f?' accept="'+f+'"':"")+" />",c=n.get(u.uid),t.extend(c.style,{position:"absolute",top:0,left:0,width:"100%",height:"100%"}),p=n.get(a.browse_button),u.can("summon_file_dialog")&&("static"===n.getStyle(p,"position")&&(p.style.position="relative"),h=parseInt(n.getStyle(p,"z-index"),10)||1,p.style.zIndex=h,d.style.zIndex=h-1,i.addEvent(p,"click",function(e){var t=n.get(u.uid);t&&!t.disabled&&t.click(),e.preventDefault()},l.uid)),m=u.can("summon_file_dialog")?p:d,i.addEvent(m,"mouseover",function(){l.trigger("mouseenter")},l.uid),i.addEvent(m,"mouseout",function(){l.trigger("mouseleave")},l.uid),i.addEvent(m,"mousedown",function(){l.trigger("mousedown")},l.uid),i.addEvent(n.get(a.container),"mouseup",function(){l.trigger("mouseup")},l.uid),c.onchange=function g(){if(e=[],a.directory?t.each(this.files,function(t){"."!==t.name&&e.push(t)}):e=[].slice.call(this.files),"IE"!==o.browser)this.value="";else{var n=this.cloneNode(!0);this.parentNode.replaceChild(n,this),n.onchange=g}l.trigger("change")},l.trigger({type:"ready",async:!0}),d=null},getFiles:function(){return e},disable:function(e){var t=this.getRuntime(),i;(i=n.get(t.uid))&&(i.disabled=!!e)},destroy:function(){var t=this.getRuntime(),r=t.getShimContainer();i.removeAllEvents(r,this.uid),i.removeAllEvents(a&&n.get(a.container),this.uid),i.removeAllEvents(a&&n.get(a.browse_button),this.uid),r&&(r.innerHTML=""),e=a=null}})}return e.FileInput=a}),i(Tn,[],function(){return!!window.JSON&&JSON.parse||function(){var e,n,i={'"':'"',"\\":"\\","/":"/",b:"\b",f:"\f",n:"\n",r:"\r",t:"	"},r,o=function(t){throw{name:"SyntaxError",message:t,at:e,text:r}},a=function(t){return t&&t!==n&&o("Expected '"+t+"' instead of '"+n+"'"),n=r.charAt(e),e+=1,n},s=function(){var e,t="";for("-"===n&&(t="-",a("-"));n>="0"&&"9">=n;)t+=n,a();if("."===n)for(t+=".";a()&&n>="0"&&"9">=n;)t+=n;if("e"===n||"E"===n)for(t+=n,a(),("-"===n||"+"===n)&&(t+=n,a());n>="0"&&"9">=n;)t+=n,a();return e=+t,isFinite(e)?e:(o("Bad number"),void 0)},l=function(){var e,t,r="",s;if('"'===n)for(;a();){if('"'===n)return a(),r;if("\\"===n)if(a(),"u"===n){for(s=0,t=0;4>t&&(e=parseInt(a(),16),isFinite(e));t+=1)s=16*s+e;r+=String.fromCharCode(s)}else{if("string"!=typeof i[n])break;r+=i[n]}else r+=n}o("Bad string")},u=function(){for(;n&&" ">=n;)a()},c=function(){switch(n){case"t":return a("t"),a("r"),a("u"),a("e"),!0;case"f":return a("f"),a("a"),a("l"),a("s"),a("e"),!1;case"n":return a("n"),a("u"),a("l"),a("l"),null}o("Unexpected '"+n+"'")},d,f=function(){var e=[];if("["===n){if(a("["),u(),"]"===n)return a("]"),e;for(;n;){if(e.push(d()),u(),"]"===n)return a("]"),e;a(","),u()}}o("Bad array")},p=function(){var e,t={};if("{"===n){if(a("{"),u(),"}"===n)return a("}"),t;for(;n;){if(e=l(),u(),a(":"),Object.hasOwnProperty.call(t,e)&&o('Duplicate key "'+e+'"'),t[e]=d(),u(),"}"===n)return a("}"),t;a(","),u()}}o("Bad object")};return d=function(){switch(u(),n){case"{":return p();case"[":return f();case'"':return l();case"-":return s();default:return n>="0"&&"9">=n?s():c()}},function(i,a){var s;return r=i,e=0,n=" ",s=d(),u(),n&&o("Syntax error"),"function"==typeof a?function l(e,n){var i,r,o=e[n];if(o&&"object"==typeof o)for(i in o)Object.prototype.hasOwnProperty.call(o,i)&&(r=l(o,i),r!==t?o[i]=r:delete o[i]);return a.call(e,n,o)}({"":s},""):s}}()}),i(An,[wn,Z,nt,ht,lt,ct,Q,it,Tn],function(e,t,n,i,r,o,a,s,l){function u(){function e(e,n){var i=this,o,a;o=n.getBlob().getSource(),"blob"===t.typeOf(o)&&window.FileReader&&(a=new window.FileReader,a.onload=function(){n.append(n.getBlobName(),new r(null,{type:o.type,data:a.result})),f.send.call(i,e,n)},a.readAsBinaryString(o))}function u(){return!window.XMLHttpRequest||"IE"===s.browser&&s.version<8?function(){for(var e=["Msxml2.XMLHTTP.6.0","Microsoft.XMLHTTP"],t=0;t<e.length;t++)try{return new ActiveXObject(e[t])}catch(n){}}():new window.XMLHttpRequest}function c(e){var t=e.responseXML,n=e.responseText;return"IE"===s.browser&&n&&t&&!t.documentElement&&/[^\/]+\/[^\+]+\+xml/.test(e.getResponseHeader("Content-Type"))&&(t=new window.ActiveXObject("Microsoft.XMLDOM"),t.async=!1,t.validateOnParse=!1,t.loadXML(n)),t&&("IE"===s.browser&&0!==t.parseError||!t.documentElement||"parsererror"===t.documentElement.tagName)?null:t}function d(e){var t="----moxieboundary"+(new Date).getTime(),n="--",i="\r\n",o="",s=this.getRuntime();if(!s.can("send_binary_string"))throw new a.RuntimeError(a.RuntimeError.NOT_SUPPORTED_ERR);return p.setRequestHeader("Content-Type","multipart/form-data; boundary="+t),e.each(function(e,a){o+=e instanceof r?n+t+i+'Content-Disposition: form-data; name="'+a+'"; filename="'+unescape(encodeURIComponent(e.name||"blob"))+'"'+i+"Content-Type: "+e.type+i+i+e.getSource()+i:n+t+i+'Content-Disposition: form-data; name="'+a+'"'+i+i+unescape(encodeURIComponent(e))+i}),o+=n+t+n+i}var f=this,p,h;t.extend(this,{send:function(i,a){var l=this,c="Mozilla"===s.browser&&s.version>=4&&s.version<7,f="Android Browser"===s.browser,m=!1;if(h=i.url.replace(/^.+?\/([\w\-\.]+)$/,"$1").toLowerCase(),p=u(),p.open(i.method,i.url,i.async,i.user,i.password),a instanceof r)a.isDetached()&&(m=!0),a=a.getSource();else if(a instanceof o){if(a.hasBlob())if(a.getBlob().isDetached())a=d.call(l,a),m=!0;else if(c||f)return e.call(l,i,a),void 0;if(a instanceof o){var g=new window.FormData;a.each(function(e,t){e instanceof r?g.append(t,e.getSource()):g.append(t,e)}),a=g}}p.upload?(i.withCredentials&&(p.withCredentials=!0),p.addEventListener("load",function(e){l.trigger(e)}),p.addEventListener("error",function(e){l.trigger(e)}),p.addEventListener("progress",function(e){l.trigger(e)}),p.upload.addEventListener("progress",function(e){l.trigger({type:"UploadProgress",loaded:e.loaded,total:e.total})})):p.onreadystatechange=function v(){switch(p.readyState){case 1:break;case 2:break;case 3:var e,t;try{n.hasSameOrigin(i.url)&&(e=p.getResponseHeader("Content-Length")||0),p.responseText&&(t=p.responseText.length)}catch(r){e=t=0}l.trigger({type:"progress",lengthComputable:!!e,total:parseInt(e,10),loaded:t});break;case 4:p.onreadystatechange=function(){},0===p.status?l.trigger("error"):l.trigger("load")}},t.isEmptyObj(i.headers)||t.each(i.headers,function(e,t){p.setRequestHeader(t,e)}),""!==i.responseType&&"responseType"in p&&(p.responseType="json"!==i.responseType||s.can("return_response_type","json")?i.responseType:"text"),m?p.sendAsBinary?p.sendAsBinary(a):!function(){for(var e=new Uint8Array(a.length),t=0;t<a.length;t++)e[t]=255&a.charCodeAt(t);p.send(e.buffer)}():p.send(a),l.trigger("loadstart")},getStatus:function(){try{if(p)return p.status}catch(e){}return 0},getResponse:function(e){var t=this.getRuntime();try{switch(e){case"blob":var n=new i(t.uid,p.response),r=p.getResponseHeader("Content-Disposition");if(r){var o=r.match(/filename=([\'\"'])([^\1]+)\1/);o&&(h=o[2])}return n.name=h,n;case"json":return s.can("return_response_type","json")?p.response:200===p.status?l(p.responseText):null;case"document":return c(p);default:return""!==p.responseText?p.responseText:null}}catch(a){return null}},getAllResponseHeaders:function(){try{return p.getAllResponseHeaders()}catch(e){}return""},abort:function(){p&&p.abort()},destroy:function(){f=h=null}})}return e.XMLHttpRequest=u}),i(Sn,[Z,it,rt,Q,ot],function(e,t,n,i,r){function o(){var e;try{e=navigator.plugins["Shockwave Flash"],e=e.description}catch(t){try{e=new ActiveXObject("ShockwaveFlash.ShockwaveFlash").GetVariable("$version")}catch(n){e="0.0"}}return e=e.match(/\d+/g),parseFloat(e[0]+"."+e[1])}function a(a){var u=this,c;a=e.extend({swf_url:t.swf_url},a),r.call(this,a,s,{access_binary:function(e){return e&&"browser"===u.mode},access_image_binary:function(e){return e&&"browser"===u.mode},display_media:r.capTrue,do_cors:r.capTrue,drag_and_drop:!1,report_upload_progress:function(){return"client"===u.mode},resize_image:r.capTrue,return_response_headers:!1,return_response_type:function(t){return!e.arrayDiff(t,["","text","json","document"])||"browser"===u.mode},return_status_code:function(t){return"browser"===u.mode||!e.arrayDiff(t,[200,404])},select_file:r.capTrue,select_multiple:r.capTrue,send_binary_string:function(e){return e&&"browser"===u.mode},send_browser_cookies:function(e){return e&&"browser"===u.mode},send_custom_headers:function(e){return e&&"browser"===u.mode},send_multipart:r.capTrue,slice_blob:r.capTrue,stream_upload:function(e){return e&&"browser"===u.mode},summon_file_dialog:!1,upload_filesize:function(t){return e.parseSizeStr(t)<=2097152||"client"===u.mode},use_http_method:function(t){return!e.arrayDiff(t,["GET","POST"])}},{access_binary:function(e){return e?"browser":"client"},access_image_binary:function(e){return e?"browser":"client"},report_upload_progress:function(e){return e?"browser":"client"},return_response_type:function(t){return e.arrayDiff(t,["","text","json","document"])?"browser":["client","browser"]},return_status_code:function(t){return e.arrayDiff(t,[200,404])?"browser":["client","browser"]},send_binary_string:function(e){return e?"browser":"client"},send_browser_cookies:function(e){return e?"browser":"client"},send_custom_headers:function(e){return e?"browser":"client"},stream_upload:function(e){return e?"client":"browser"},upload_filesize:function(t){return e.parseSizeStr(t)>=2097152?"client":"browser"}},"client"),o()<10&&(this.mode=!1),e.extend(this,{getShim:function(){return n.get(this.uid)},shimExec:function(e,t){var n=[].slice.call(arguments,2);return u.getShim().exec(this.uid,e,t,n)},init:function(){var n,r,o;o=this.getShimContainer(),e.extend(o.style,{position:"absolute",top:"-8px",left:"-8px",width:"9px",height:"9px",overflow:"hidden"}),n='<object id="'+this.uid+'" type="application/x-shockwave-flash" data="'+a.swf_url+'" ',"IE"===t.browser&&(n+='classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000" '),n+='width="100%" height="100%" style="outline:0"><param name="movie" value="'+a.swf_url+'" />'+'<param name="flashvars" value="uid='+escape(this.uid)+"&target="+t.global_event_dispatcher+'" />'+'<param name="wmode" value="transparent" />'+'<param name="allowscriptaccess" value="always" />'+"</object>","IE"===t.browser?(r=document.createElement("div"),o.appendChild(r),r.outerHTML=n,r=o=null):o.innerHTML=n,c=setTimeout(function(){u&&!u.initialized&&u.trigger("Error",new i.RuntimeError(i.RuntimeError.NOT_INIT_ERR))},5e3)},destroy:function(e){return function(){e.call(u),clearTimeout(c),a=c=e=u=null}}(this.destroy)},l)}var s="flash",l={};return r.addConstructor(s,a),l}),i(Dn,[Sn,lt],function(e,t){var n={slice:function(e,n,i,r){var o=this.getRuntime();return 0>n?n=Math.max(e.size+n,0):n>0&&(n=Math.min(n,e.size)),0>i?i=Math.max(e.size+i,0):i>0&&(i=Math.min(i,e.size)),e=o.shimExec.call(this,"Blob","slice",n,i,r||""),e&&(e=new t(o.uid,e)),e}};return e.Blob=n}),i(kn,[Sn],function(e){var t={init:function(e){this.getRuntime().shimExec.call(this,"FileInput","init",{name:e.name,accept:e.accept,multiple:e.multiple}),this.trigger("ready")}};return e.FileInput=t}),i(In,[Z,tt,at,et],function(e,t,n,i){function r(){function i(){c=d=0,u=this.result=null}function o(t,n){var i=this;l=n,i.bind("TransportingProgress",function(t){d=t.loaded,c>d&&-1===e.inArray(i.state,[r.IDLE,r.DONE])&&a.call(i)},999),i.bind("TransportingComplete",function(){d=c,i.state=r.DONE,u=null,i.result=l.exec.call(i,"Transporter","getAsBlob",t||"")},999),i.state=r.BUSY,i.trigger("TransportingStarted"),a.call(i)}function a(){var e=this,n,i=c-d;f>i&&(f=i),n=t.btoa(u.substr(d,f)),l.exec.call(e,"Transporter","receive",n,c)}var s,l,u,c,d,f;n.call(this),e.extend(this,{uid:e.guid("uid_"),state:r.IDLE,result:null,transport:function(t,n,r){var a=this;if(r=e.extend({chunk_size:204798},r),(s=r.chunk_size%3)&&(r.chunk_size+=3-s),f=r.chunk_size,i.call(this),u=t,c=t.length,"string"===e.typeOf(r)||r.ruid)o.call(a,n,this.connectRuntime(r));else{var l=function(e,t){a.unbind("RuntimeInit",l),o.call(a,n,t)};this.bind("RuntimeInit",l),this.connectRuntime(r)}},abort:function(){var e=this;e.state=r.IDLE,l&&(l.exec.call(e,"Transporter","clear"),e.trigger("TransportingAborted")),i.call(e)},destroy:function(){this.unbindAll(),l=null,this.disconnectRuntime(),i.call(this)}})}return r.IDLE=0,r.BUSY=1,r.DONE=2,r.prototype=i.instance,r}),i(Nn,[Sn,Z,lt,ht,ut,ct,In,Tn],function(e,t,n,i,r,o,a,s){var l={send:function(e,i){function r(){e.transport=c.mode,c.shimExec.call(u,"XMLHttpRequest","send",e,i)}function s(e,t){c.shimExec.call(u,"XMLHttpRequest","appendBlob",e,t.uid),i=null,r()}function l(e,t){var n=new a;n.bind("TransportingComplete",function(){t(this.result)}),n.transport(e.getSource(),e.type,{ruid:c.uid})}var u=this,c=u.getRuntime();if(t.isEmptyObj(e.headers)||t.each(e.headers,function(e,t){c.shimExec.call(u,"XMLHttpRequest","setRequestHeader",t,e.toString())}),i instanceof o){var d;if(i.each(function(e,t){e instanceof n?d=t:c.shimExec.call(u,"XMLHttpRequest","append",t,e)}),i.hasBlob()){var f=i.getBlob();f.isDetached()?l(f,function(e){f.destroy(),s(d,e)}):s(d,f)}else i=null,r()}else i instanceof n?i.isDetached()?l(i,function(e){i.destroy(),i=e.uid,r()}):(i=i.uid,r()):r()},getResponse:function(e){var n,o,a=this.getRuntime();if(o=a.shimExec.call(this,"XMLHttpRequest","getResponseAsBlob")){if(o=new i(a.uid,o),"blob"===e)return o;if(~t.inArray(e,["","text"]))return n=new r,n.readAsText(o);if("arraybuffer"===e);else if("json"===e){n=new r;try{return s(n.readAsText(o))}catch(l){return null}}}return null},abort:function(e){var t=this.getRuntime();t.shimExec.call(this,"XMLHttpRequest","abort"),this.dispatchEvent("readystatechange"),this.dispatchEvent("abort")}};return e.XMLHttpRequest=l}),i(Mn,[Sn,tt],function(e,t){function n(e,n){switch(n){case"readAsText":return t.atob(e,"utf8");case"readAsBinaryString":return t.atob(e);case"readAsDataURL":return e}return null}var i={read:function(e,t){var i,r=this.getRuntime();return(i=r.shimExec.call(this,"FileReaderSync","readAsBase64",t.uid))?("readAsDataURL"===e&&(i="data:"+(t.type||"")+";base64,"+i),n(i,e,t.type)):null}};return e.FileReaderSync=i}),a([l,u,c,d,f,p,h,m,g,v,y,x,b,w,_,E,C,R,T,A,S,D,k,I,N,M,F,H,P,O,L,z,W,B,U,j,q,V,X,Y,G,$,J,K,Z,Q,et,tt,nt,it,rt,ot,at,st,lt,ut,ct,dt,ft,pt,ht,mt,gt,vt,yt,xt,bt,wt,_t,Et,Ct,Rt,Tt,At,St,Dt,kt,It,Nt,Mt,Ft,Ht,Pt,Ot,Lt,zt,Wt,Bt,Ut,jt,qt,Vt,Xt,Yt,Gt,$t,Jt,Kt,Zt,Qt,en,tn,nn,rn,on,an,sn,ln,un,cn,dn,fn,pn,hn,mn,gn,vn,yn,xn,bn,wn,_n,En,Cn,Rn,Tn,An,Sn,Dn,kn,In,Nn,Mn])}(this);